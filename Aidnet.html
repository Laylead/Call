<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConnectX - Social Calling App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --gray-color: #6c757d;
            --card-bg: #ffffff;
            --body-bg: #f5f7fb;
            --text-color: #333333;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --primary-color: #4895ef;
            --secondary-color: #560bad;
            --accent-color: #b5179e;
            --light-color: #2d3748;
            --dark-color: #f8f9fa;
            --card-bg: #1a202c;
            --body-bg: #121826;
            --text-color: #e2e8f0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--body-bg);
            color: var(--text-color);
            transition: var(--transition);
            min-height: 100vh;
            padding-bottom: 70px;
            overflow-x: hidden;
        }

        /* Header */
        header {
            background-color: var(--card-bg);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            color: var(--primary-color);
            font-size: 24px;
        }

        .logo h1 {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .header-actions i {
            font-size: 20px;
            color: var(--gray-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .header-actions i:hover {
            color: var(--primary-color);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .bottom-nav.hidden {
            transform: translateY(100%);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: var(--transition);
            padding: 5px 10px;
            border-radius: 10px;
            text-decoration: none;
        }

        .nav-item.active, .nav-item:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        .nav-item i {
            font-size: 20px;
            color: var(--gray-color);
            transition: var(--transition);
        }

        .nav-item.active i, .nav-item:hover i {
            color: var(--primary-color);
        }

        .nav-item span {
            font-size: 12px;
            color: var(--gray-color);
            transition: var(--transition);
        }

        .nav-item.active span, .nav-item:hover span {
            color: var(--primary-color);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background-color: var(--card-bg);
            box-shadow: var(--shadow);
            z-index: 200;
            transition: var(--transition);
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 199;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .user-avatar, .user-avatar-small, .post-avatar, .comment-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            object-fit: cover;
        }

        .user-avatar-small {
            width: 40px;
            height: 40px;
            font-size: 16px;
        }

        .post-avatar, .comment-avatar {
            width: 40px;
            height: 40px;
            font-size: 16px;
        }

        .user-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .user-info p {
            color: var(--gray-color);
            font-size: 14px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            border-radius: 10px;
            color: var(--text-color);
            text-decoration: none;
            transition: var(--transition);
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .sidebar-menu i {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        /* Keypad */
        .keypad-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 15px;
            text-align: center;
            height: calc(100vh - 140px);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .phone-number {
            font-size: 28px;
            margin: 15px 0;
            padding: 12px;
            letter-spacing: 1.5px;
            min-height: 50px;
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .key {
            background-color: var(--card-bg);
            border-radius: 50%;
            height: 65px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            user-select: none;
        }

        .key:active {
            transform: scale(0.95);
            background-color: var(--primary-color);
            color: white;
        }

        .key:hover {
            background-color: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .key .number {
            font-size: 22px;
            font-weight: bold;
        }

        .key .letters {
            font-size: 10px;
            margin-top: -3px;
            opacity: 0.7;
        }

        .call-actions {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 20px;
        }

        .call-action {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .call {
            background-color: var(--success-color);
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 201, 240, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 201, 240, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 201, 240, 0); }
        }

        .call:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(76, 201, 240, 0.4);
        }

        .backspace {
            background-color: var(--warning-color);
            color: white;
        }

        .backspace:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(247, 37, 133, 0.4);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 300;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 350px;
            box-shadow: var(--shadow);
            transform: translateY(20px);
            transition: var(--transition);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--body-bg);
            border-radius: 8px;
            background-color: var(--body-bg);
            color: var(--text-color);
            transition: var(--transition);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            width: 100%;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .auth-toggle {
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
        }

        .auth-toggle a {
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
        }

        .permission-request {
            background-color: rgba(67, 97, 238, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .permission-request p {
            margin-bottom: 10px;
            font-size: 14px;
        }

        /* Search Modal */
        .search-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--body-bg);
            z-index: 300;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .search-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .search-header {
            background-color: var(--card-bg);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: var(--shadow);
        }

        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            background-color: var(--body-bg);
            border-radius: 25px;
            color: var(--text-color);
            font-size: 16px;
        }

        .search-input:focus {
            outline: none;
        }

        .close-search {
            font-size: 20px;
            color: var(--gray-color);
            cursor: pointer;
        }

        .search-results {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .user-result {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .user-result:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .user-result-info {
            flex: 1;
        }

        .user-result-info h4 {
            font-size: 16px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .verified-badge {
            color: var(--primary-color);
            font-size: 14px;
        }

        .user-result-info p {
            color: var(--gray-color);
            font-size: 14px;
        }

        .follow-btn {
            padding: 8px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
        }

        .follow-btn.following {
            background-color: var(--gray-color);
        }

        .follow-btn:hover {
            background-color: var(--secondary-color);
        }

        /* Home Page Content */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Create Post Button */
        .create-post-btn {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .create-post-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .create-post-btn i {
            color: var(--primary-color);
            font-size: 20px;
        }

        .create-post-btn span {
            color: var(--gray-color);
            font-size: 14px;
        }

        /* Post Creation Modal */
        .post-creation-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 300;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .post-creation-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .post-creation-content {
            background-color: var(--card-bg);
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            box-shadow: var(--shadow);
            transform: translateY(20px);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .post-creation-modal.active .post-creation-content {
            transform: translateY(0);
        }

        .post-creation-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .post-creation-header h3 {
            font-size: 18px;
            font-weight: 600;
        }

        .close-post-modal {
            font-size: 20px;
            color: var(--gray-color);
            cursor: pointer;
        }

        .post-creation-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .post-textarea {
            width: 100%;
            min-height: 150px;
            border: none;
            background-color: transparent;
            color: var(--text-color);
            font-size: 16px;
            line-height: 1.5;
            resize: none;
            outline: none;
            margin-bottom: 15px;
        }

        .post-media-preview {
            margin-bottom: 15px;
            position: relative;
        }

        .post-media-preview img, .post-media-preview video {
            width: 100%;
            border-radius: 10px;
        }

        .remove-media {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--warning-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .remove-media:hover {
            transform: scale(1.1);
        }

        .voice-recorder {
            background-color: var(--body-bg);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .voice-recorder.recording {
            background-color: rgba(247, 37, 133, 0.1);
        }

        .record-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin: 0 auto 10px;
            transition: var(--transition);
        }

        .record-btn.recording {
            background-color: var(--warning-color);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .voice-visualizer {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
            margin-bottom: 10px;
        }

        .voice-bar {
            width: 4px;
            background-color: var(--primary-color);
            border-radius: 2px;
            transition: height 0.2s ease;
        }

        .voice-duration {
            color: var(--gray-color);
            font-size: 14px;
        }

        .post-creation-footer {
            padding: 15px 20px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .media-options {
            display: flex;
            gap: 10px;
        }

        .media-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--body-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .media-option:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        .media-option i {
            color: var(--primary-color);
        }

        .post-btn {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .post-btn:hover {
            background-color: var(--secondary-color);
        }

        .post-btn:disabled {
            background-color: var(--gray-color);
            cursor: not-allowed;
        }

        /* Post Feed */
        .post {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .post-user-info {
            flex: 1;
        }

        .post-user-info h4 {
            font-size: 16px;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .post-user-info p {
            font-size: 12px;
            color: var(--gray-color);
        }

        .post-options {
            color: var(--gray-color);
            cursor: pointer;
        }

        .post-content {
            margin-bottom: 15px;
        }

        .post-text {
            margin-bottom: 10px;
            line-height: 1.5;
            white-space: pre-line;
        }

        .voice-note {
            background-color: var(--body-bg);
            border-radius: 20px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .play-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .play-btn:hover {
            transform: scale(1.05);
        }

        .waveform {
            flex: 1;
            height: 40px;
            background: linear-gradient(90deg, 
                var(--primary-color) 0%, 
                var(--primary-color) 20%, 
                var(--accent-color) 40%, 
                var(--accent-color) 60%, 
                var(--primary-color) 80%, 
                var(--primary-color) 100%);
            border-radius: 20px;
            animation: wave 2s linear infinite;
            background-size: 200% 100%;
        }

        @keyframes wave {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        .voice-duration {
            color: var(--gray-color);
            font-size: 14px;
        }

        .post-image {
            width: 100%;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .post-stats {
            display: flex;
            justify-content: space-between;
            color: var(--gray-color);
            font-size: 14px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }

        .post-actions-bar {
            display: flex;
            justify-content: space-around;
        }

        .post-action-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .post-action-btn:hover {
            background-color: var(--body-bg);
        }

        .post-action-btn i {
            color: var(--gray-color);
        }

        .post-action-btn.active i {
            color: var(--primary-color);
        }

        /* Comments Section */
        .comments-section {
            margin-top: 15px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding-top: 15px;
        }

        .comment {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .comment-content {
            flex: 1;
            background-color: var(--body-bg);
            padding: 10px 15px;
            border-radius: 18px;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .comment-author {
            font-weight: 600;
            font-size: 14px;
        }

        .comment-time {
            color: var(--gray-color);
            font-size: 12px;
        }

        .comment-text {
            font-size: 14px;
            line-height: 1.4;
        }

        .add-comment {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .comment-input {
            flex: 1;
            padding: 10px 15px;
            border: none;
            background-color: var(--body-bg);
            border-radius: 20px;
            color: var(--text-color);
            font-size: 14px;
        }

        .comment-input:focus {
            outline: none;
        }

        .send-comment {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .send-comment:hover {
            background-color: var(--secondary-color);
        }

        /* Suggested Users */
        .suggested-users {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
        }

        .see-all {
            color: var(--primary-color);
            font-size: 14px;
            cursor: pointer;
        }

        .suggested-user {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .suggested-user:last-child {
            border-bottom: none;
        }

        .suggested-user-info {
            flex: 1;
        }

        .suggested-user-info h4 {
            font-size: 14px;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .suggested-user-info p {
            color: var(--gray-color);
            font-size: 12px;
        }

        /* Profile Picture Upload */
        .profile-picture-upload {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 300;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .profile-picture-upload.active {
            opacity: 1;
            visibility: visible;
        }

        .profile-upload-content {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 350px;
            box-shadow: var(--shadow);
            transform: translateY(20px);
            transition: var(--transition);
            text-align: center;
        }

        .profile-picture-upload.active .profile-upload-content {
            transform: translateY(0);
        }

        .profile-upload-content h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .profile-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            font-weight: bold;
            object-fit: cover;
        }

        .upload-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .upload-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .upload-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .upload-btn.primary:hover {
            background-color: var(--secondary-color);
        }

        .upload-btn.secondary {
            background-color: var(--body-bg);
            color: var(--text-color);
        }

        .upload-btn.secondary:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        /* Profile Edit Modal */
        .profile-edit-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 300;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .profile-edit-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .profile-edit-content {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 450px;
            box-shadow: var(--shadow);
            transform: translateY(20px);
            transition: var(--transition);
        }

        .profile-edit-modal.active .profile-edit-content {
            transform: translateY(0);
        }

        .profile-edit-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .profile-edit-header h2 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .edit-profile-picture {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .edit-profile-picture .profile-preview {
            margin: 0;
            width: 80px;
            height: 80px;
            font-size: 24px;
        }

        .change-photo-btn {
            padding: 8px 15px;
            background-color: var(--body-bg);
            border: none;
            border-radius: 20px;
            color: var(--text-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .change-photo-btn:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        .username-edit-info {
            background-color: rgba(67, 97, 238, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 14px;
            color: var(--primary-color);
        }

        .bio-textarea {
            width: 100%;
            min-height: 100px;
            border: 1px solid var(--body-bg);
            border-radius: 8px;
            background-color: var(--body-bg);
            color: var(--text-color);
            padding: 12px 15px;
            resize: vertical;
            margin-bottom: 15px;
            font-family: inherit;
        }

        .bio-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .profile-edit-actions {
            display: flex;
            gap: 10px;
        }

        .profile-edit-actions .btn {
            width: auto;
            flex: 1;
        }

        .btn-secondary {
            background-color: var(--body-bg);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        /* Profile Page */
        .profile-page {
            background-color: var(--card-bg);
            border-radius: 15px;
            margin: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .profile-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .profile-header-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
            font-weight: bold;
            object-fit: cover;
        }

        .profile-header h2 {
            font-size: 24px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .profile-header p {
            color: var(--gray-color);
            margin-bottom: 10px;
        }

        .profile-bio {
            margin: 15px 0;
            line-height: 1.5;
            text-align: center;
        }

        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
        }

        .profile-stat {
            text-align: center;
        }

        .profile-stat-value {
            font-size: 18px;
            font-weight: bold;
            display: block;
        }

        .profile-stat-label {
            font-size: 14px;
            color: var(--gray-color);
        }

        .profile-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .profile-action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            flex: 1;
            max-width: 150px;
        }

        .profile-action-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .profile-action-btn.primary:hover {
            background-color: var(--secondary-color);
        }

        .profile-action-btn.secondary {
            background-color: var(--body-bg);
            color: var(--text-color);
        }

        .profile-action-btn.secondary:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .profile-tabs {
            display: flex;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .profile-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 2px solid transparent;
        }

        .profile-tab.active {
            border-bottom: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .profile-tab-content {
            padding: 20px;
            min-height: 200px;
        }

        .profile-posts-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
        }

        .profile-post-thumb {
            aspect-ratio: 1;
            background-color: var(--body-bg);
            border-radius: 5px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-color);
        }

        .profile-post-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-followers-list, .profile-following-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .follower-item, .following-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px;
            border-radius: 10px;
            transition: var(--transition);
        }

        .follower-item:hover, .following-item:hover {
            background-color: var(--body-bg);
        }

        /* Find Friends Page */
        .find-friends-page {
            padding: 20px;
        }

        .find-friends-header {
            margin-bottom: 20px;
        }

        .find-friends-header h2 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .friends-search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .friends-search-input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            background-color: var(--card-bg);
            border-radius: 25px;
            color: var(--text-color);
            box-shadow: var(--shadow);
        }

        .friends-search-input:focus {
            outline: none;
        }

        .friends-filter-btn {
            padding: 12px 20px;
            background-color: var(--card-bg);
            border: none;
            border-radius: 25px;
            color: var(--text-color);
            cursor: pointer;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .friends-filter-options {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            display: none;
        }

        .friends-filter-options.active {
            display: block;
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .filter-option input {
            margin: 0;
        }

        .friends-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            box-shadow: var(--shadow);
            z-index: 400;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .notification.active {
            transform: translateX(0);
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .notification-header i {
            color: var(--primary-color);
            font-size: 20px;
        }

        .notification-header h4 {
            font-size: 16px;
        }

        .notification p {
            font-size: 14px;
            color: var(--gray-color);
        }

        /* Calling Screen */
        .calling-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 500;
            color: white;
            text-align: center;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .calling-screen.active {
            opacity: 1;
            visibility: visible;
        }

        .caller-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin-bottom: 20px;
            border: 3px solid white;
        }

        .caller-name {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .call-status {
            font-size: 16px;
            margin-bottom: 30px;
        }

        .call-timer {
            font-size: 18px;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .call-controls {
            display: flex;
            gap: 30px;
        }

        .call-control {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .call-control:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .end-call {
            background: var(--warning-color);
        }

        /* Page Content */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 280px;
            }
            
            .keypad-container {
                padding: 10px;
            }
            
            .key {
                height: 60px;
            }
            
            .key .number {
                font-size: 20px;
            }
            
            .call-action {
                width: 55px;
                height: 55px;
            }
        }

        @media (max-width: 480px) {
            .key {
                height: 55px;
            }
            
            .key .number {
                font-size: 18px;
            }
            
            .phone-number {
                font-size: 24px;
            }
            
            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="authTitle">Create Account</h2>
                <p>Join ConnectX to start connecting with others</p>
            </div>
            <form id="authForm">
                <div class="form-group" id="fullNameGroup">
                    <label for="fullName">Full Name</label>
                    <input type="text" id="fullName" placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="Enter your email" required>
                </div>
                <div class="form-group" id="usernameGroup">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Choose a username">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Create a password" required>
                </div>
                <div class="permission-request">
                    <p>ConnectX needs permissions for:</p>
                    <p><i class="fas fa-bell"></i> Notifications</p>
                    <p><i class="fas fa-microphone"></i> Microphone</p>
                    <p><i class="fas fa-volume-up"></i> Audio</p>
                </div>
                <button type="submit" class="btn btn-primary" id="authButton">Create Account</button>
            </form>
            <div class="auth-toggle">
                <p>Already have an account? <a id="toggleAuth">Sign In</a></p>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div class="search-modal" id="searchModal">
        <div class="search-header">
            <i class="fas fa-arrow-left close-search"></i>
            <input type="text" class="search-input" placeholder="Search users..." id="searchInput">
            <i class="fas fa-search"></i>
        </div>
        <div class="search-results" id="searchResults">
            <!-- Search results will appear here -->
        </div>
    </div>

    <!-- Post Creation Modal -->
    <div class="post-creation-modal" id="postCreationModal">
        <div class="post-creation-content">
            <div class="post-creation-header">
                <h3>Create Post</h3>
                <i class="fas fa-times close-post-modal"></i>
            </div>
            <div class="post-creation-body">
                <textarea class="post-textarea" placeholder="What's on your mind?" id="postTextarea"></textarea>
                <div class="post-media-preview" id="postMediaPreview"></div>
                <div class="voice-recorder" id="voiceRecorder">
                    <button class="record-btn" id="recordBtn">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <div class="voice-visualizer" id="voiceVisualizer"></div>
                    <div class="voice-duration" id="voiceDuration">00:00</div>
                </div>
            </div>
            <div class="post-creation-footer">
                <div class="media-options">
                    <div class="media-option" id="addPhotoBtn">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="media-option" id="addVoiceBtn">
                        <i class="fas fa-microphone"></i>
                    </div>
                </div>
                <button class="post-btn" id="postSubmitBtn" disabled>Post</button>
            </div>
        </div>
    </div>

    <!-- Profile Picture Upload Modal -->
    <div class="profile-picture-upload" id="profilePictureUpload">
        <div class="profile-upload-content">
            <h3>Update Profile Picture</h3>
            <div class="profile-preview" id="profilePreview"></div>
            <div class="upload-actions">
                <button class="upload-btn secondary" id="cancelUpload">Cancel</button>
                <button class="upload-btn primary" id="confirmUpload">Upload</button>
            </div>
        </div>
    </div>

    <!-- Profile Edit Modal -->
    <div class="profile-edit-modal" id="profileEditModal">
        <div class="profile-edit-content">
            <div class="profile-edit-header">
                <h2>Edit Profile</h2>
                <p>Update your profile information</p>
            </div>
            <form id="profileEditForm">
                <div class="edit-profile-picture">
                    <div class="profile-preview" id="editProfilePreview"></div>
                    <button type="button" class="change-photo-btn" id="changePhotoBtn">Change Photo</button>
                </div>
                <div class="form-group">
                    <label for="editFullName">Full Name</label>
                    <input type="text" id="editFullName" placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="editUsername">Username</label>
                    <input type="text" id="editUsername" placeholder="Choose a username">
                    <div class="username-edit-info" id="usernameEditInfo">
                        You can change your username 2 times in 6 months. <span id="usernameChangesLeft">2 changes left</span>.
                    </div>
                </div>
                <div class="form-group">
                    <label for="editBio">Bio</label>
                    <textarea class="bio-textarea" id="editBio" placeholder="Tell people about yourself"></textarea>
                </div>
                <div class="profile-edit-actions">
                    <button type="button" class="btn btn-secondary" id="cancelProfileEdit">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="saveProfileChanges">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-header">
            <i class="fas fa-bell"></i>
            <h4 id="notificationTitle">New Message</h4>
        </div>
        <p id="notificationMessage">Welcome to ConnectX!</p>
    </div>

    <!-- Calling Screen -->
    <div class="calling-screen" id="callingScreen">
        <div class="caller-avatar" id="callerAvatar">?</div>
        <div class="caller-name" id="callerName">Unknown</div>
        <div class="call-status" id="callStatus">Calling...</div>
        <div class="call-timer" id="callTimer">00:00</div>
        <div class="call-controls">
            <div class="call-control" id="muteCall">
                <i class="fas fa-microphone"></i>
            </div>
            <div class="call-control end-call" id="endCall">
                <i class="fas fa-phone"></i>
            </div>
            <div class="call-control" id="speakerCall">
                <i class="fas fa-volume-up"></i>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="logo">
            <i class="fas fa-phone-alt"></i>
            <h1>ConnectX</h1>
        </div>
        <div class="header-actions">
            <i class="fas fa-search" id="searchBtn"></i>
            <i class="fas fa-bell" id="notificationsBtn"></i>
            <i class="fas fa-bars" id="menuToggle"></i>
        </div>
    </header>

    <!-- Dial Pad (First Page) -->
    <div class="keypad-container active" id="dialPadPage">
        <div class="phone-number" id="phoneNumber">Enter number</div>
        <div class="keypad">
            <div class="key" data-number="1">
                <div class="number">1</div>
            </div>
            <div class="key" data-number="2">
                <div class="number">2</div>
                <div class="letters">ABC</div>
            </div>
            <div class="key" data-number="3">
                <div class="number">3</div>
                <div class="letters">DEF</div>
            </div>
            <div class="key" data-number="4">
                <div class="number">4</div>
                <div class="letters">GHI</div>
            </div>
            <div class="key" data-number="5">
                <div class="number">5</div>
                <div class="letters">JKL</div>
            </div>
            <div class="key" data-number="6">
                <div class="number">6</div>
                <div class="letters">MNO</div>
            </div>
            <div class="key" data-number="7">
                <div class="number">7</div>
                <div class="letters">PQRS</div>
            </div>
            <div class="key" data-number="8">
                <div class="number">8</div>
                <div class="letters">TUV</div>
            </div>
            <div class="key" data-number="9">
                <div class="number">9</div>
                <div class="letters">WXYZ</div>
            </div>
            <div class="key" data-number="*">
                <div class="number">*</div>
            </div>
            <div class="key" data-number="0">
                <div class="number">0</div>
                <div class="letters">+</div>
            </div>
            <div class="key" data-number="#">
                <div class="number">#</div>
            </div>
        </div>
        <div class="call-actions">
            <div class="call-action backspace" id="backspaceBtn">
                <i class="fas fa-backspace"></i>
            </div>
            <div class="call-action call" id="callBtn">
                <i class="fas fa-phone"></i>
            </div>
        </div>
    </div>

    <!-- Home Page -->
    <div class="page-content" id="homePage">
        <div class="container">
            <!-- Create Post Button -->
            <div class="create-post-btn" id="createPostBtn">
                <div class="user-avatar-small" id="currentUserAvatar">U</div>
                <span>What's on your mind?</span>
            </div>

            <!-- Suggested Users -->
            <div class="suggested-users" id="suggestedUsers">
                <div class="section-header">
                    <div class="section-title">Suggested for you</div>
                    <div class="see-all" id="seeAllUsers">See All</div>
                </div>
                <!-- Suggested users will be loaded here -->
            </div>

            <!-- Post Feed -->
            <div id="postFeed">
                <!-- Posts will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Profile Page -->
    <div class="page-content" id="profilePage">
        <div class="profile-page">
            <div class="profile-header">
                <div class="profile-header-avatar" id="profileHeaderAvatar">U</div>
                <h2 id="profileHeaderName">User Name <i class="fas fa-check-circle verified-badge" id="profileVerifiedBadge" style="display: none;"></i></h2>
                <p id="profileHeaderUsername">@username</p>
                <div class="profile-bio" id="profileBio">No bio yet.</div>
                <div class="profile-stats">
                    <div class="profile-stat">
                        <span class="profile-stat-value" id="profilePostsCount">0</span>
                        <span class="profile-stat-label">Posts</span>
                    </div>
                    <div class="profile-stat">
                        <span class="profile-stat-value" id="profileFollowersCount">0</span>
                        <span class="profile-stat-label">Followers</span>
                    </div>
                    <div class="profile-stat">
                        <span class="profile-stat-value" id="profileFollowingCount">0</span>
                        <span class="profile-stat-label">Following</span>
                    </div>
                </div>
                <div class="profile-actions">
                    <button class="profile-action-btn secondary" id="editProfileBtn">Edit Profile</button>
                    <button class="profile-action-btn primary" id="followProfileBtn" style="display: none;">Follow</button>
                </div>
            </div>
            <div class="profile-tabs">
                <div class="profile-tab active" data-tab="posts">Posts</div>
                <div class="profile-tab" data-tab="followers">Followers</div>
                <div class="profile-tab" data-tab="following">Following</div>
            </div>
            <div class="profile-tab-content">
                <div class="profile-tab-pane active" id="profilePostsTab">
                    <div class="profile-posts-grid" id="profilePostsGrid">
                        <!-- User posts will appear here -->
                    </div>
                </div>
                <div class="profile-tab-pane" id="profileFollowersTab">
                    <div class="profile-followers-list" id="profileFollowersList">
                        <!-- Followers will appear here -->
                    </div>
                </div>
                <div class="profile-tab-pane" id="profileFollowingTab">
                    <div class="profile-following-list" id="profileFollowingList">
                        <!-- Following will appear here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Find Friends Page -->
    <div class="page-content" id="findFriendsPage">
        <div class="find-friends-page">
            <div class="find-friends-header">
                <h2>Find Friends</h2>
                <p>Connect with people you know</p>
            </div>
            <div class="friends-search-container">
                <input type="text" class="friends-search-input" placeholder="Search by name or username" id="friendsSearchInput">
                <button class="friends-filter-btn" id="friendsFilterBtn">
                    <i class="fas fa-filter"></i> Filter
                </button>
            </div>
            <div class="friends-filter-options" id="friendsFilterOptions">
                <div class="filter-option">
                    <input type="checkbox" id="filterVerified" checked>
                    <label for="filterVerified">Verified Users</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="filterMutual" checked>
                    <label for="filterMutual">Mutual Connections</label>
                </div>
            </div>
            <div class="friends-list" id="friendsList">
                <!-- Friends will appear here -->
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="sidebar" id="sidebar">
        <div class="user-profile">
            <div class="user-avatar" id="userAvatar">U</div>
            <div class="user-info">
                <h3 id="userName">Guest User</h3>
                <p id="userHandle">@guest</p>
            </div>
        </div>
        <ul class="sidebar-menu">
            <li><a href="home.html" class="sidebar-link active"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="keypad.html" class="sidebar-link"><i class="fas fa-dialpad"></i> Keypad</a></li>
            <li><a href="#" class="sidebar-link" data-page="profilePage"><i class="fas fa-user"></i> Profile</a></li>
            <li><a href="#" class="sidebar-link" data-page="findFriendsPage"><i class="fas fa-user-friends"></i> Find Friends</a></li>
            <li><a href="groups.html" class="sidebar-link"><i class="fas fa-users"></i> Groups & Channels</a></li>
            <li><a href="mentors.html" class="sidebar-link"><i class="fas fa-user-graduate"></i> Mentors</a></li>
            <li><a href="smile.html" class="sidebar-link"><i class="fas fa-smile"></i> Smile</a></li>
            <li><a href="wallet.html" class="sidebar-link"><i class="fas fa-wallet"></i> Wallet</a></li>
            <li><a href="account.html" class="sidebar-link"><i class="fas fa-user-circle"></i> Account</a></li>
            <li><a href="#" id="themeToggleSidebar"><i class="fas fa-moon"></i> <span>Dark Mode</span></a></li>
            <li><a href="#" id="updateProfilePicture"><i class="fas fa-camera"></i> Update Profile Picture</a></li>
            <li><a href="#" id="logoutBtn" class="sidebar-link"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav" id="bottomNav">
        <a href="home.html" class="nav-item active">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="sms.html" class="nav-item">
            <i class="fas fa-sms"></i>
            <span>SMS</span>
        </a>
        <a href="keypad.html" class="nav-item">
            <i class="fas fa-dialpad"></i>
            <span>Keypad</span>
        </a>
        <a href="contacts.html" class="nav-item">
            <i class="fas fa-address-book"></i>
            <span>Contacts</span>
        </a>
        <a href="account.html" class="nav-item">
            <i class="fas fa-user"></i>
            <span>Account</span>
        </a>
        <a href="history.html" class="nav-item">
            <i class="fas fa-history"></i>
            <span>History</span>
        </a>
    </div>

    <!-- External Configuration -->
    <script src="configuration.js"></script>
    <script src="agora.js"></script>

    <!-- External Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <!-- App Scripts -->
    <script>
        // Main Application
        class ConnectXApp {
            constructor() {
                this.state = {
                    currentUser: null,
                    isLoggedIn: false,
                    currentPage: 'dialPadPage',
                    phoneNumber: '',
                    isCalling: false,
                    callTimer: 0,
                    callInterval: null,
                    audioContext: null,
                    posts: [],
                    following: [],
                    suggestedUsers: [],
                    searchResults: [],
                    theme: 'light',
                    agoraClient: null,
                    agoraStream: null,
                    mediaStream: null,
                    mediaFile: null,
                    isRecording: false,
                    mediaRecorder: null,
                    audioChunks: [],
                    recordingTimer: null,
                    recordingStartTime: null,
                    profilePictureFile: null,
                    profileData: {
                        usernameChanges: 0,
                        lastUsernameChange: null,
                        bio: '',
                        verified: false,
                        followers: [],
                        following: []
                    }
                };

                this.init();
            }

            async init() {
                try {
                    // Check if external configuration is loaded
                    if (typeof firebaseConfig === 'undefined') {
                        console.error('Configuration not loaded. Using demo mode.');
                        this.setupDemoMode();
                    } else {
                        // Initialize Firebase if not already initialized
                        if (!firebase.apps.length) {
                            firebase.initializeApp(firebaseConfig);
                        }
                    }
                    
                    this.setupDOMReferences();
                    this.setupEventListeners();
                    await this.checkAuthStatus();
                    await this.loadInitialData();
                    await this.requestPermissions();
                    console.log('ConnectX App initialized successfully');
                } catch (error) {
                    console.error('App initialization failed:', error);
                    this.showNotification('Initialization Error', 'Failed to initialize app. Please refresh.');
                }
            }

            setupDemoMode() {
                // Demo configuration for testing
                const demoConfig = {
                    apiKey: "demo-api-key",
                    authDomain: "connectx-demo.firebaseapp.com",
                    projectId: "connectx-demo",
                    storageBucket: "connectx-demo.appspot.com",
                    messagingSenderId: "123456789",
                    appId: "demo-app-id"
                };
                
                try {
                    if (!firebase.apps.length) {
                        firebase.initializeApp(demoConfig);
                    }
                    console.log('Demo mode activated');
                } catch (error) {
                    console.log('Firebase not available, running in offline mode');
                }
            }

            setupDOMReferences() {
                this.elements = {
                    authModal: document.getElementById('authModal'),
                    authForm: document.getElementById('authForm'),
                    authTitle: document.getElementById('authTitle'),
                    authButton: document.getElementById('authButton'),
                    toggleAuth: document.getElementById('toggleAuth'),
                    fullNameGroup: document.getElementById('fullNameGroup'),
                    usernameGroup: document.getElementById('usernameGroup'),
                    searchModal: document.getElementById('searchModal'),
                    searchInput: document.getElementById('searchInput'),
                    searchResults: document.getElementById('searchResults'),
                    closeSearch: document.querySelector('.close-search'),
                    searchBtn: document.getElementById('searchBtn'),
                    notification: document.getElementById('notification'),
                    notificationTitle: document.getElementById('notificationTitle'),
                    notificationMessage: document.getElementById('notificationMessage'),
                    menuToggle: document.getElementById('menuToggle'),
                    sidebar: document.getElementById('sidebar'),
                    sidebarOverlay: document.getElementById('sidebarOverlay'),
                    bottomNav: document.getElementById('bottomNav'),
                    themeToggleSidebar: document.getElementById('themeToggleSidebar'),
                    phoneNumberDisplay: document.getElementById('phoneNumber'),
                    callBtn: document.getElementById('callBtn'),
                    backspaceBtn: document.getElementById('backspaceBtn'),
                    keys: document.querySelectorAll('.key'),
                    callingScreen: document.getElementById('callingScreen'),
                    callerName: document.getElementById('callerName'),
                    callerAvatar: document.getElementById('callerAvatar'),
                    callStatus: document.getElementById('callStatus'),
                    callTimer: document.getElementById('callTimer'),
                    endCallBtn: document.getElementById('endCall'),
                    muteCallBtn: document.getElementById('muteCall'),
                    speakerCallBtn: document.getElementById('speakerCall'),
                    createPostBtn: document.getElementById('createPostBtn'),
                    postCreationModal: document.getElementById('postCreationModal'),
                    postTextarea: document.getElementById('postTextarea'),
                    postMediaPreview: document.getElementById('postMediaPreview'),
                    voiceRecorder: document.getElementById('voiceRecorder'),
                    recordBtn: document.getElementById('recordBtn'),
                    voiceVisualizer: document.getElementById('voiceVisualizer'),
                    voiceDuration: document.getElementById('voiceDuration'),
                    addPhotoBtn: document.getElementById('addPhotoBtn'),
                    addVoiceBtn: document.getElementById('addVoiceBtn'),
                    postSubmitBtn: document.getElementById('postSubmitBtn'),
                    closePostModal: document.querySelector('.close-post-modal'),
                    postFeed: document.getElementById('postFeed'),
                    userName: document.getElementById('userName'),
                    userHandle: document.getElementById('userHandle'),
                    userAvatar: document.getElementById('userAvatar'),
                    currentUserAvatar: document.getElementById('currentUserAvatar'),
                    logoutBtn: document.getElementById('logoutBtn'),
                    updateProfilePicture: document.getElementById('updateProfilePicture'),
                    profilePictureUpload: document.getElementById('profilePictureUpload'),
                    profilePreview: document.getElementById('profilePreview'),
                    cancelUpload: document.getElementById('cancelUpload'),
                    confirmUpload: document.getElementById('confirmUpload'),
                    suggestedUsers: document.getElementById('suggestedUsers'),
                    seeAllUsers: document.getElementById('seeAllUsers'),
                    notificationsBtn: document.getElementById('notificationsBtn'),
                    // New profile elements
                    profileEditModal: document.getElementById('profileEditModal'),
                    editProfilePreview: document.getElementById('editProfilePreview'),
                    changePhotoBtn: document.getElementById('changePhotoBtn'),
                    profileEditForm: document.getElementById('profileEditForm'),
                    editFullName: document.getElementById('editFullName'),
                    editUsername: document.getElementById('editUsername'),
                    editBio: document.getElementById('editBio'),
                    usernameEditInfo: document.getElementById('usernameEditInfo'),
                    usernameChangesLeft: document.getElementById('usernameChangesLeft'),
                    cancelProfileEdit: document.getElementById('cancelProfileEdit'),
                    saveProfileChanges: document.getElementById('saveProfileChanges'),
                    profilePage: document.getElementById('profilePage'),
                    profileHeaderAvatar: document.getElementById('profileHeaderAvatar'),
                    profileHeaderName: document.getElementById('profileHeaderName'),
                    profileHeaderUsername: document.getElementById('profileHeaderUsername'),
                    profileBio: document.getElementById('profileBio'),
                    profilePostsCount: document.getElementById('profilePostsCount'),
                    profileFollowersCount: document.getElementById('profileFollowersCount'),
                    profileFollowingCount: document.getElementById('profileFollowingCount'),
                    profileVerifiedBadge: document.getElementById('profileVerifiedBadge'),
                    editProfileBtn: document.getElementById('editProfileBtn'),
                    followProfileBtn: document.getElementById('followProfileBtn'),
                    profilePostsTab: document.getElementById('profilePostsTab'),
                    profileFollowersTab: document.getElementById('profileFollowersTab'),
                    profileFollowingTab: document.getElementById('profileFollowingTab'),
                    profilePostsGrid: document.getElementById('profilePostsGrid'),
                    profileFollowersList: document.getElementById('profileFollowersList'),
                    profileFollowingList: document.getElementById('profileFollowingList'),
                    findFriendsPage: document.getElementById('findFriendsPage'),
                    friendsSearchInput: document.getElementById('friendsSearchInput'),
                    friendsFilterBtn: document.getElementById('friendsFilterBtn'),
                    friendsFilterOptions: document.getElementById('friendsFilterOptions'),
                    friendsList: document.getElementById('friendsList')
                };
            }

            setupEventListeners() {
                // Auth Events
                this.elements.toggleAuth.addEventListener('click', () => this.toggleAuthForm());
                this.elements.authForm.addEventListener('submit', (e) => this.handleAuthSubmit(e));
                this.elements.logoutBtn.addEventListener('click', (e) => this.handleLogout(e));

                // Navigation Events
                this.elements.menuToggle.addEventListener('click', () => this.toggleSidebar());
                this.elements.sidebarOverlay.addEventListener('click', () => this.toggleSidebar());
                this.elements.themeToggleSidebar.addEventListener('click', () => this.toggleTheme());

                // Bottom nav scroll behavior
                let lastScrollTop = 0;
                window.addEventListener('scroll', () => {
                    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    if (scrollTop > lastScrollTop && scrollTop > 100) {
                        this.elements.bottomNav.classList.add('hidden');
                    } else {
                        this.elements.bottomNav.classList.remove('hidden');
                    }
                    lastScrollTop = scrollTop;
                });

                // Page navigation
                document.querySelectorAll('.nav-item, .sidebar-link').forEach(item => {
                    item.addEventListener('click', (e) => {
                        if (item.getAttribute('href') === '#' || item.hasAttribute('data-page')) {
                            e.preventDefault();
                        }
                        const page = item.getAttribute('data-page');
                        if (page) {
                            this.navigateToPage(page);
                        }
                    });
                });

                // Keypad Events
                this.elements.keys.forEach(key => {
                    key.addEventListener('click', () => {
                        const number = key.getAttribute('data-number');
                        this.handleKeyPress(number);
                    });
                });

                this.elements.backspaceBtn.addEventListener('click', () => this.handleBackspace());
                this.elements.callBtn.addEventListener('click', () => this.handleCall());

                // Call Controls
                this.elements.endCallBtn.addEventListener('click', () => this.endCall());
                this.elements.muteCallBtn.addEventListener('click', () => this.toggleMute());
                this.elements.speakerCallBtn.addEventListener('click', () => this.toggleSpeaker());

                // Search Events
                this.elements.searchBtn.addEventListener('click', () => this.toggleSearchModal());
                this.elements.closeSearch.addEventListener('click', () => this.toggleSearchModal());
                this.elements.searchInput.addEventListener('input', (e) => this.handleSearch(e));

                // Post Creation Events
                this.elements.createPostBtn.addEventListener('click', () => this.togglePostCreationModal());
                this.elements.closePostModal.addEventListener('click', () => this.togglePostCreationModal());
                this.elements.postTextarea.addEventListener('input', () => this.updatePostButtonState());
                this.elements.addPhotoBtn.addEventListener('click', () => this.handleAddPhoto());
                this.elements.addVoiceBtn.addEventListener('click', () => this.toggleVoiceRecording());
                this.elements.postSubmitBtn.addEventListener('click', () => this.createPost());
                this.elements.recordBtn.addEventListener('click', () => this.toggleVoiceRecording());

                // Profile Picture Events
                this.elements.updateProfilePicture.addEventListener('click', (e) => {
                    e.preventDefault();
                    this.openProfilePictureUpload();
                });
                this.elements.cancelUpload.addEventListener('click', () => this.closeProfilePictureUpload());
                this.elements.confirmUpload.addEventListener('click', () => this.uploadProfilePicture());

                // Profile Edit Events
                this.elements.editProfileBtn.addEventListener('click', () => this.openProfileEditModal());
                this.elements.cancelProfileEdit.addEventListener('click', () => this.closeProfileEditModal());
                this.elements.profileEditForm.addEventListener('submit', (e) => this.saveProfileChanges(e));
                this.elements.changePhotoBtn.addEventListener('click', () => this.changeProfilePicture());

                // Profile Tab Events
                document.querySelectorAll('.profile-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabName = tab.getAttribute('data-tab');
                        this.switchProfileTab(tabName);
                    });
                });

                // Find Friends Events
                this.elements.friendsSearchInput.addEventListener('input', (e) => this.handleFriendsSearch(e));
                this.elements.friendsFilterBtn.addEventListener('click', () => this.toggleFriendsFilter());
                document.querySelectorAll('.friends-filter-options input').forEach(input => {
                    input.addEventListener('change', () => this.handleFriendsFilter());
                });

                // Suggested Users
                this.elements.seeAllUsers.addEventListener('click', () => {
                    this.navigateToPage('findFriendsPage');
                });

                // Notifications
                this.elements.notificationsBtn.addEventListener('click', () => {
                    this.showNotification('Notifications', 'You have new notifications');
                });
            }

            // Permission Methods
            async requestPermissions() {
                try {
                    // Request notification permission
                    if (Notification.permission === 'default') {
                        await Notification.requestPermission();
                    }

                    // Request microphone permission
                    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                        await navigator.mediaDevices.getUserMedia({ audio: true })
                            .then(stream => {
                                console.log('Microphone permission granted');
                                stream.getTracks().forEach(track => track.stop());
                            })
                            .catch(err => {
                                console.log('Microphone permission denied:', err);
                            });
                    }

                    // Request camera permission
                    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                        await navigator.mediaDevices.getUserMedia({ video: true })
                            .then(stream => {
                                console.log('Camera permission granted');
                                stream.getTracks().forEach(track => track.stop());
                            })
                            .catch(err => {
                                console.log('Camera permission denied:', err);
                            });
                    }
                } catch (error) {
                    console.error('Error requesting permissions:', error);
                }
            }

            // Authentication Methods
            async checkAuthStatus() {
                return new Promise((resolve) => {
                    firebase.auth().onAuthStateChanged(async (user) => {
                        if (user) {
                            this.state.currentUser = user;
                            this.state.isLoggedIn = true;
                            await this.updateUserUI();
                            await this.loadProfileData();
                            this.hideAuthModal();
                        } else {
                            this.state.isLoggedIn = false;
                            this.state.currentUser = null;
                            this.showAuthModal();
                        }
                        resolve();
                    });
                });
            }

            async handleAuthSubmit(e) {
                e.preventDefault();
                
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                try {
                    let userCredential;
                    
                    if (this.elements.authTitle.textContent === 'Create Account') {
                        const fullName = document.getElementById('fullName').value;
                        const username = document.getElementById('username').value;
                        
                        userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                        
                        // Initialize profile data
                        this.state.profileData = {
                            usernameChanges: 0,
                            lastUsernameChange: null,
                            bio: '',
                            verified: false,
                            followers: [],
                            following: []
                        };
                        
                        await firebase.firestore().collection('users').doc(userCredential.user.uid).set({
                            name: fullName,
                            username: username,
                            email: email,
                            profileData: this.state.profileData,
                            createdAt: new Date().toISOString()
                        });
                    } else {
                        userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                    }
                    
                    this.showNotification('Success', `Welcome ${this.elements.authTitle.textContent === 'Create Account' ? 'to ConnectX' : 'back'}!`);
                    this.elements.authForm.reset();
                } catch (error) {
                    this.showNotification('Error', error.message);
                }
            }

            async handleLogout(e) {
                e.preventDefault();
                if (confirm('Are you sure you want to logout?')) {
                    await firebase.auth().signOut();
                    this.showNotification('Logged Out', 'You have been successfully logged out.');
                    this.state.posts = [];
                    this.renderPosts();
                }
            }

            // UI Methods
            toggleAuthForm() {
                if (this.elements.authTitle.textContent === 'Create Account') {
                    this.elements.authTitle.textContent = 'Sign In';
                    this.elements.authButton.textContent = 'Sign In';
                    this.elements.toggleAuth.textContent = 'Create Account';
                    this.elements.fullNameGroup.style.display = 'none';
                    this.elements.usernameGroup.style.display = 'none';
                } else {
                    this.elements.authTitle.textContent = 'Create Account';
                    this.elements.authButton.textContent = 'Create Account';
                    this.elements.toggleAuth.textContent = 'Sign In';
                    this.elements.fullNameGroup.style.display = 'block';
                    this.elements.usernameGroup.style.display = 'block';
                }
            }

            showAuthModal() {
                this.elements.authModal.classList.add('active');
            }

            hideAuthModal() {
                this.elements.authModal.classList.remove('active');
            }

            async updateUserUI() {
                if (this.state.currentUser) {
                    try {
                        const userDoc = await firebase.firestore().collection('users').doc(this.state.currentUser.uid).get();
                        if (userDoc.exists) {
                            const userData = userDoc.data();
                            this.elements.userName.textContent = userData.name;
                            this.elements.userHandle.textContent = `@${userData.username}`;
                            
                            // Set profile pictures
                            const initials = userData.name.split(' ').map(n => n[0]).join('').toUpperCase();
                            
                            if (userData.profilePicture) {
                                this.elements.userAvatar.innerHTML = `<img src="${userData.profilePicture}" alt="${userData.name}">`;
                                this.elements.currentUserAvatar.innerHTML = `<img src="${userData.profilePicture}" alt="${userData.name}">`;
                                this.elements.profilePreview.innerHTML = `<img src="${userData.profilePicture}" alt="${userData.name}">`;
                                this.elements.editProfilePreview.innerHTML = `<img src="${userData.profilePicture}" alt="${userData.name}">`;
                                this.elements.profileHeaderAvatar.innerHTML = `<img src="${userData.profilePicture}" alt="${userData.name}">`;
                            } else {
                                this.elements.userAvatar.textContent = initials;
                                this.elements.currentUserAvatar.textContent = initials;
                                this.elements.profilePreview.textContent = initials;
                                this.elements.editProfilePreview.textContent = initials;
                                this.elements.profileHeaderAvatar.textContent = initials;
                            }
                        }
                    } catch (error) {
                        console.error('Error loading user data:', error);
                    }
                }
            }

            // Navigation Methods
            navigateToPage(pageId) {
                document.querySelectorAll('.page-content, .keypad-container').forEach(page => {
                    page.classList.remove('active');
                });
                
                document.getElementById(pageId).classList.add('active');
                
                document.querySelectorAll('.nav-item, .sidebar-link').forEach(item => {
                    item.classList.remove('active');
                });
                
                document.querySelectorAll(`[data-page="${pageId}"]`).forEach(item => {
                    item.classList.add('active');
                });
                
                this.state.currentPage = pageId;
                
                if (pageId === 'homePage') {
                    this.loadHomeData();
                } else if (pageId === 'profilePage') {
                    this.loadProfilePage();
                } else if (pageId === 'findFriendsPage') {
                    this.loadFindFriendsPage();
                }
            }

            toggleSidebar() {
                this.elements.sidebar.classList.toggle('active');
                this.elements.sidebarOverlay.classList.toggle('active');
            }

            toggleSearchModal() {
                this.elements.searchModal.classList.toggle('active');
                if (this.elements.searchModal.classList.contains('active')) {
                    this.elements.searchInput.focus();
                } else {
                    this.elements.searchInput.value = '';
                    this.clearSearchResults();
                }
            }

            togglePostCreationModal() {
                this.elements.postCreationModal.classList.toggle('active');
                if (!this.elements.postCreationModal.classList.contains('active')) {
                    // Reset form when closing
                    this.elements.postTextarea.value = '';
                    this.clearMediaPreview();
                    this.stopVoiceRecording();
                    this.updatePostButtonState();
                }
            }

            // Theme Methods
            toggleTheme() {
                this.state.theme = this.state.theme === 'light' ? 'dark' : 'light';
                document.body.classList.toggle('dark-mode');
                
                const icon = this.elements.themeToggleSidebar.querySelector('i');
                const text = this.elements.themeToggleSidebar.querySelector('span');
                
                if (this.state.theme === 'dark') {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                    text.textContent = 'Light Mode';
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                    text.textContent = 'Dark Mode';
                }
                
                localStorage.setItem('theme', this.state.theme);
            }

            loadTheme() {
                const savedTheme = localStorage.getItem('theme') || 'light';
                this.state.theme = savedTheme;
                
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-mode');
                    this.elements.themeToggleSidebar.querySelector('i').classList.remove('fa-moon');
                    this.elements.themeToggleSidebar.querySelector('i').classList.add('fa-sun');
                    this.elements.themeToggleSidebar.querySelector('span').textContent = 'Light Mode';
                }
            }

            // Keypad Methods
            handleKeyPress(number) {
                this.state.phoneNumber += number;
                this.updatePhoneNumberDisplay();
                this.playKeySound(number);
            }

            handleBackspace() {
                this.state.phoneNumber = this.state.phoneNumber.slice(0, -1);
                this.updatePhoneNumberDisplay();
                this.playTone(220, 100);
            }

            updatePhoneNumberDisplay() {
                if (this.state.phoneNumber === '') {
                    this.elements.phoneNumberDisplay.textContent = 'Enter number';
                    this.elements.phoneNumberDisplay.style.color = 'var(--gray-color)';
                } else {
                    let formattedNumber = this.state.phoneNumber;
                    if (formattedNumber.length > 3 && formattedNumber.length <= 6) {
                        formattedNumber = formattedNumber.replace(/(\d{3})(\d+)/, '$1-$2');
                    } else if (formattedNumber.length > 6) {
                        formattedNumber = formattedNumber.replace(/(\d{3})(\d{3})(\d+)/, '$1-$2-$3');
                    }
                    
                    this.elements.phoneNumberDisplay.textContent = formattedNumber;
                    this.elements.phoneNumberDisplay.style.color = 'var(--text-color)';
                }
            }

            // Calling Methods
            async handleCall() {
                if (this.state.phoneNumber === '') {
                    this.showNotification('Error', 'Please enter a phone number');
                    return;
                }

                if (!this.state.isLoggedIn) {
                    this.showNotification('Authentication Required', 'Please create an account to make calls');
                    this.showAuthModal();
                    return;
                }

                await this.startCall();
            }

            async startCall() {
                this.state.isCalling = true;
                this.state.callTimer = 0;
                
                this.elements.callerName.textContent = this.state.phoneNumber;
                this.elements.callerAvatar.textContent = this.state.phoneNumber.substring(0, 2).toUpperCase();
                this.elements.callStatus.textContent = 'Calling...';
                this.elements.callTimer.textContent = '00:00';
                
                this.elements.callingScreen.classList.add('active');
                
                // Initialize Agora client for calling
                try {
                    if (typeof agoraManager !== 'undefined') {
                        this.state.agoraClient = agoraManager;
                        await agoraManager.initialize();
                        await agoraManager.joinChannel('connectx_channel', this.state.currentUser.uid);
                    }
                    
                    // Simulate call connection
                    setTimeout(() => {
                        if (this.state.isCalling) {
                            this.state.callInterval = setInterval(() => {
                                this.state.callTimer++;
                                const minutes = Math.floor(this.state.callTimer / 60).toString().padStart(2, '0');
                                const seconds = (this.state.callTimer % 60).toString().padStart(2, '0');
                                this.elements.callTimer.textContent = `${minutes}:${seconds}`;
                                this.elements.callStatus.textContent = 'Connected';
                            }, 1000);
                        }
                    }, 2000);
                } catch (error) {
                    console.error('Error initializing call:', error);
                    this.showNotification('Call Error', 'Failed to initialize call. Please try again.');
                    this.endCall();
                }
            }

            async endCall() {
                this.state.isCalling = false;
                this.elements.callingScreen.classList.remove('active');
                
                if (this.state.callInterval) {
                    clearInterval(this.state.callInterval);
                    this.state.callInterval = null;
                }
                
                // Clean up Agora resources
                if (this.state.agoraClient && typeof agoraManager !== 'undefined') {
                    await agoraManager.leaveChannel();
                    this.state.agoraClient = null;
                }
                
                const duration = this.state.callTimer > 0 ? 
                    ` (${Math.floor(this.state.callTimer / 60)}:${(this.state.callTimer % 60).toString().padStart(2, '0')})` : '';
                this.showNotification('Call Ended', `Call with ${this.state.phoneNumber} ended${duration}`);
                
                this.state.phoneNumber = '';
                this.updatePhoneNumberDisplay();
            }

            toggleMute() {
                const icon = this.elements.muteCallBtn.querySelector('i');
                if (icon.classList.contains('fa-microphone')) {
                    icon.classList.remove('fa-microphone');
                    icon.classList.add('fa-microphone-slash');
                    this.showNotification('Microphone', 'Muted');
                    
                    // Mute the audio stream
                    if (this.state.agoraClient && typeof agoraManager !== 'undefined') {
                        agoraManager.muteAudio();
                    }
                } else {
                    icon.classList.remove('fa-microphone-slash');
                    icon.classList.add('fa-microphone');
                    this.showNotification('Microphone', 'Unmuted');
                    
                    // Unmute the audio stream
                    if (this.state.agoraClient && typeof agoraManager !== 'undefined') {
                        agoraManager.unmuteAudio();
                    }
                }
            }

            toggleSpeaker() {
                const icon = this.elements.speakerCallBtn.querySelector('i');
                if (icon.classList.contains('fa-volume-up')) {
                    icon.classList.remove('fa-volume-up');
                    icon.classList.add('fa-volume-mute');
                    this.showNotification('Speaker', 'Speaker off');
                } else {
                    icon.classList.remove('fa-volume-mute');
                    icon.classList.add('fa-volume-up');
                    this.showNotification('Speaker', 'Speaker on');
                }
            }

            // Home Page Methods
            async loadHomeData() {
                await this.loadFollowing();
                await this.loadSuggestedUsers();
                await this.loadPosts();
            }

            async loadFollowing() {
                if (!this.state.currentUser) return;
                
                try {
                    const followingSnapshot = await firebase.firestore()
                        .collection('users')
                        .doc(this.state.currentUser.uid)
                        .collection('following')
                        .get();
                    
                    this.state.following = followingSnapshot.docs.map(doc => doc.id);
                } catch (error) {
                    console.error('Error loading following:', error);
                    this.state.following = [];
                }
            }

            async loadSuggestedUsers() {
                try {
                    // Get top users (verified first, then by follower count)
                    let usersQuery = firebase.firestore()
                        .collection('users')
                        .orderBy('verified', 'desc')
                        .orderBy('followerCount', 'desc')
                        .limit(10);
                    
                    const snapshot = await usersQuery.get();
                    
                    // Filter out current user and users already followed
                    this.state.suggestedUsers = snapshot.docs
                        .map(doc => ({ id: doc.id, ...doc.data() }))
                        .filter(user => 
                            user.id !== this.state.currentUser?.uid && 
                            !this.state.following.includes(user.id)
                        )
                        .slice(0, 5); // Show top 5
                    
                    this.renderSuggestedUsers();
                } catch (error) {
                    console.error('Error loading suggested users:', error);
                    // Create demo users if Firebase is not available
                    this.state.suggestedUsers = this.createDemoSuggestedUsers();
                    this.renderSuggestedUsers();
                }
            }

            createDemoSuggestedUsers() {
                return [
                    {
                        id: 'demo1',
                        name: 'Alex Johnson',
                        username: 'alexj',
                        verified: true,
                        followerCount: 1250
                    },
                    {
                        id: 'demo2',
                        name: 'Sarah Miller',
                        username: 'sarahm',
                        verified: false,
                        followerCount: 890
                    },
                    {
                        id: 'demo3',
                        name: 'Mike Thompson',
                        username: 'miket',
                        verified: true,
                        followerCount: 2100
                    },
                    {
                        id: 'demo4',
                        name: 'Emma Wilson',
                        username: 'emmaw',
                        verified: false,
                        followerCount: 540
                    }
                ];
            }

            renderSuggestedUsers() {
                if (!this.state.suggestedUsers.length) {
                    this.elements.suggestedUsers.innerHTML = `
                        <div class="section-header">
                            <div class="section-title">Suggested for you</div>
                            <div class="see-all" id="seeAllUsers">See All</div>
                        </div>
                        <p style="text-align: center; color: var(--gray-color); padding: 20px 0;">
                            No suggestions available
                        </p>
                    `;
                    return;
                }

                this.elements.suggestedUsers.innerHTML = `
                    <div class="section-header">
                        <div class="section-title">Suggested for you</div>
                        <div class="see-all" id="seeAllUsers">See All</div>
                    </div>
                    ${this.state.suggestedUsers.map(user => `
                        <div class="suggested-user" data-user-id="${user.id}">
                            ${user.profilePicture ? 
                                `<div class="user-avatar-small"><img src="${user.profilePicture}" alt="${user.name}"></div>` :
                                `<div class="user-avatar-small">${user.name ? user.name.charAt(0).toUpperCase() : 'U'}</div>`
                            }
                            <div class="suggested-user-info">
                                <h4>
                                    ${user.name}
                                    ${user.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}
                                </h4>
                                <p>@${user.username}  ${user.followerCount || 0} followers</p>
                            </div>
                            <button class="follow-btn" data-user-id="${user.id}">Follow</button>
                        </div>
                    `).join('')}
                `;

                // Add event listeners to follow buttons
                this.elements.suggestedUsers.querySelectorAll('.follow-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const userId = btn.getAttribute('data-user-id');
                        this.handleFollowUser(userId, btn);
                    });
                });

                // Re-attach event listener to see all
                this.elements.seeAllUsers = document.getElementById('seeAllUsers');
                this.elements.seeAllUsers.addEventListener('click', () => {
                    this.navigateToPage('findFriendsPage');
                });
            }

            // Profile Methods
            async loadProfileData() {
                if (!this.state.currentUser) return;
                
                try {
                    const userDoc = await firebase.firestore().collection('users').doc(this.state.currentUser.uid).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        if (userData.profileData) {
                            this.state.profileData = userData.profileData;
                        }
                    }
                } catch (error) {
                    console.error('Error loading profile data:', error);
                }
            }

            async loadProfilePage() {
                if (!this.state.currentUser) return;
                
                try {
                    const userDoc = await firebase.firestore().collection('users').doc(this.state.currentUser.uid).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        
                        // Update profile header
                        this.elements.profileHeaderName.textContent = userData.name;
                        this.elements.profileHeaderUsername.textContent = `@${userData.username}`;
                        
                        if (userData.profileData && userData.profileData.bio) {
                            this.elements.profileBio.textContent = userData.profileData.bio;
                        } else {
                            this.elements.profileBio.textContent = "No bio yet.";
                        }
                        
                        if (userData.profilePicture) {
                            this.elements.profileHeaderAvatar.innerHTML = `<img src="${userData.profilePicture}" alt="${userData.name}">`;
                        } else {
                            const initials = userData.name.split(' ').map(n => n[0]).join('').toUpperCase();
                            this.elements.profileHeaderAvatar.textContent = initials;
                        }
                        
                        // Show verified badge if user is verified
                        if (userData.verified) {
                            this.elements.profileVerifiedBadge.style.display = 'inline';
                        } else {
                            this.elements.profileVerifiedBadge.style.display = 'none';
                        }
                        
                        // Load profile stats
                        await this.loadProfileStats();
                        
                        // Load profile posts
                        await this.loadProfilePosts();
                        
                        // Load followers and following
                        await this.loadProfileFollowers();
                        await this.loadProfileFollowing();
                    }
                } catch (error) {
                    console.error('Error loading profile page:', error);
                }
            }

            async loadProfileStats() {
                if (!this.state.currentUser) return;
                
                try {
                    // Get posts count
                    const postsSnapshot = await firebase.firestore()
                        .collection('posts')
                        .where('authorId', '==', this.state.currentUser.uid)
                        .get();
                    
                    this.elements.profilePostsCount.textContent = postsSnapshot.size;
                    
                    // Get followers count
                    const followersSnapshot = await firebase.firestore()
                        .collection('users')
                        .doc(this.state.currentUser.uid)
                        .collection('followers')
                        .get();
                    
                    this.elements.profileFollowersCount.textContent = followersSnapshot.size;
                    
                    // Get following count
                    const followingSnapshot = await firebase.firestore()
                        .collection('users')
                        .doc(this.state.currentUser.uid)
                        .collection('following')
                        .get();
                    
                    this.elements.profileFollowingCount.textContent = followingSnapshot.size;
                } catch (error) {
                    console.error('Error loading profile stats:', error);
                }
            }

            async loadProfilePosts() {
                if (!this.state.currentUser) return;
                
                try {
                    const postsSnapshot = await firebase.firestore()
                        .collection('posts')
                        .where('authorId', '==', this.state.currentUser.uid)
                        .orderBy('createdAt', 'desc')
                        .limit(9)
                        .get();
                    
                    this.elements.profilePostsGrid.innerHTML = '';
                    
                    if (postsSnapshot.empty) {
                        this.elements.profilePostsGrid.innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gray-color);">
                                <i class="fas fa-camera" style="font-size: 40px; margin-bottom: 10px;"></i>
                                <p>No posts yet</p>
                            </div>
                        `;
                        return;
                    }
                    
                    postsSnapshot.docs.forEach(doc => {
                        const post = doc.data();
                        const postElement = document.createElement('div');
                        postElement.className = 'profile-post-thumb';
                        
                        if (post.imageUrl) {
                            postElement.innerHTML = `<img src="${post.imageUrl}" alt="Post image">`;
                        } else if (post.videoUrl) {
                            postElement.innerHTML = `<i class="fas fa-play"></i>`;
                        } else if (post.voiceUrl) {
                            postElement.innerHTML = `<i class="fas fa-microphone"></i>`;
                        } else {
                            postElement.innerHTML = `<i class="fas fa-file-alt"></i>`;
                        }
                        
                        this.elements.profilePostsGrid.appendChild(postElement);
                    });
                } catch (error) {
                    console.error('Error loading profile posts:', error);
                }
            }

            async loadProfileFollowers() {
                if (!this.state.currentUser) return;
                
                try {
                    const followersSnapshot = await firebase.firestore()
                        .collection('users')
                        .doc(this.state.currentUser.uid)
                        .collection('followers')
                        .get();
                    
                    this.elements.profileFollowersList.innerHTML = '';
                    
                    if (followersSnapshot.empty) {
                        this.elements.profileFollowersList.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: var(--gray-color);">
                                <p>No followers yet</p>
                            </div>
                        `;
                        return;
                    }
                    
                    // Get user details for each follower
                    for (const doc of followersSnapshot.docs) {
                        const followerId = doc.id;
                        const followerDoc = await firebase.firestore().collection('users').doc(followerId).get();
                        
                        if (followerDoc.exists) {
                            const followerData = followerDoc.data();
                            const followerElement = document.createElement('div');
                            followerElement.className = 'follower-item';
                            
                            const avatarContent = followerData.profilePicture ? 
                                `<div class="user-avatar-small"><img src="${followerData.profilePicture}" alt="${followerData.name}"></div>` :
                                `<div class="user-avatar-small">${followerData.name ? followerData.name.charAt(0).toUpperCase() : 'U'}</div>`;
                            
                            followerElement.innerHTML = `
                                ${avatarContent}
                                <div class="suggested-user-info">
                                    <h4>
                                        ${followerData.name}
                                        ${followerData.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}
                                    </h4>
                                    <p>@${followerData.username}</p>
                                </div>
                                <button class="follow-btn following" data-user-id="${followerId}">Following</button>
                            `;
                            
                            this.elements.profileFollowersList.appendChild(followerElement);
                        }
                    }
                    
                    // Add event listeners to follow buttons
                    this.elements.profileFollowersList.querySelectorAll('.follow-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const userId = btn.getAttribute('data-user-id');
                            this.handleFollowUser(userId, btn);
                        });
                    });
                } catch (error) {
                    console.error('Error loading profile followers:', error);
                }
            }

            async loadProfileFollowing() {
                if (!this.state.currentUser) return;
                
                try {
                    const followingSnapshot = await firebase.firestore()
                        .collection('users')
                        .doc(this.state.currentUser.uid)
                        .collection('following')
                        .get();
                    
                    this.elements.profileFollowingList.innerHTML = '';
                    
                    if (followingSnapshot.empty) {
                        this.elements.profileFollowingList.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: var(--gray-color);">
                                <p>Not following anyone yet</p>
                            </div>
                        `;
                        return;
                    }
                    
                    // Get user details for each followed user
                    for (const doc of followingSnapshot.docs) {
                        const followingId = doc.id;
                        const followingDoc = await firebase.firestore().collection('users').doc(followingId).get();
                        
                        if (followingDoc.exists) {
                            const followingData = followingDoc.data();
                            const followingElement = document.createElement('div');
                            followingElement.className = 'following-item';
                            
                            const avatarContent = followingData.profilePicture ? 
                                `<div class="user-avatar-small"><img src="${followingData.profilePicture}" alt="${followingData.name}"></div>` :
                                `<div class="user-avatar-small">${followingData.name ? followingData.name.charAt(0).toUpperCase() : 'U'}</div>`;
                            
                            followingElement.innerHTML = `
                                ${avatarContent}
                                <div class="suggested-user-info">
                                    <h4>
                                        ${followingData.name}
                                        ${followingData.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}
                                    </h4>
                                    <p>@${followingData.username}</p>
                                </div>
                                <button class="follow-btn following" data-user-id="${followingId}">Following</button>
                            `;
                            
                            this.elements.profileFollowingList.appendChild(followingElement);
                        }
                    }
                    
                    // Add event listeners to follow buttons
                    this.elements.profileFollowingList.querySelectorAll('.follow-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            const userId = btn.getAttribute('data-user-id');
                            this.handleFollowUser(userId, btn);
                        });
                    });
                } catch (error) {
                    console.error('Error loading profile following:', error);
                }
            }

            switchProfileTab(tabName) {
                // Update active tab
                document.querySelectorAll('.profile-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                document.querySelector(`.profile-tab[data-tab="${tabName}"]`).classList.add('active');
                
                // Show active tab content
                document.querySelectorAll('.profile-tab-pane').forEach(pane => {
                    pane.classList.remove('active');
                });
                
                document.getElementById(`profile${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`).classList.add('active');
            }

            openProfileEditModal() {
                if (!this.state.currentUser) return;
                
                // Load current user data into form
                firebase.firestore().collection('users').doc(this.state.currentUser.uid).get()
                    .then(doc => {
                        if (doc.exists) {
                            const userData = doc.data();
                            this.elements.editFullName.value = userData.name || '';
                            this.elements.editUsername.value = userData.username || '';
                            
                            if (userData.profileData && userData.profileData.bio) {
                                this.elements.editBio.value = userData.profileData.bio;
                            } else {
                                this.elements.editBio.value = '';
                            }
                            
                            // Update username change info
                            this.updateUsernameChangeInfo();
                            
                            // Show modal
                            this.elements.profileEditModal.classList.add('active');
                        }
                    })
                    .catch(error => {
                        console.error('Error loading user data for edit:', error);
                    });
            }

            closeProfileEditModal() {
                this.elements.profileEditModal.classList.remove('active');
            }

            updateUsernameChangeInfo() {
                const changesLeft = 2 - this.state.profileData.usernameChanges;
                this.elements.usernameChangesLeft.textContent = `${changesLeft} changes left`;
                
                if (changesLeft <= 0) {
                    this.elements.usernameEditInfo.style.backgroundColor = 'rgba(247, 37, 133, 0.1)';
                    this.elements.usernameEditInfo.style.color = 'var(--warning-color)';
                    this.elements.editUsername.disabled = true;
                    this.elements.usernameEditInfo.innerHTML = 'You have reached your username change limit for 6 months.';
                } else {
                    this.elements.usernameEditInfo.style.backgroundColor = 'rgba(67, 97, 238, 0.1)';
                    this.elements.usernameEditInfo.style.color = 'var(--primary-color)';
                    this.elements.editUsername.disabled = false;
                }
            }

            async saveProfileChanges(e) {
                e.preventDefault();
                
                if (!this.state.currentUser) return;
                
                const fullName = this.elements.editFullName.value.trim();
                const username = this.elements.editUsername.value.trim();
                const bio = this.elements.editBio.value.trim();
                
                if (!fullName || !username) {
                    this.showNotification('Error', 'Please fill in all required fields');
                    return;
                }
                
                try {
                    const updateData = {
                        name: fullName
                    };
                    
                    // Check if username is being changed
                    const userDoc = await firebase.firestore().collection('users').doc(this.state.currentUser.uid).get();
                    const currentUsername = userDoc.data().username;
                    
                    if (username !== currentUsername) {
                        // Check if username change is allowed
                        if (this.state.profileData.usernameChanges >= 2) {
                            this.showNotification('Error', 'You have reached your username change limit for 6 months');
                            return;
                        }
                        
                        // Check if username is available
                        const usernameCheck = await firebase.firestore()
                            .collection('users')
                            .where('username', '==', username)
                            .get();
                            
                        if (!usernameCheck.empty && usernameCheck.docs[0].id !== this.state.currentUser.uid) {
                            this.showNotification('Error', 'Username is already taken');
                            return;
                        }
                        
                        updateData.username = username;
                        
                        // Update username change tracking
                        this.state.profileData.usernameChanges += 1;
                        this.state.profileData.lastUsernameChange = new Date().toISOString();
                    }
                    
                    // Update bio in profile data
                    this.state.profileData.bio = bio;
                    updateData.profileData = this.state.profileData;
                    
                    // Save to Firestore
                    await firebase.firestore().collection('users').doc(this.state.currentUser.uid).update(updateData);
                    
                    // Update UI
                    await this.updateUserUI();
                    await this.loadProfilePage();
                    
                    // Close modal
                    this.closeProfileEditModal();
                    
                    this.showNotification('Success', 'Profile updated successfully');
                } catch (error) {
                    console.error('Error updating profile:', error);
                    this.showNotification('Error', 'Failed to update profile');
                }
            }

            changeProfilePicture() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        this.state.profilePictureFile = file;
                        
                        // Preview image
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.elements.editProfilePreview.innerHTML = `<img src="${e.target.result}" alt="Profile Preview">`;
                        };
                        reader.readAsDataURL(file);
                    }
                };
                input.click();
            }

            // Find Friends Methods
            async loadFindFriendsPage() {
                await this.loadFriendsList();
            }

            async loadFriendsList() {
                try {
                    // Get users (excluding current user)
                    let usersQuery = firebase.firestore()
                        .collection('users')
                        .where('username', '!=', this.state.currentUser?.uid)
                        .limit(20);
                    
                    const snapshot = await usersQuery.get();
                    
                    const users = snapshot.docs
                        .map(doc => ({ id: doc.id, ...doc.data() }))
                        .filter(user => user.id !== this.state.currentUser?.uid);
                    
                    this.renderFriendsList(users);
                } catch (error) {
                    console.error('Error loading friends list:', error);
                    // Create demo users if Firebase is not available
                    const demoUsers = this.createDemoSuggestedUsers();
                    this.renderFriendsList(demoUsers);
                }
            }

            renderFriendsList(users) {
                if (!users.length) {
                    this.elements.friendsList.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--gray-color);">
                            <p>No users found</p>
                        </div>
                    `;
                    return;
                }

                this.elements.friendsList.innerHTML = users.map(user => `
                    <div class="user-result" data-user-id="${user.id}">
                        ${user.profilePicture ? 
                            `<div class="user-avatar-small"><img src="${user.profilePicture}" alt="${user.name}"></div>` :
                            `<div class="user-avatar-small">${user.name ? user.name.charAt(0).toUpperCase() : 'U'}</div>`
                        }
                        <div class="user-result-info">
                            <h4>
                                ${user.name}
                                ${user.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}
                            </h4>
                            <p>@${user.username}  ${user.followerCount || 0} followers</p>
                        </div>
                        <button class="follow-btn ${this.state.following.includes(user.id) ? 'following' : ''}" data-user-id="${user.id}">
                            ${this.state.following.includes(user.id) ? 'Following' : 'Follow'}
                        </button>
                    </div>
                `).join('');

                // Add event listeners to follow buttons
                this.elements.friendsList.querySelectorAll('.follow-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const userId = btn.getAttribute('data-user-id');
                        this.handleFollowUser(userId, btn);
                    });
                });

                // Add event listeners to user results
                this.elements.friendsList.querySelectorAll('.user-result').forEach(result => {
                    result.addEventListener('click', () => {
                        const userId = result.getAttribute('data-user-id');
                        // In a real app, this would navigate to the user's profile
                        this.showNotification('Profile', `Viewing ${userId}'s profile`);
                    });
                });
            }

            handleFriendsSearch(e) {
                const query = e.target.value.trim().toLowerCase();
                
                if (query.length < 2) {
                    this.loadFriendsList();
                    return;
                }

                // Filter existing users by query
                const filteredUsers = this.state.suggestedUsers.filter(user => 
                    user.name.toLowerCase().includes(query) || 
                    user.username.toLowerCase().includes(query)
                );
                
                this.renderFriendsList(filteredUsers);
            }

            toggleFriendsFilter() {
                this.elements.friendsFilterOptions.classList.toggle('active');
            }

            handleFriendsFilter() {
                // In a real app, this would apply filters to the friends list
                this.showNotification('Filter Applied', 'Filters have been applied to your search');
            }

            // Post Methods
            async loadInitialData() {
                await this.loadPosts();
                this.loadTheme();
                this.initAudio();
            }

            async loadPosts() {
                try {
                    let postsQuery = firebase.firestore()
                        .collection('posts')
                        .orderBy('createdAt', 'desc')
                        .limit(20);

                    // If user is following people, show their posts
                    if (this.state.following.length > 0) {
                        postsQuery = postsQuery.where('authorId', 'in', this.state.following);
                    } else {
                        // For new users, show some demo posts
                        postsQuery = postsQuery.limit(5);
                    }

                    const snapshot = await postsQuery.get();
                    
                    this.state.posts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    this.renderPosts();
                } catch (error) {
                    console.error('Error loading posts:', error);
                    // Create demo posts if Firebase is not available
                    this.state.posts = this.createDemoPosts();
                    this.renderPosts();
                }
            }

            createDemoPosts() {
                return [
                    {
                        id: 'demo1',
                        content: 'Welcome to ConnectX! Start connecting with your friends and family.\n\nThis is a multi-line post to demonstrate the improved text display.',
                        authorName: 'ConnectX Team',
                        authorId: 'admin',
                        authorProfilePicture: null,
                        createdAt: new Date().toISOString(),
                        likes: 15,
                        comments: 3,
                        shares: 2,
                        liked: false
                    },
                    {
                        id: 'demo2',
                        content: 'Just made my first call with ConnectX. The audio quality is amazing! The interface is so intuitive and user-friendly.',
                        authorName: 'Alex Johnson',
                        authorId: 'demo2',
                        authorProfilePicture: null,
                        createdAt: new Date(Date.now() - 3600000).toISOString(),
                        likes: 8,
                        comments: 1,
                        shares: 0,
                        liked: false
                    }
                ];
            }

            renderPosts() {
                if (!this.state.posts.length) {
                    this.elements.postFeed.innerHTML = `
                        <div class="post">
                            <div class="post-content">
                                <p class="post-text">No posts yet. Follow people to see their posts or be the first to share something!</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                this.elements.postFeed.innerHTML = this.state.posts.map(post => `
                    <div class="post" data-post-id="${post.id}">
                        <div class="post-header">
                            ${post.authorProfilePicture ? 
                                `<div class="post-avatar"><img src="${post.authorProfilePicture}" alt="${post.authorName}"></div>` :
                                `<div class="post-avatar">${post.authorName ? post.authorName.charAt(0).toUpperCase() : 'U'}</div>`
                            }
                            <div class="post-user-info">
                                <h4>${post.authorName || 'Unknown User'}</h4>
                                <p>${this.formatTime(post.createdAt)}</p>
                            </div>
                            <div class="post-options">
                                <i class="fas fa-ellipsis-h"></i>
                            </div>
                        </div>
                        <div class="post-content">
                            <p class="post-text">${post.content || ''}</p>
                            ${post.imageUrl ? `<img src="${post.imageUrl}" alt="Post image" class="post-image">` : ''}
                            ${post.videoUrl ? `<video controls class="post-image"><source src="${post.videoUrl}" type="video/mp4"></video>` : ''}
                            ${post.voiceUrl ? `
                                <div class="voice-note">
                                    <div class="play-btn">
                                        <i class="fas fa-play"></i>
                                    </div>
                                    <div class="waveform"></div>
                                    <div class="voice-duration">${post.voiceDuration || '1:25'}</div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="post-stats">
                            <span>${post.likes || 0} likes</span>
                            <span>${post.comments || 0} comments</span>
                            <span>${post.shares || 0} shares</span>
                        </div>
                        <div class="post-actions-bar">
                            <div class="post-action-btn like-btn ${post.liked ? 'active' : ''}">
                                <i class="${post.liked ? 'fas' : 'far'} fa-thumbs-up"></i>
                                <span>Like</span>
                            </div>
                            <div class="post-action-btn comment-btn">
                                <i class="far fa-comment"></i>
                                <span>Comment</span>
                            </div>
                            <div class="post-action-btn share-btn">
                                <i class="fas fa-share"></i>
                                <span>Share</span>
                            </div>
                        </div>
                        <div class="comments-section" id="comments-${post.id}">
                            <!-- Comments will be loaded here -->
                        </div>
                    </div>
                `).join('');

                // Add event listeners
                this.addPostEventListeners();
            }

            addPostEventListeners() {
                // Like buttons
                this.elements.postFeed.querySelectorAll('.like-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postElement = e.target.closest('.post');
                        const postId = postElement.getAttribute('data-post-id');
                        this.handleLikePost(postId, btn);
                    });
                });

                // Comment buttons
                this.elements.postFeed.querySelectorAll('.comment-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postElement = e.target.closest('.post');
                        const postId = postElement.getAttribute('data-post-id');
                        this.toggleComments(postId);
                    });
                });

                // Share buttons
                this.elements.postFeed.querySelectorAll('.share-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postElement = e.target.closest('.post');
                        const postId = postElement.getAttribute('data-post-id');
                        this.handleSharePost(postId);
                    });
                });

                // Voice play buttons
                this.elements.postFeed.querySelectorAll('.play-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const waveform = this.nextElementSibling;
                        const isPlaying = waveform.style.animationPlayState === 'paused';
                        
                        if (isPlaying) {
                            waveform.style.animationPlayState = 'running';
                            this.innerHTML = '<i class="fas fa-pause"></i>';
                        } else {
                            waveform.style.animationPlayState = 'paused';
                            this.innerHTML = '<i class="fas fa-play"></i>';
                        }
                    });
                });
            }

            // Post Creation Methods
            updatePostButtonState() {
                const hasContent = this.elements.postTextarea.value.trim() !== '' || 
                                 this.state.mediaFile !== null || 
                                 this.state.audioChunks.length > 0;
                
                this.elements.postSubmitBtn.disabled = !hasContent;
            }

            handleAddPhoto() {
                // Stop recording if in progress
                if (this.state.isRecording) {
                    this.stopVoiceRecording();
                }
                
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        this.previewMedia(file);
                    }
                };
                input.click();
            }

            previewMedia(file) {
                this.state.mediaFile = file;
                
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.elements.postMediaPreview.innerHTML = `
                            <div class="post-media-preview">
                                <img src="${e.target.result}" alt="Preview">
                                <div class="remove-media" onclick="connectXApp.clearMediaPreview()">
                                    <i class="fas fa-times"></i>
                                </div>
                            </div>
                        `;
                    };
                    reader.readAsDataURL(file);
                } else if (file.type.startsWith('video/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.elements.postMediaPreview.innerHTML = `
                            <div class="post-media-preview">
                                <video controls>
                                    <source src="${e.target.result}" type="${file.type}">
                                </video>
                                <div class="remove-media" onclick="connectXApp.clearMediaPreview()">
                                    <i class="fas fa-times"></i>
                                </div>
                            </div>
                        `;
                    };
                    reader.readAsDataURL(file);
                }
                
                this.updatePostButtonState();
            }

            clearMediaPreview() {
                this.elements.postMediaPreview.innerHTML = '';
                this.state.mediaFile = null;
                this.updatePostButtonState();
            }

            async toggleVoiceRecording() {
                if (this.state.isRecording) {
                    this.stopVoiceRecording();
                } else {
                    // Clear any existing media
                    this.clearMediaPreview();
                    await this.startVoiceRecording();
                }
            }

            async startVoiceRecording() {
                try {
                    // Request microphone permission
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    
                    // Initialize MediaRecorder
                    this.state.mediaRecorder = new MediaRecorder(stream);
                    this.state.audioChunks = [];
                    
                    this.state.mediaRecorder.ondataavailable = (event) => {
                        if (event.data.size > 0) {
                            this.state.audioChunks.push(event.data);
                        }
                    };
                    
                    this.state.mediaRecorder.onstop = () => {
                        // Create audio blob
                        const audioBlob = new Blob(this.state.audioChunks, { type: 'audio/wav' });
                        this.state.mediaFile = audioBlob;
                        
                        // Create a URL for the audio blob
                        const audioUrl = URL.createObjectURL(audioBlob);
                        
                        // Show audio preview
                        this.elements.postMediaPreview.innerHTML = `
                            <div class="voice-note">
                                <div class="play-btn">
                                    <i class="fas fa-play"></i>
                                </div>
                                <div class="waveform"></div>
                                <div class="voice-duration">${this.elements.voiceDuration.textContent}</div>
                                <div class="remove-media" onclick="connectXApp.clearMediaPreview()">
                                    <i class="fas fa-times"></i>
                                </div>
                            </div>
                            <audio id="audioPreview" src="${audioUrl}"></audio>
                        `;
                        
                        // Add event listener to play button
                        const playBtn = this.elements.postMediaPreview.querySelector('.play-btn');
                        const audioElement = document.getElementById('audioPreview');
                        
                        playBtn.addEventListener('click', () => {
                            if (audioElement.paused) {
                                audioElement.play();
                                playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                            } else {
                                audioElement.pause();
                                playBtn.innerHTML = '<i class="fas fa-play"></i>';
                            }
                        });
                        
                        audioElement.addEventListener('ended', () => {
                            playBtn.innerHTML = '<i class="fas fa-play"></i>';
                        });
                        
                        // Stop all tracks
                        stream.getTracks().forEach(track => track.stop());
                        
                        this.updatePostButtonState();
                    };
                    
                    // Start recording
                    this.state.mediaRecorder.start();
                    this.state.isRecording = true;
                    this.elements.recordBtn.classList.add('recording');
                    this.elements.voiceRecorder.classList.add('recording');
                    this.elements.recordBtn.innerHTML = '<i class="fas fa-stop"></i>';
                    
                    // Start timer
                    this.state.recordingStartTime = Date.now();
                    this.state.recordingTimer = setInterval(() => {
                        const elapsed = Math.floor((Date.now() - this.state.recordingStartTime) / 1000);
                        const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                        const seconds = (elapsed % 60).toString().padStart(2, '0');
                        this.elements.voiceDuration.textContent = `${minutes}:${seconds}`;
                        
                        // Update visualizer
                        this.updateVoiceVisualizer();
                    }, 1000);
                    
                } catch (error) {
                    console.error('Error starting voice recording:', error);
                    this.showNotification('Recording Error', 'Could not access microphone. Please check permissions.');
                }
            }

            stopVoiceRecording() {
                if (this.state.mediaRecorder && this.state.isRecording) {
                    this.state.mediaRecorder.stop();
                    this.state.isRecording = false;
                    this.elements.recordBtn.classList.remove('recording');
                    this.elements.voiceRecorder.classList.remove('recording');
                    this.elements.recordBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                    
                    // Clear timer
                    if (this.state.recordingTimer) {
                        clearInterval(this.state.recordingTimer);
                        this.state.recordingTimer = null;
                    }
                    
                    // Reset visualizer
                    this.resetVoiceVisualizer();
                }
            }

            updateVoiceVisualizer() {
                // Create random bars for visualization
                const barCount = 20;
                let visualizerHTML = '';
                
                for (let i = 0; i < barCount; i++) {
                    const height = Math.floor(Math.random() * 30) + 5;
                    visualizerHTML += `<div class="voice-bar" style="height: ${height}px;"></div>`;
                }
                
                this.elements.voiceVisualizer.innerHTML = visualizerHTML;
            }

            resetVoiceVisualizer() {
                this.elements.voiceVisualizer.innerHTML = '';
                this.elements.voiceDuration.textContent = '00:00';
            }

            async createPost() {
                const content = this.elements.postTextarea.value.trim();
                if ((!content && !this.state.mediaFile) || !this.state.isLoggedIn) return;

                try {
                    const postData = {
                        content: content,
                        authorId: this.state.currentUser.uid,
                        authorName: this.elements.userName.textContent,
                        createdAt: new Date().toISOString(),
                        likes: 0,
                        comments: 0,
                        shares: 0
                    };

                    // Get user profile picture for the post
                    const userDoc = await firebase.firestore().collection('users').doc(this.state.currentUser.uid).get();
                    if (userDoc.exists && userDoc.data().profilePicture) {
                        postData.authorProfilePicture = userDoc.data().profilePicture;
                    }

                    // Handle media upload if present
                    if (this.state.mediaFile) {
                        const storageRef = firebase.storage().ref();
                        
                        if (this.state.mediaFile.type.startsWith('image/') || this.state.mediaFile.type.startsWith('video/')) {
                            // Image or video file
                            const fileRef = storageRef.child(`posts/${this.state.currentUser.uid}/${Date.now()}_${this.state.mediaFile.name}`);
                            await fileRef.put(this.state.mediaFile);
                            const downloadURL = await fileRef.getDownloadURL();
                            
                            if (this.state.mediaFile.type.startsWith('image/')) {
                                postData.imageUrl = downloadURL;
                            } else if (this.state.mediaFile.type.startsWith('video/')) {
                                postData.videoUrl = downloadURL;
                            }
                        } else if (this.state.mediaFile.type === 'audio/wav' || this.state.mediaFile instanceof Blob) {
                            // Voice recording
                            const fileRef = storageRef.child(`posts/${this.state.currentUser.uid}/voice_${Date.now()}.wav`);
                            await fileRef.put(this.state.mediaFile);
                            const downloadURL = await fileRef.getDownloadURL();
                            
                            postData.voiceUrl = downloadURL;
                            postData.voiceDuration = this.elements.voiceDuration.textContent;
                        }
                    }

                    await firebase.firestore().collection('posts').add(postData);

                    // Reset form and close modal
                    this.elements.postTextarea.value = '';
                    this.clearMediaPreview();
                    this.stopVoiceRecording();
                    this.togglePostCreationModal();
                    
                    this.showNotification('Post Created', 'Your post has been published');
                    this.loadPosts();
                } catch (error) {
                    console.error('Error creating post:', error);
                    this.showNotification('Error', 'Failed to create post. Please try again.');
                }
            }

            // Profile Picture Methods
            openProfilePictureUpload() {
                // Create file input
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        this.state.profilePictureFile = file;
                        
                        // Preview image
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.elements.profilePreview.innerHTML = `<img src="${e.target.result}" alt="Profile Preview">`;
                        };
                        reader.readAsDataURL(file);
                        
                        // Show upload modal
                        this.elements.profilePictureUpload.classList.add('active');
                    }
                };
                input.click();
            }

            closeProfilePictureUpload() {
                this.elements.profilePictureUpload.classList.remove('active');
                this.state.profilePictureFile = null;
            }

            async uploadProfilePicture() {
                if (!this.state.profilePictureFile || !this.state.isLoggedIn) return;

                try {
                    const storageRef = firebase.storage().ref();
                    const fileRef = storageRef.child(`profile_pictures/${this.state.currentUser.uid}`);
                    
                    // Upload file
                    await fileRef.put(this.state.profilePictureFile);
                    const downloadURL = await fileRef.getDownloadURL();
                    
                    // Update user document
                    await firebase.firestore().collection('users').doc(this.state.currentUser.uid).update({
                        profilePicture: downloadURL
                    });
                    
                    // Update UI
                    await this.updateUserUI();
                    await this.loadProfilePage();
                    
                    // Close modal
                    this.closeProfilePictureUpload();
                    
                    this.showNotification('Profile Updated', 'Your profile picture has been updated');
                } catch (error) {
                    console.error('Error uploading profile picture:', error);
                    this.showNotification('Error', 'Failed to upload profile picture. Please try again.');
                }
            }

            // Post Interaction Methods
            async handleLikePost(postId, button) {
                if (!this.state.isLoggedIn) {
                    this.showNotification('Authentication Required', 'Please login to like posts');
                    return;
                }

                const isLiked = button.classList.contains('active');
                const icon = button.querySelector('i');
                
                if (!isLiked) {
                    button.classList.add('active');
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    this.playTone(523.25, 100);
                    
                    // Update like count in Firestore
                    try {
                        const postRef = firebase.firestore().collection('posts').doc(postId);
                        await postRef.update({
                            likes: firebase.firestore.FieldValue.increment(1)
                        });
                        
                        await firebase.firestore().collection('posts').doc(postId).collection('likes').doc(this.state.currentUser.uid).set({
                            likedAt: new Date().toISOString()
                        });
                    } catch (error) {
                        console.error('Error liking post:', error);
                    }
                } else {
                    button.classList.remove('active');
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    
                    // Update like count in Firestore
                    try {
                        const postRef = firebase.firestore().collection('posts').doc(postId);
                        await postRef.update({
                            likes: firebase.firestore.FieldValue.increment(-1)
                        });
                        
                        await firebase.firestore().collection('posts').doc(postId).collection('likes').doc(this.state.currentUser.uid).delete();
                    } catch (error) {
                        console.error('Error unliking post:', error);
                    }
                }
                
                this.loadPosts();
            }

            async toggleComments(postId) {
                const commentsSection = document.getElementById(`comments-${postId}`);
                
                if (commentsSection.innerHTML.trim() === '') {
                    await this.loadComments(postId);
                } else {
                    commentsSection.innerHTML = '';
                }
            }

            async loadComments(postId) {
                try {
                    const snapshot = await firebase.firestore().collection('posts').doc(postId)
                        .collection('comments')
                        .orderBy('createdAt', 'asc')
                        .limit(10)
                        .get();
                    
                    const comments = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    this.renderComments(postId, comments);
                } catch (error) {
                    console.error('Error loading comments:', error);
                }
            }

            renderComments(postId, comments) {
                const commentsSection = document.getElementById(`comments-${postId}`);
                
                commentsSection.innerHTML = `
                    ${comments && comments.length > 0 ? comments.map(comment => `
                        <div class="comment">
                            ${comment.authorProfilePicture ? 
                                `<div class="comment-avatar"><img src="${comment.authorProfilePicture}" alt="${comment.authorName}"></div>` :
                                `<div class="comment-avatar">${comment.authorName ? comment.authorName.charAt(0).toUpperCase() : 'U'}</div>`
                            }
                            <div class="comment-content">
                                <div class="comment-header">
                                    <div class="comment-author">${comment.authorName || 'Unknown User'}</div>
                                    <div class="comment-time">${this.formatTime(comment.createdAt)}</div>
                                </div>
                                <div class="comment-text">${comment.content}</div>
                            </div>
                        </div>
                    `).join('') : ''}
                    <div class="add-comment">
                        <input type="text" class="comment-input" placeholder="Write a comment..." data-post-id="${postId}">
                        <button class="send-comment" data-post-id="${postId}">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                `;

                // Add event listeners to comment buttons
                commentsSection.querySelectorAll('.send-comment').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = btn.getAttribute('data-post-id');
                        const input = commentsSection.querySelector('.comment-input');
                        this.addComment(postId, input.value);
                        input.value = '';
                    });
                });

                commentsSection.querySelectorAll('.comment-input').forEach(input => {
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            const postId = input.getAttribute('data-post-id');
                            this.addComment(postId, input.value);
                            input.value = '';
                        }
                    });
                });
            }

            async addComment(postId, content) {
                if (!content.trim() || !this.state.isLoggedIn) return;

                try {
                    const commentData = {
                        content: content,
                        authorId: this.state.currentUser.uid,
                        authorName: this.elements.userName.textContent,
                        createdAt: new Date().toISOString()
                    };

                    // Get user profile picture for the comment
                    const userDoc = await firebase.firestore().collection('users').doc(this.state.currentUser.uid).get();
                    if (userDoc.exists && userDoc.data().profilePicture) {
                        commentData.authorProfilePicture = userDoc.data().profilePicture;
                    }

                    await firebase.firestore().collection('posts').doc(postId)
                        .collection('comments').add(commentData);

                    // Update comment count
                    await firebase.firestore().collection('posts').doc(postId).update({
                        comments: firebase.firestore.FieldValue.increment(1)
                    });

                    this.showNotification('Comment Added', 'Your comment has been posted');
                    this.loadPosts();
                } catch (error) {
                    console.error('Error adding comment:', error);
                    this.showNotification('Error', 'Failed to add comment');
                }
            }

            async handleSharePost(postId) {
                if (!this.state.isLoggedIn) {
                    this.showNotification('Authentication Required', 'Please login to share posts');
                    return;
                }

                try {
                    // Update share count
                    await firebase.firestore().collection('posts').doc(postId).update({
                        shares: firebase.firestore.FieldValue.increment(1)
                    });

                    this.showNotification('Post Shared', 'Post has been shared successfully');
                    this.loadPosts();
                } catch (error) {
                    console.error('Error sharing post:', error);
                    this.showNotification('Error', 'Failed to share post');
                }
            }

            // Search Methods
            async handleSearch(e) {
                const query = e.target.value.trim();
                
                if (query.length < 2) {
                    this.clearSearchResults();
                    return;
                }

                try {
                    const usersSnapshot = await firebase.firestore().collection('users')
                        .where('username', '>=', query)
                        .where('username', '<=', query + '\uf8ff')
                        .limit(10)
                        .get();
                    
                    this.state.searchResults = usersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    this.renderSearchResults();
                } catch (error) {
                    console.error('Error searching users:', error);
                    this.state.searchResults = [];
                    this.renderSearchResults();
                }
            }

            renderSearchResults() {
                if (this.state.searchResults.length === 0) {
                    this.elements.searchResults.innerHTML = `
                        <div class="user-result">
                            <div class="user-result-info">
                                <p>No users found</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                this.elements.searchResults.innerHTML = this.state.searchResults.map(user => `
                    <div class="user-result" data-user-id="${user.id}">
                        ${user.profilePicture ? 
                            `<div class="user-avatar-small"><img src="${user.profilePicture}" alt="${user.name}"></div>` :
                            `<div class="user-avatar-small">${user.name ? user.name.charAt(0).toUpperCase() : 'U'}</div>`
                        }
                        <div class="user-result-info">
                            <h4>
                                ${user.name}
                                ${user.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}
                            </h4>
                            <p>@${user.username}</p>
                        </div>
                        <button class="follow-btn ${this.state.following.includes(user.id) ? 'following' : ''}" data-user-id="${user.id}">
                            ${this.state.following.includes(user.id) ? 'Following' : 'Follow'}
                        </button>
                    </div>
                `).join('');

                // Add event listeners to follow buttons
                this.elements.searchResults.querySelectorAll('.follow-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const userId = btn.getAttribute('data-user-id');
                        this.handleFollowUser(userId, btn);
                    });
                });

                // Add event listeners to user results
                this.elements.searchResults.querySelectorAll('.user-result').forEach(result => {
                    result.addEventListener('click', () => {
                        const userId = result.getAttribute('data-user-id');
                        // In a real app, this would navigate to the user's profile
                        this.showNotification('Profile', `Viewing ${userId}'s profile`);
                    });
                });
            }

            clearSearchResults() {
                this.elements.searchResults.innerHTML = '';
                this.state.searchResults = [];
            }

            async handleFollowUser(userId, button) {
                if (!this.state.isLoggedIn) {
                    this.showNotification('Authentication Required', 'Please login to follow users');
                    return;
                }

                const isFollowing = button.textContent === 'Following';
                
                if (!isFollowing) {
                    button.textContent = 'Following';
                    button.classList.add('following');
                    
                    try {
                        // Add to following
                        await firebase.firestore()
                            .collection('users')
                            .doc(this.state.currentUser.uid)
                            .collection('following')
                            .doc(userId)
                            .set({
                                followedAt: new Date().toISOString()
                            });
                        
                        // Add to user's followers
                        await firebase.firestore()
                            .collection('users')
                            .doc(userId)
                            .collection('followers')
                            .doc(this.state.currentUser.uid)
                            .set({
                                followedAt: new Date().toISOString()
                            });
                        
                        // Update follower count
                        await firebase.firestore()
                            .collection('users')
                            .doc(userId)
                            .update({
                                followerCount: firebase.firestore.FieldValue.increment(1)
                            });
                        
                        this.state.following.push(userId);
                        this.showNotification('Followed', 'You are now following this user');
                        
                        // Reload posts to show posts from followed user
                        this.loadPosts();
                        this.loadSuggestedUsers();
                    } catch (error) {
                        console.error('Error following user:', error);
                        this.showNotification('Error', 'Failed to follow user');
                    }
                } else {
                    button.textContent = 'Follow';
                    button.classList.remove('following');
                    
                    try {
                        // Remove from following
                        await firebase.firestore()
                            .collection('users')
                            .doc(this.state.currentUser.uid)
                            .collection('following')
                            .doc(userId)
                            .delete();
                        
                        // Remove from user's followers
                        await firebase.firestore()
                            .collection('users')
                            .doc(userId)
                            .collection('followers')
                            .doc(this.state.currentUser.uid)
                            .delete();
                        
                        // Update follower count
                        await firebase.firestore()
                            .collection('users')
                            .doc(userId)
                            .update({
                                followerCount: firebase.firestore.FieldValue.increment(-1)
                            });
                        
                        this.state.following = this.state.following.filter(id => id !== userId);
                        this.showNotification('Unfollowed', 'You have unfollowed this user');
                        
                        // Reload posts
                        this.loadPosts();
                        this.loadSuggestedUsers();
                    } catch (error) {
                        console.error('Error unfollowing user:', error);
                        this.showNotification('Error', 'Failed to unfollow user');
                    }
                }
            }

            // Utility Methods
            formatTime(timestamp) {
                if (!timestamp) return 'Just now';
                
                const now = new Date();
                const postTime = new Date(timestamp);
                const diff = now - postTime;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);

                if (days > 0) return `${days}d ago`;
                if (hours > 0) return `${hours}h ago`;
                if (minutes > 0) return `${minutes}m ago`;
                return 'Just now';
            }

            showNotification(title, message) {
                this.elements.notificationTitle.textContent = title;
                this.elements.notificationMessage.textContent = message;
                this.elements.notification.classList.add('active');
                
                setTimeout(() => {
                    this.elements.notification.classList.remove('active');
                }, 5000);
            }

            // Audio Methods
            initAudio() {
                try {
                    this.state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    console.log('Audio context initialized');
                    return true;
                } catch (e) {
                    console.log('Web Audio API not supported');
                    return false;
                }
            }

            playKeySound(number) {
                const frequencies = {
                    '1': {f1: 697, f2: 1209}, '2': {f1: 697, f2: 1336}, '3': {f1: 697, f2: 1477},
                    '4': {f1: 770, f2: 1209}, '5': {f1: 770, f2: 1336}, '6': {f1: 770, f2: 1477},
                    '7': {f1: 852, f2: 1209}, '8': {f1: 852, f2: 1336}, '9': {f1: 852, f2: 1477},
                    '*': {f1: 941, f2: 1209}, '0': {f1: 941, f2: 1336}, '#': {f1: 941, f2: 1477}
                };

                if (frequencies[number] && this.state.audioContext) {
                    this.playDTMFTone(frequencies[number].f1, frequencies[number].f2);
                }
            }

            playDTMFTone(f1, f2) {
                if (!this.state.audioContext) return;

                const oscillator1 = this.state.audioContext.createOscillator();
                const oscillator2 = this.state.audioContext.createOscillator();
                const gainNode = this.state.audioContext.createGain();

                oscillator1.type = 'sine';
                oscillator1.frequency.value = f1;
                oscillator2.type = 'sine';
                oscillator2.frequency.value = f2;
                gainNode.gain.value = 0.1;

                oscillator1.connect(gainNode);
                oscillator2.connect(gainNode);
                gainNode.connect(this.state.audioContext.destination);

                oscillator1.start();
                oscillator2.start();

                setTimeout(() => {
                    oscillator1.stop();
                    oscillator2.stop();
                }, 100);
            }

            playTone(frequency, duration) {
                if (!this.state.audioContext) return;

                const oscillator = this.state.audioContext.createOscillator();
                const gainNode = this.state.audioContext.createGain();

                oscillator.type = 'sine';
                oscillator.frequency.value = frequency;
                gainNode.gain.value = 0.1;

                oscillator.connect(gainNode);
                gainNode.connect(this.state.audioContext.destination);

                oscillator.start();
                setTimeout(() => oscillator.stop(), duration);
            }
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.connectXApp = new ConnectXApp();
        });
    </script>
</body>
</html>
