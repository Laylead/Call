<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BetPro</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap">
  <style>
    * {margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif;}
    body {background: #0a0a0a; color: white; overflow-x: hidden;}
    header {background: #111; padding: 1rem; text-align: center; font-size: 1.5rem; font-weight: bold;}
    .container {padding: 1rem;}
    .auth, .dashboard, .game-section, .cpa-offer, .withdrawal-form, .admin-panel {display: none;}
    input, button, select {padding: 10px; margin: 5px 0; width: 100%; font-size: 1rem;}
    button {cursor: pointer; background: #0f62fe; color: white; border: none; border-radius: 5px;}
    .hidden {display: none;}
    .games {display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;}
    .game-card {background: #222; padding: 1rem; border-radius: 10px; text-align: center;}
    audio {display: none;}
  </style>
</head>
<body>

<header>BetPro - Earn By Playing</header>

<div class="container">

  <div class="auth">
    <h2>Login / Signup</h2>
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button onclick="signup()">Signup</button>
    <button onclick="login()">Login</button>
  </div>

  <div class="dashboard">
    <h2>Welcome <span id="username"></span></h2>
    <p>Balance: <span id="balance">0</span> credits</p>
    <button onclick="showGames()">Play Games</button>
    <button onclick="showWithdraw()">Withdraw</button>
    <button onclick="logout()">Logout</button>
  </div>

  <div class="game-section">
    <h3>Games</h3>
    <div class="games">
      <div class="game-card">
        <h4>Coin Toss</h4>
        <button onclick="playGame('coin')">Play</button>
      </div>
      <div class="game-card">
        <h4>Dice Roll</h4>
        <button onclick="playGame('dice')">Play</button>
      </div>
      <div class="game-card">
        <h4>Spin</h4>
        <button onclick="playGame('spin')">Play</button>
      </div>
      <div class="game-card">
        <h4>Lucky Box</h4>
        <button onclick="playGame('box')">Play</button>
      </div>
    </div>
  </div>

  <div class="cpa-offer">
    <h3>Complete Offer to Unlock More</h3>
    <p><a id="cpaLink" href="#" target="_blank">Click to Continue</a></p>
  </div>

  <div class="withdrawal-form">
    <h3>Withdraw</h3>
    <select id="method">
      <option value="bank">Bank</option>
      <option value="usdt">TRC20 USDT</option>
    </select>
    <input type="text" id="accName" placeholder="Account Name"/>
    <input type="text" id="accDetails" placeholder="Account No. or Wallet"/>
    <button onclick="requestWithdrawal()">Submit</button>
  </div>

  <div class="admin-panel">
    <h3>Admin CPA Control</h3>
    <input type="text" id="adminLink" placeholder="CPA Offer Link"/>
    <button onclick="saveCPA()">Save CPA Link</button>
  </div>

</div>

<audio id="clickSound" src="https://www.soundjay.com/buttons/sounds/button-16.mp3" preload="auto"></audio>

<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.10.0/firebase-database.js"></script>
<script src="configuration.js"></script>
<script>
let user = null, gameCount = 0;
const app = firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

const $ = (id) => document.getElementById(id);
const playSound = () => $('clickSound').play();

function show(el) {
  document.querySelectorAll('.auth, .dashboard, .game-section, .cpa-offer, .withdrawal-form, .admin-panel')
    .forEach(d => d.style.display = 'none');
  document.querySelector('.' + el).style.display = 'block';
}

auth.onAuthStateChanged(u => {
  if (u) {
    user = u;
    db.ref('users/' + user.uid).once('value').then(snap => {
      if (!snap.exists()) {
        db.ref('users/' + user.uid).set({balance: getRandom(20,30), plays: 0});
      }
      $('username').innerText = user.email;
      updateBalance();
      show('dashboard');
    });
  } else {
    show('auth');
  }
});

function signup() {
  const e = $('email').value, p = $('password').value;
  auth.createUserWithEmailAndPassword(e, p).catch(err => alert(err.message));
}
function login() {
  const e = $('email').value, p = $('password').value;
  auth.signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
}
function logout() {
  auth.signOut();
}
function updateBalance() {
  db.ref('users/' + user.uid + '/balance').on('value', snap => {
    $('balance').innerText = snap.val();
  });
}

function playGame(type) {
  playSound();
  db.ref('users/' + user.uid).once('value').then(snap => {
    let data = snap.val();
    if (!data) return;
    let win = Math.random() < 0.5;
    let delta = win ? getRandom(5, 10) : -getRandom(2, 5);
    let newBal = Math.max(0, (data.balance || 0) + delta);
    let newPlays = (data.plays || 0) + 1;
    db.ref('users/' + user.uid).update({balance: newBal, plays: newPlays});
    alert(win ? `You won ${delta} credits!` : `You lost ${-delta} credits.`);
    if (newPlays >= 4) showCPA();
  });
}

function showCPA() {
  db.ref('admin/cpa').once('value').then(snap => {
    $('cpaLink').href = snap.val() || '#';
    show('cpa-offer');
  });
}

function showGames() {
  show('game-section');
}
function showWithdraw() {
  show('withdrawal-form');
}

function requestWithdrawal() {
  const m = $('method').value;
  const name = $('accName').value;
  const acc = $('accDetails').value;
  if (!name || !acc) return alert('Please fill all fields');
  db.ref('withdrawals').push({
    uid: user.uid,
    method: m,
    name,
    details: acc,
    timestamp: Date.now()
  });
  alert('Request submitted!');
  show('dashboard');
}

function saveCPA() {
  const l = $('adminLink').value;
  db.ref('admin/cpa').set(l);
  alert('Saved.');
}

function getRandom(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}
</script>

</body>
</html>
