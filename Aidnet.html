<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConnectX - Social Calling App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --gray-color: #6c757d;
            --card-bg: #ffffff;
            --body-bg: #f5f7fb;
            --text-color: #333333;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --primary-color: #4895ef;
            --secondary-color: #560bad;
            --accent-color: #b5179e;
            --light-color: #2d3748;
            --dark-color: #f8f9fa;
            --card-bg: #1a202c;
            --body-bg: #121826;
            --text-color: #e2e8f0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--body-bg);
            color: var(--text-color);
            transition: var(--transition);
            min-height: 100vh;
            padding-bottom: 70px;
            overflow-x: hidden;
        }

        /* Header */
        header {
            background-color: var(--card-bg);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            color: var(--primary-color);
            font-size: 24px;
        }

        .logo h1 {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .header-actions i {
            font-size: 20px;
            color: var(--gray-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .header-actions i:hover {
            color: var(--primary-color);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .bottom-nav.hidden {
            transform: translateY(100%);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: var(--transition);
            padding: 5px 10px;
            border-radius: 10px;
            text-decoration: none;
        }

        .nav-item.active, .nav-item:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        .nav-item i {
            font-size: 20px;
            color: var(--gray-color);
            transition: var(--transition);
        }

        .nav-item.active i, .nav-item:hover i {
            color: var(--primary-color);
        }

        .nav-item span {
            font-size: 12px;
            color: var(--gray-color);
            transition: var(--transition);
        }

        .nav-item.active span, .nav-item:hover span {
            color: var(--primary-color);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background-color: var(--card-bg);
            box-shadow: var(--shadow);
            z-index: 200;
            transition: var(--transition);
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 199;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .user-avatar-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .user-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .user-info p {
            color: var(--gray-color);
            font-size: 14px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            border-radius: 10px;
            color: var(--text-color);
            text-decoration: none;
            transition: var(--transition);
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .sidebar-menu i {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        /* Keypad */
        .keypad-container {
            max-width: 400px;
            margin: 0 auto;
            padding: 15px;
            text-align: center;
            height: calc(100vh - 140px);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .phone-number {
            font-size: 28px;
            margin: 15px 0;
            padding: 12px;
            letter-spacing: 1.5px;
            min-height: 50px;
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .key {
            background-color: var(--card-bg);
            border-radius: 50%;
            height: 65px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            user-select: none;
        }

        .key:active {
            transform: scale(0.95);
            background-color: var(--primary-color);
            color: white;
        }

        .key:hover {
            background-color: var(--primary-color);
            color: white;
            transform: scale(1.05);
        }

        .key .number {
            font-size: 22px;
            font-weight: bold;
        }

        .key .letters {
            font-size: 10px;
            margin-top: -3px;
            opacity: 0.7;
        }

        .call-actions {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 20px;
        }

        .call-action {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .call {
            background-color: var(--success-color);
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 201, 240, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 201, 240, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 201, 240, 0); }
        }

        .call:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(76, 201, 240, 0.4);
        }

        .backspace {
            background-color: var(--warning-color);
            color: white;
        }

        .backspace:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(247, 37, 133, 0.4);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 300;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            width: 90%;
            max-width: 350px;
            box-shadow: var(--shadow);
            transform: translateY(20px);
            transition: var(--transition);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--body-bg);
            border-radius: 8px;
            background-color: var(--body-bg);
            color: var(--text-color);
            transition: var(--transition);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            width: 100%;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .auth-toggle {
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
        }

        .auth-toggle a {
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
        }

        .permission-request {
            background-color: rgba(67, 97, 238, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .permission-request p {
            margin-bottom: 10px;
            font-size: 14px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            box-shadow: var(--shadow);
            z-index: 400;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .notification.active {
            transform: translateX(0);
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .notification-header i {
            color: var(--primary-color);
            font-size: 20px;
        }

        .notification-header h4 {
            font-size: 16px;
        }

        .notification p {
            font-size: 14px;
            color: var(--gray-color);
        }

        /* Page Content */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* Home Page */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Create Post */
        .create-post {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .post-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .post-input input {
            flex: 1;
            padding: 12px 15px;
            border: none;
            background-color: var(--body-bg);
            border-radius: 25px;
            color: var(--text-color);
            font-size: 14px;
        }

        .post-input input:focus {
            outline: none;
        }

        .post-actions {
            display: flex;
            justify-content: space-between;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .post-action:hover {
            background-color: var(--body-bg);
        }

        .post-action i {
            color: var(--primary-color);
        }

        /* Post Feed */
        .post {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .post-user-info h4 {
            font-size: 16px;
            margin-bottom: 3px;
        }

        .post-user-info p {
            font-size: 12px;
            color: var(--gray-color);
        }

        .post-options {
            margin-left: auto;
            color: var(--gray-color);
            cursor: pointer;
        }

        .post-content {
            margin-bottom: 15px;
        }

        .post-text {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .voice-note {
            background-color: var(--body-bg);
            border-radius: 20px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .play-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .play-btn:hover {
            transform: scale(1.05);
        }

        .waveform {
            flex: 1;
            height: 40px;
            background: linear-gradient(90deg, 
                var(--primary-color) 0%, 
                var(--primary-color) 20%, 
                var(--accent-color) 40%, 
                var(--accent-color) 60%, 
                var(--primary-color) 80%, 
                var(--primary-color) 100%);
            border-radius: 20px;
            animation: wave 2s linear infinite;
            background-size: 200% 100%;
        }

        @keyframes wave {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        .voice-duration {
            color: var(--gray-color);
            font-size: 14px;
        }

        .post-image {
            width: 100%;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .post-stats {
            display: flex;
            justify-content: space-between;
            color: var(--gray-color);
            font-size: 14px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }

        .post-actions-bar {
            display: flex;
            justify-content: space-around;
        }

        .post-action-btn {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .post-action-btn:hover {
            background-color: var(--body-bg);
        }

        .post-action-btn i {
            color: var(--gray-color);
        }

        .post-action-btn.active i {
            color: var(--primary-color);
        }

        /* Calling Screen */
        .calling-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 500;
            color: white;
            text-align: center;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .calling-screen.active {
            opacity: 1;
            visibility: visible;
        }

        .caller-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin-bottom: 20px;
            border: 3px solid white;
        }

        .caller-name {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .call-status {
            font-size: 16px;
            margin-bottom: 30px;
        }

        .call-timer {
            font-size: 18px;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .call-controls {
            display: flex;
            gap: 30px;
        }

        .call-control {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .call-control:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .end-call {
            background: var(--warning-color);
        }

        /* Media Upload */
        .media-preview {
            margin-top: 15px;
            position: relative;
            display: inline-block;
        }

        .media-preview img, .media-preview video {
            max-width: 100%;
            border-radius: 10px;
        }

        .remove-media {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--warning-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .remove-media:hover {
            transform: scale(1.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 280px;
            }
            
            .keypad-container {
                padding: 10px;
            }
            
            .key {
                height: 60px;
            }
            
            .key .number {
                font-size: 20px;
            }
            
            .call-action {
                width: 55px;
                height: 55px;
            }
        }

        @media (max-width: 480px) {
            .key {
                height: 55px;
            }
            
            .key .number {
                font-size: 18px;
            }
            
            .phone-number {
                font-size: 24px;
            }
            
            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="authTitle">Create Account</h2>
                <p>Join ConnectX to start connecting with others</p>
            </div>
            <form id="authForm">
                <div class="form-group" id="fullNameGroup">
                    <label for="fullName">Full Name</label>
                    <input type="text" id="fullName" placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" placeholder="Enter your email" required>
                </div>
                <div class="form-group" id="usernameGroup">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Choose a username">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Create a password" required>
                </div>
                <div class="permission-request">
                    <p>ConnectX needs permissions for:</p>
                    <p><i class="fas fa-bell"></i> Notifications</p>
                    <p><i class="fas fa-microphone"></i> Microphone</p>
                    <p><i class="fas fa-volume-up"></i> Audio</p>
                </div>
                <button type="submit" class="btn btn-primary" id="authButton">Create Account</button>
            </form>
            <div class="auth-toggle">
                <p>Already have an account? <a id="toggleAuth">Sign In</a></p>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-header">
            <i class="fas fa-bell"></i>
            <h4 id="notificationTitle">New Message</h4>
        </div>
        <p id="notificationMessage">Welcome to ConnectX!</p>
    </div>

    <!-- Calling Screen -->
    <div class="calling-screen" id="callingScreen">
        <div class="caller-avatar" id="callerAvatar">?</div>
        <div class="caller-name" id="callerName">Unknown</div>
        <div class="call-status" id="callStatus">Calling...</div>
        <div class="call-timer" id="callTimer">00:00</div>
        <div class="call-controls">
            <div class="call-control" id="muteCall">
                <i class="fas fa-microphone"></i>
            </div>
            <div class="call-control end-call" id="endCall">
                <i class="fas fa-phone"></i>
            </div>
            <div class="call-control" id="speakerCall">
                <i class="fas fa-volume-up"></i>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="logo">
            <i class="fas fa-phone-alt"></i>
            <h1>ConnectX</h1>
        </div>
        <div class="header-actions">
            <i class="fas fa-search" id="searchBtn"></i>
            <i class="fas fa-bell" id="notificationsBtn"></i>
            <i class="fas fa-bars" id="menuToggle"></i>
        </div>
    </header>

    <!-- Dial Pad (First Page) -->
    <div class="keypad-container active" id="dialPadPage">
        <div class="phone-number" id="phoneNumber">Enter number</div>
        <div class="keypad">
            <div class="key" data-number="1">
                <div class="number">1</div>
            </div>
            <div class="key" data-number="2">
                <div class="number">2</div>
                <div class="letters">ABC</div>
            </div>
            <div class="key" data-number="3">
                <div class="number">3</div>
                <div class="letters">DEF</div>
            </div>
            <div class="key" data-number="4">
                <div class="number">4</div>
                <div class="letters">GHI</div>
            </div>
            <div class="key" data-number="5">
                <div class="number">5</div>
                <div class="letters">JKL</div>
            </div>
            <div class="key" data-number="6">
                <div class="number">6</div>
                <div class="letters">MNO</div>
            </div>
            <div class="key" data-number="7">
                <div class="number">7</div>
                <div class="letters">PQRS</div>
            </div>
            <div class="key" data-number="8">
                <div class="number">8</div>
                <div class="letters">TUV</div>
            </div>
            <div class="key" data-number="9">
                <div class="number">9</div>
                <div class="letters">WXYZ</div>
            </div>
            <div class="key" data-number="*">
                <div class="number">*</div>
            </div>
            <div class="key" data-number="0">
                <div class="number">0</div>
                <div class="letters">+</div>
            </div>
            <div class="key" data-number="#">
                <div class="number">#</div>
            </div>
        </div>
        <div class="call-actions">
            <div class="call-action backspace" id="backspaceBtn">
                <i class="fas fa-backspace"></i>
            </div>
            <div class="call-action call" id="callBtn">
                <i class="fas fa-phone"></i>
            </div>
        </div>
    </div>

    <!-- Home Page -->
    <div class="page-content" id="homePage">
        <div class="container">
            <!-- Create Post -->
            <div class="create-post">
                <div class="post-input">
                    <div class="user-avatar-small" id="currentUserAvatar">U</div>
                    <input type="text" placeholder="What's on your mind?" id="postInput">
                </div>
                <div class="post-actions">
                    <div class="post-action" id="addPhoto">
                        <i class="fas fa-image"></i>
                        <span>Photo</span>
                    </div>
                    <div class="post-action" id="addVoice">
                        <i class="fas fa-microphone"></i>
                        <span>Voice</span>
                    </div>
                    <div class="post-action" id="goLive">
                        <i class="fas fa-video"></i>
                        <span>Live</span>
                    </div>
                </div>
                <div id="mediaPreview"></div>
            </div>

            <!-- Post Feed -->
            <div id="postFeed">
                <!-- Posts will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="sidebar" id="sidebar">
        <div class="user-profile">
            <div class="user-avatar" id="userAvatar">U</div>
            <div class="user-info">
                <h3 id="userName">Guest User</h3>
                <p id="userHandle">@guest</p>
            </div>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#" class="sidebar-link active" data-page="homePage"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="#" class="sidebar-link" data-page="dialPadPage"><i class="fas fa-dialpad"></i> Keypad</a></li>
            <li><a href="groups.html" class="sidebar-link"><i class="fas fa-users"></i> Groups & Channels</a></li>
            <li><a href="mentors.html" class="sidebar-link"><i class="fas fa-user-graduate"></i> Mentors</a></li>
            <li><a href="smile.html" class="sidebar-link"><i class="fas fa-smile"></i> Smile</a></li>
            <li><a href="wallet.html" class="sidebar-link"><i class="fas fa-wallet"></i> Wallet</a></li>
            <li><a href="account.html" class="sidebar-link"><i class="fas fa-user-circle"></i> Account</a></li>
            <li><a href="#" id="themeToggleSidebar"><i class="fas fa-moon"></i> <span>Dark Mode</span></a></li>
            <li><a href="#" id="logoutBtn" class="sidebar-link"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav" id="bottomNav">
        <a href="#" class="nav-item active" data-page="homePage">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="sms.html" class="nav-item">
            <i class="fas fa-sms"></i>
            <span>SMS</span>
        </a>
        <a href="#" class="nav-item" data-page="dialPadPage">
            <i class="fas fa-dialpad"></i>
            <span>Keypad</span>
        </a>
        <a href="contacts.html" class="nav-item">
            <i class="fas fa-address-book"></i>
            <span>Contacts</span>
        </a>
        <a href="account.html" class="nav-item">
            <i class="fas fa-user"></i>
            <span>Account</span>
        </a>
        <a href="history.html" class="nav-item">
            <i class="fas fa-history"></i>
            <span>History</span>
        </a>
    </div>

    <!-- External Configuration -->
    <script src="configuration.js"></script>
    <script src="agora.js"></script>

    <!-- External Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <!-- App Scripts -->
    <script>
        // Main Application
        class ConnectXApp {
            constructor() {
                this.state = {
                    currentUser: null,
                    isLoggedIn: false,
                    currentPage: 'dialPadPage',
                    phoneNumber: '',
                    isCalling: false,
                    callTimer: 0,
                    callInterval: null,
                    audioContext: null,
                    posts: [],
                    theme: 'light',
                    agoraClient: null,
                    agoraStream: null,
                    mediaStream: null,
                    mediaFile: null
                };

                this.init();
            }

            async init() {
                try {
                    // Check if external configuration is loaded
                    if (typeof firebaseConfig === 'undefined') {
                        console.error('Configuration not loaded. Using demo mode.');
                        this.setupDemoMode();
                    } else {
                        firebase.initializeApp(firebaseConfig);
                    }
                    
                    this.setupDOMReferences();
                    this.setupEventListeners();
                    await this.checkAuthStatus();
                    await this.loadInitialData();
                    await this.requestPermissions();
                    console.log('ConnectX App initialized successfully');
                } catch (error) {
                    console.error('App initialization failed:', error);
                    this.showNotification('Initialization Error', 'Failed to initialize app. Please refresh.');
                }
            }

            setupDemoMode() {
                // Demo configuration for testing
                const demoConfig = {
                    apiKey: "demo-api-key",
                    authDomain: "connectx-demo.firebaseapp.com",
                    projectId: "connectx-demo",
                    storageBucket: "connectx-demo.appspot.com",
                    messagingSenderId: "123456789",
                    appId: "demo-app-id"
                };
                
                try {
                    firebase.initializeApp(demoConfig);
                    console.log('Demo mode activated');
                } catch (error) {
                    console.log('Firebase not available, running in offline mode');
                }
            }

            setupDOMReferences() {
                this.elements = {
                    authModal: document.getElementById('authModal'),
                    authForm: document.getElementById('authForm'),
                    authTitle: document.getElementById('authTitle'),
                    authButton: document.getElementById('authButton'),
                    toggleAuth: document.getElementById('toggleAuth'),
                    fullNameGroup: document.getElementById('fullNameGroup'),
                    usernameGroup: document.getElementById('usernameGroup'),
                    notification: document.getElementById('notification'),
                    notificationTitle: document.getElementById('notificationTitle'),
                    notificationMessage: document.getElementById('notificationMessage'),
                    menuToggle: document.getElementById('menuToggle'),
                    sidebar: document.getElementById('sidebar'),
                    sidebarOverlay: document.getElementById('sidebarOverlay'),
                    bottomNav: document.getElementById('bottomNav'),
                    themeToggleSidebar: document.getElementById('themeToggleSidebar'),
                    phoneNumberDisplay: document.getElementById('phoneNumber'),
                    callBtn: document.getElementById('callBtn'),
                    backspaceBtn: document.getElementById('backspaceBtn'),
                    keys: document.querySelectorAll('.key'),
                    callingScreen: document.getElementById('callingScreen'),
                    callerName: document.getElementById('callerName'),
                    callerAvatar: document.getElementById('callerAvatar'),
                    callStatus: document.getElementById('callStatus'),
                    callTimer: document.getElementById('callTimer'),
                    endCallBtn: document.getElementById('endCall'),
                    muteCallBtn: document.getElementById('muteCall'),
                    speakerCallBtn: document.getElementById('speakerCall'),
                    postInput: document.getElementById('postInput'),
                    postFeed: document.getElementById('postFeed'),
                    addPhoto: document.getElementById('addPhoto'),
                    addVoice: document.getElementById('addVoice'),
                    goLive: document.getElementById('goLive'),
                    mediaPreview: document.getElementById('mediaPreview'),
                    userName: document.getElementById('userName'),
                    userHandle: document.getElementById('userHandle'),
                    userAvatar: document.getElementById('userAvatar'),
                    currentUserAvatar: document.getElementById('currentUserAvatar'),
                    logoutBtn: document.getElementById('logoutBtn')
                };
            }

            setupEventListeners() {
                // Auth Events
                this.elements.toggleAuth.addEventListener('click', () => this.toggleAuthForm());
                this.elements.authForm.addEventListener('submit', (e) => this.handleAuthSubmit(e));
                this.elements.logoutBtn.addEventListener('click', (e) => this.handleLogout(e));

                // Navigation Events
                this.elements.menuToggle.addEventListener('click', () => this.toggleSidebar());
                this.elements.sidebarOverlay.addEventListener('click', () => this.toggleSidebar());
                this.elements.themeToggleSidebar.addEventListener('click', () => this.toggleTheme());

                // Bottom nav scroll behavior
                let lastScrollTop = 0;
                window.addEventListener('scroll', () => {
                    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    if (scrollTop > lastScrollTop && scrollTop > 100) {
                        this.elements.bottomNav.classList.add('hidden');
                    } else {
                        this.elements.bottomNav.classList.remove('hidden');
                    }
                    lastScrollTop = scrollTop;
                });

                // Page navigation
                document.querySelectorAll('.nav-item, .sidebar-link').forEach(item => {
                    item.addEventListener('click', (e) => {
                        if (item.getAttribute('href') === '#') {
                            e.preventDefault();
                        }
                        const page = item.getAttribute('data-page');
                        if (page) {
                            this.navigateToPage(page);
                        }
                    });
                });

                // Keypad Events
                this.elements.keys.forEach(key => {
                    key.addEventListener('click', () => {
                        const number = key.getAttribute('data-number');
                        this.handleKeyPress(number);
                    });
                });

                this.elements.backspaceBtn.addEventListener('click', () => this.handleBackspace());
                this.elements.callBtn.addEventListener('click', () => this.handleCall());

                // Call Controls
                this.elements.endCallBtn.addEventListener('click', () => this.endCall());
                this.elements.muteCallBtn.addEventListener('click', () => this.toggleMute());
                this.elements.speakerCallBtn.addEventListener('click', () => this.toggleSpeaker());

                // Post Events
                this.elements.postInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.createPost();
                    }
                });

                this.elements.addPhoto.addEventListener('click', () => this.handleAddPhoto());
                this.elements.addVoice.addEventListener('click', () => this.handleAddVoice());
                this.elements.goLive.addEventListener('click', () => this.handleGoLive());

                // Notifications
                document.getElementById('notificationsBtn').addEventListener('click', () => {
                    this.showNotification('Notifications', 'You have new notifications');
                });

                document.getElementById('searchBtn').addEventListener('click', () => {
                    this.showNotification('Search', 'Search feature coming soon');
                });
            }

            // Permission Methods
            async requestPermissions() {
                try {
                    // Request notification permission
                    if (Notification.permission === 'default') {
                        await Notification.requestPermission();
                    }

                    // Request microphone permission
                    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                        await navigator.mediaDevices.getUserMedia({ audio: true })
                            .then(stream => {
                                console.log('Microphone permission granted');
                                stream.getTracks().forEach(track => track.stop());
                            })
                            .catch(err => {
                                console.log('Microphone permission denied:', err);
                            });
                    }

                    // Request camera permission
                    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                        await navigator.mediaDevices.getUserMedia({ video: true })
                            .then(stream => {
                                console.log('Camera permission granted');
                                stream.getTracks().forEach(track => track.stop());
                            })
                            .catch(err => {
                                console.log('Camera permission denied:', err);
                            });
                    }
                } catch (error) {
                    console.error('Error requesting permissions:', error);
                }
            }

            // Authentication Methods
            async checkAuthStatus() {
                return new Promise((resolve) => {
                    firebase.auth().onAuthStateChanged(async (user) => {
                        if (user) {
                            this.state.currentUser = user;
                            this.state.isLoggedIn = true;
                            this.updateUserUI();
                            this.hideAuthModal();
                        } else {
                            this.state.isLoggedIn = false;
                            this.state.currentUser = null;
                            this.showAuthModal();
                        }
                        resolve();
                    });
                });
            }

            async handleAuthSubmit(e) {
                e.preventDefault();
                
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                try {
                    let userCredential;
                    
                    if (this.elements.authTitle.textContent === 'Create Account') {
                        const fullName = document.getElementById('fullName').value;
                        const username = document.getElementById('username').value;
                        
                        userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                        await firebase.firestore().collection('users').doc(userCredential.user.uid).set({
                            name: fullName,
                            username: username,
                            email: email,
                            createdAt: new Date().toISOString()
                        });
                    } else {
                        userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                    }
                    
                    this.showNotification('Success', `Welcome ${this.elements.authTitle.textContent === 'Create Account' ? 'to ConnectX' : 'back'}!`);
                    this.elements.authForm.reset();
                } catch (error) {
                    this.showNotification('Error', error.message);
                }
            }

            async handleLogout(e) {
                e.preventDefault();
                if (confirm('Are you sure you want to logout?')) {
                    await firebase.auth().signOut();
                    this.showNotification('Logged Out', 'You have been successfully logged out.');
                    this.state.posts = [];
                    this.renderPosts();
                }
            }

            // UI Methods
            toggleAuthForm() {
                if (this.elements.authTitle.textContent === 'Create Account') {
                    this.elements.authTitle.textContent = 'Sign In';
                    this.elements.authButton.textContent = 'Sign In';
                    this.elements.toggleAuth.textContent = 'Create Account';
                    this.elements.fullNameGroup.style.display = 'none';
                    this.elements.usernameGroup.style.display = 'none';
                } else {
                    this.elements.authTitle.textContent = 'Create Account';
                    this.elements.authButton.textContent = 'Create Account';
                    this.elements.toggleAuth.textContent = 'Sign In';
                    this.elements.fullNameGroup.style.display = 'block';
                    this.elements.usernameGroup.style.display = 'block';
                }
            }

            showAuthModal() {
                this.elements.authModal.classList.add('active');
            }

            hideAuthModal() {
                this.elements.authModal.classList.remove('active');
            }

            updateUserUI() {
                if (this.state.currentUser) {
                    firebase.firestore().collection('users').doc(this.state.currentUser.uid).get()
                        .then(doc => {
                            if (doc.exists) {
                                const userData = doc.data();
                                this.elements.userName.textContent = userData.name;
                                this.elements.userHandle.textContent = `@${userData.username}`;
                                
                                const initials = userData.name.split(' ').map(n => n[0]).join('').toUpperCase();
                                this.elements.userAvatar.textContent = initials;
                                this.elements.currentUserAvatar.textContent = initials;
                            }
                        });
                }
            }

            // Navigation Methods
            navigateToPage(pageId) {
                document.querySelectorAll('.page-content, .keypad-container').forEach(page => {
                    page.classList.remove('active');
                });
                
                document.getElementById(pageId).classList.add('active');
                
                document.querySelectorAll('.nav-item, .sidebar-link').forEach(item => {
                    item.classList.remove('active');
                });
                
                document.querySelectorAll(`[data-page="${pageId}"]`).forEach(item => {
                    item.classList.add('active');
                });
                
                this.state.currentPage = pageId;
                
                if (pageId === 'homePage') {
                    this.loadPosts();
                }
            }

            toggleSidebar() {
                this.elements.sidebar.classList.toggle('active');
                this.elements.sidebarOverlay.classList.toggle('active');
            }

            // Theme Methods
            toggleTheme() {
                this.state.theme = this.state.theme === 'light' ? 'dark' : 'light';
                document.body.classList.toggle('dark-mode');
                
                const icon = this.elements.themeToggleSidebar.querySelector('i');
                const text = this.elements.themeToggleSidebar.querySelector('span');
                
                if (this.state.theme === 'dark') {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                    text.textContent = 'Light Mode';
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                    text.textContent = 'Dark Mode';
                }
                
                localStorage.setItem('theme', this.state.theme);
            }

            loadTheme() {
                const savedTheme = localStorage.getItem('theme') || 'light';
                this.state.theme = savedTheme;
                
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-mode');
                    this.elements.themeToggleSidebar.querySelector('i').classList.remove('fa-moon');
                    this.elements.themeToggleSidebar.querySelector('i').classList.add('fa-sun');
                    this.elements.themeToggleSidebar.querySelector('span').textContent = 'Light Mode';
                }
            }

            // Keypad Methods
            handleKeyPress(number) {
                this.state.phoneNumber += number;
                this.updatePhoneNumberDisplay();
                this.playKeySound(number);
            }

            handleBackspace() {
                this.state.phoneNumber = this.state.phoneNumber.slice(0, -1);
                this.updatePhoneNumberDisplay();
                this.playTone(220, 100);
            }

            updatePhoneNumberDisplay() {
                if (this.state.phoneNumber === '') {
                    this.elements.phoneNumberDisplay.textContent = 'Enter number';
                    this.elements.phoneNumberDisplay.style.color = 'var(--gray-color)';
                } else {
                    let formattedNumber = this.state.phoneNumber;
                    if (formattedNumber.length > 3 && formattedNumber.length <= 6) {
                        formattedNumber = formattedNumber.replace(/(\d{3})(\d+)/, '$1-$2');
                    } else if (formattedNumber.length > 6) {
                        formattedNumber = formattedNumber.replace(/(\d{3})(\d{3})(\d+)/, '$1-$2-$3');
                    }
                    
                    this.elements.phoneNumberDisplay.textContent = formattedNumber;
                    this.elements.phoneNumberDisplay.style.color = 'var(--text-color)';
                }
            }

            // Calling Methods
            async handleCall() {
                if (this.state.phoneNumber === '') {
                    this.showNotification('Error', 'Please enter a phone number');
                    return;
                }

                if (!this.state.isLoggedIn) {
                    this.showNotification('Authentication Required', 'Please create an account to make calls');
                    this.showAuthModal();
                    return;
                }

                await this.startCall();
            }

            async startCall() {
                this.state.isCalling = true;
                this.state.callTimer = 0;
                
                this.elements.callerName.textContent = this.state.phoneNumber;
                this.elements.callerAvatar.textContent = this.state.phoneNumber.substring(0, 2).toUpperCase();
                this.elements.callStatus.textContent = 'Calling...';
                this.elements.callTimer.textContent = '00:00';
                
                this.elements.callingScreen.classList.add('active');
                
                // Initialize Agora client for calling
                try {
                    if (typeof agoraManager !== 'undefined') {
                        this.state.agoraClient = agoraManager;
                        await agoraManager.initialize();
                        await agoraManager.joinChannel('connectx_channel', this.state.currentUser.uid);
                    }
                    
                    // Simulate call connection
                    setTimeout(() => {
                        if (this.state.isCalling) {
                            this.state.callInterval = setInterval(() => {
                                this.state.callTimer++;
                                const minutes = Math.floor(this.state.callTimer / 60).toString().padStart(2, '0');
                                const seconds = (this.state.callTimer % 60).toString().padStart(2, '0');
                                this.elements.callTimer.textContent = `${minutes}:${seconds}`;
                                this.elements.callStatus.textContent = 'Connected';
                            }, 1000);
                        }
                    }, 2000);
                } catch (error) {
                    console.error('Error initializing call:', error);
                    this.showNotification('Call Error', 'Failed to initialize call. Please try again.');
                    this.endCall();
                }
            }

            async endCall() {
                this.state.isCalling = false;
                this.elements.callingScreen.classList.remove('active');
                
                if (this.state.callInterval) {
                    clearInterval(this.state.callInterval);
                    this.state.callInterval = null;
                }
                
                // Clean up Agora resources
                if (this.state.agoraClient && typeof agoraManager !== 'undefined') {
                    await agoraManager.leaveChannel();
                    this.state.agoraClient = null;
                }
                
                const duration = this.state.callTimer > 0 ? 
                    ` (${Math.floor(this.state.callTimer / 60)}:${(this.state.callTimer % 60).toString().padStart(2, '0')})` : '';
                this.showNotification('Call Ended', `Call with ${this.state.phoneNumber} ended${duration}`);
                
                this.state.phoneNumber = '';
                this.updatePhoneNumberDisplay();
            }

            toggleMute() {
                const icon = this.elements.muteCallBtn.querySelector('i');
                if (icon.classList.contains('fa-microphone')) {
                    icon.classList.remove('fa-microphone');
                    icon.classList.add('fa-microphone-slash');
                    this.showNotification('Microphone', 'Muted');
                    
                    // Mute the audio stream
                    if (this.state.agoraClient && typeof agoraManager !== 'undefined') {
                        agoraManager.muteAudio();
                    }
                } else {
                    icon.classList.remove('fa-microphone-slash');
                    icon.classList.add('fa-microphone');
                    this.showNotification('Microphone', 'Unmuted');
                    
                    // Unmute the audio stream
                    if (this.state.agoraClient && typeof agoraManager !== 'undefined') {
                        agoraManager.unmuteAudio();
                    }
                }
            }

            toggleSpeaker() {
                const icon = this.elements.speakerCallBtn.querySelector('i');
                if (icon.classList.contains('fa-volume-up')) {
                    icon.classList.remove('fa-volume-up');
                    icon.classList.add('fa-volume-mute');
                    this.showNotification('Speaker', 'Speaker off');
                } else {
                    icon.classList.remove('fa-volume-mute');
                    icon.classList.add('fa-volume-up');
                    this.showNotification('Speaker', 'Speaker on');
                }
            }

            // Post Methods
            async loadInitialData() {
                await this.loadPosts();
                this.loadTheme();
                this.initAudio();
            }

            async loadPosts() {
                try {
                    const snapshot = await firebase.firestore().collection('posts')
                        .orderBy('createdAt', 'desc')
                        .limit(10)
                        .get();
                    
                    this.state.posts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    this.renderPosts();
                } catch (error) {
                    console.error('Error loading posts:', error);
                    // Create demo posts if Firebase is not available
                    this.state.posts = this.createDemoPosts();
                    this.renderPosts();
                }
            }

            createDemoPosts() {
                return [
                    {
                        id: 'demo1',
                        content: 'Welcome to ConnectX! Start connecting with your friends and family.',
                        authorName: 'ConnectX Team',
                        createdAt: new Date().toISOString(),
                        likes: 15,
                        comments: 3,
                        shares: 2
                    },
                    {
                        id: 'demo2',
                        content: 'Just made my first call with ConnectX. The audio quality is amazing!',
                        authorName: 'Alex Johnson',
                        createdAt: new Date(Date.now() - 3600000).toISOString(),
                        likes: 8,
                        comments: 1,
                        shares: 0
                    }
                ];
            }

            renderPosts() {
                if (!this.state.posts.length) {
                    this.elements.postFeed.innerHTML = `
                        <div class="post">
                            <div class="post-content">
                                <p class="post-text">No posts yet. Be the first to share something!</p>
                            </div>
                        </div>
                    `;
                    return;
                }

                this.elements.postFeed.innerHTML = this.state.posts.map(post => `
                    <div class="post" data-post-id="${post.id}">
                        <div class="post-header">
                            <div class="post-avatar">${post.authorName ? post.authorName.charAt(0).toUpperCase() : 'U'}</div>
                            <div class="post-user-info">
                                <h4>${post.authorName || 'Unknown User'}</h4>
                                <p>${this.formatTime(post.createdAt)}</p>
                            </div>
                            <div class="post-options">
                                <i class="fas fa-ellipsis-h"></i>
                            </div>
                        </div>
                        <div class="post-content">
                            <p class="post-text">${post.content || ''}</p>
                            ${post.imageUrl ? `<img src="${post.imageUrl}" alt="Post image" class="post-image">` : ''}
                            ${post.videoUrl ? `<video controls class="post-image"><source src="${post.videoUrl}" type="video/mp4"></video>` : ''}
                            ${post.voiceUrl ? `
                                <div class="voice-note">
                                    <div class="play-btn">
                                        <i class="fas fa-play"></i>
                                    </div>
                                    <div class="waveform"></div>
                                    <div class="voice-duration">1:25</div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="post-stats">
                            <span>${post.likes || 0} likes</span>
                            <span>${post.comments || 0} comments</span>
                            <span>${post.shares || 0} shares</span>
                        </div>
                        <div class="post-actions-bar">
                            <div class="post-action-btn like-btn">
                                <i class="far fa-thumbs-up"></i>
                                <span>Like</span>
                            </div>
                            <div class="post-action-btn">
                                <i class="far fa-comment"></i>
                                <span>Comment</span>
                            </div>
                            <div class="post-action-btn">
                                <i class="fas fa-share"></i>
                                <span>Share</span>
                            </div>
                        </div>
                    </div>
                `).join('');

                // Add event listeners
                this.elements.postFeed.querySelectorAll('.like-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postElement = e.target.closest('.post');
                        const postId = postElement.getAttribute('data-post-id');
                        this.handleLikePost(postId, btn);
                    });
                });

                this.elements.postFeed.querySelectorAll('.play-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const waveform = this.nextElementSibling;
                        const isPlaying = waveform.style.animationPlayState === 'paused';
                        
                        if (isPlaying) {
                            waveform.style.animationPlayState = 'running';
                            this.innerHTML = '<i class="fas fa-pause"></i>';
                        } else {
                            waveform.style.animationPlayState = 'paused';
                            this.innerHTML = '<i class="fas fa-play"></i>';
                        }
                    });
                });
            }

            async createPost() {
                const content = this.elements.postInput.value.trim();
                if (!content || !this.state.isLoggedIn) return;

                try {
                    const postData = {
                        content: content,
                        authorId: this.state.currentUser.uid,
                        authorName: this.elements.userName.textContent,
                        createdAt: new Date().toISOString(),
                        likes: 0,
                        comments: 0,
                        shares: 0
                    };

                    // Handle media upload if present
                    const mediaFile = this.state.mediaFile;
                    if (mediaFile) {
                        const storageRef = firebase.storage().ref();
                        const fileRef = storageRef.child(`posts/${this.state.currentUser.uid}/${Date.now()}_${mediaFile.name}`);
                        await fileRef.put(mediaFile);
                        const downloadURL = await fileRef.getDownloadURL();
                        
                        if (mediaFile.type.startsWith('image/')) {
                            postData.imageUrl = downloadURL;
                        } else if (mediaFile.type.startsWith('video/')) {
                            postData.videoUrl = downloadURL;
                        }
                    }

                    await firebase.firestore().collection('posts').add(postData);

                    this.elements.postInput.value = '';
                    this.clearMediaPreview();
                    this.showNotification('Post Created', 'Your post has been published');
                    this.loadPosts();
                } catch (error) {
                    console.error('Error creating post:', error);
                    // Create post locally if Firebase fails
                    const demoPost = {
                        id: 'local_' + Date.now(),
                        content: content,
                        authorName: this.elements.userName.textContent,
                        createdAt: new Date().toISOString(),
                        likes: 0,
                        comments: 0,
                        shares: 0
                    };
                    this.state.posts.unshift(demoPost);
                    this.renderPosts();
                    this.elements.postInput.value = '';
                    this.clearMediaPreview();
                    this.showNotification('Post Created', 'Your post has been published (offline mode)');
                }
            }

            async handleLikePost(postId, button) {
                if (!this.state.isLoggedIn) {
                    this.showNotification('Authentication Required', 'Please login to like posts');
                    return;
                }

                button.classList.toggle('active');
                const icon = button.querySelector('i');
                
                if (button.classList.contains('active')) {
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    this.playTone(523.25, 100);
                    
                    // Update like count in Firestore
                    try {
                        const postRef = firebase.firestore().collection('posts').doc(postId);
                        await postRef.update({
                            likes: firebase.firestore.FieldValue.increment(1)
                        });
                        
                        await firebase.firestore().collection('posts').doc(postId).collection('likes').doc(this.state.currentUser.uid).set({
                            likedAt: new Date().toISOString()
                        });
                    } catch (error) {
                        console.error('Error liking post:', error);
                        // Update locally if Firebase fails
                        const post = this.state.posts.find(p => p.id === postId);
                        if (post) {
                            post.likes = (post.likes || 0) + 1;
                            this.renderPosts();
                        }
                    }
                } else {
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    
                    // Update like count in Firestore
                    try {
                        const postRef = firebase.firestore().collection('posts').doc(postId);
                        await postRef.update({
                            likes: firebase.firestore.FieldValue.increment(-1)
                        });
                        
                        await firebase.firestore().collection('posts').doc(postId).collection('likes').doc(this.state.currentUser.uid).delete();
                    } catch (error) {
                        console.error('Error unliking post:', error);
                        // Update locally if Firebase fails
                        const post = this.state.posts.find(p => p.id === postId);
                        if (post) {
                            post.likes = Math.max(0, (post.likes || 0) - 1);
                            this.renderPosts();
                        }
                    }
                }
                
                this.loadPosts();
            }

            handleAddPhoto() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        this.previewMedia(file);
                    }
                };
                input.click();
            }

            handleAddVoice() {
                if (!this.state.isLoggedIn) {
                    this.showNotification('Authentication Required', 'Please login to record voice notes');
                    return;
                }
                
                this.showNotification('Voice Note', 'Voice recording feature coming soon');
            }

            handleGoLive() {
                if (!this.state.isLoggedIn) {
                    this.showNotification('Authentication Required', 'Please login to go live');
                    return;
                }
                
                this.showNotification('Go Live', 'Live streaming feature coming soon');
            }

            previewMedia(file) {
                this.state.mediaFile = file;
                
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.elements.mediaPreview.innerHTML = `
                            <div class="media-preview">
                                <img src="${e.target.result}" alt="Preview">
                                <div class="remove-media" onclick="connectXApp.clearMediaPreview()">
                                    <i class="fas fa-times"></i>
                                </div>
                            </div>
                        `;
                    };
                    reader.readAsDataURL(file);
                } else if (file.type.startsWith('video/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.elements.mediaPreview.innerHTML = `
                            <div class="media-preview">
                                <video controls>
                                    <source src="${e.target.result}" type="${file.type}">
                                </video>
                                <div class="remove-media" onclick="connectXApp.clearMediaPreview()">
                                    <i class="fas fa-times"></i>
                                </div>
                            </div>
                        `;
                    };
                    reader.readAsDataURL(file);
                }
            }

            clearMediaPreview() {
                this.elements.mediaPreview.innerHTML = '';
                this.state.mediaFile = null;
            }

            // Utility Methods
            formatTime(timestamp) {
                if (!timestamp) return 'Just now';
                
                const now = new Date();
                const postTime = new Date(timestamp);
                const diff = now - postTime;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);

                if (days > 0) return `${days}d ago`;
                if (hours > 0) return `${hours}h ago`;
                if (minutes > 0) return `${minutes}m ago`;
                return 'Just now';
            }

            showNotification(title, message) {
                this.elements.notificationTitle.textContent = title;
                this.elements.notificationMessage.textContent = message;
                this.elements.notification.classList.add('active');
                
                setTimeout(() => {
                    this.elements.notification.classList.remove('active');
                }, 5000);
            }

            // Audio Methods
            initAudio() {
                try {
                    this.state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log('Audio context initialized');
                return true;
                } catch (e) {
                    console.log('Web Audio API not supported');
                    return false;
                }
            }

            playKeySound(number) {
                const frequencies = {
                    '1': {f1: 697, f2: 1209}, '2': {f1: 697, f2: 1336}, '3': {f1: 697, f2: 1477},
                    '4': {f1: 770, f2: 1209}, '5': {f1: 770, f2: 1336}, '6': {f1: 770, f2: 1477},
                    '7': {f1: 852, f2: 1209}, '8': {f1: 852, f2: 1336}, '9': {f1: 852, f2: 1477},
                    '*': {f1: 941, f2: 1209}, '0': {f1: 941, f2: 1336}, '#': {f1: 941, f2: 1477}
                };

                if (frequencies[number] && this.state.audioContext) {
                    this.playDTMFTone(frequencies[number].f1, frequencies[number].f2);
                }
            }

            playDTMFTone(f1, f2) {
                if (!this.state.audioContext) return;

                const oscillator1 = this.state.audioContext.createOscillator();
                const oscillator2 = this.state.audioContext.createOscillator();
                const gainNode = this.state.audioContext.createGain();

                oscillator1.type = 'sine';
                oscillator1.frequency.value = f1;
                oscillator2.type = 'sine';
                oscillator2.frequency.value = f2;
                gainNode.gain.value = 0.1;

                oscillator1.connect(gainNode);
                oscillator2.connect(gainNode);
                gainNode.connect(this.state.audioContext.destination);

                oscillator1.start();
                oscillator2.start();

                setTimeout(() => {
                    oscillator1.stop();
                    oscillator2.stop();
                }, 100);
            }

            playTone(frequency, duration) {
                if (!this.state.audioContext) return;

                const oscillator = this.state.audioContext.createOscillator();
                const gainNode = this.state.audioContext.createGain();

                oscillator.type = 'sine';
                oscillator.frequency.value = frequency;
                gainNode.gain.value = 0.1;

                oscillator.connect(gainNode);
                gainNode.connect(this.state.audioContext.destination);

                oscillator.start();
                setTimeout(() => oscillator.stop(), duration);
            }
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.connectXApp = new ConnectXApp();
        });
    </script>
</body>
</html>
