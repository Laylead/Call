<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkMonetize Pro | Professional URL Monetization</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <!-- External Configuration Files -->
    <script src="configuration.js"></script>
    <script src="app.js"></script>
    
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #4cc9f0;
            --danger: #f72585;
            --warning: #f8961e;
            --dark: #212529;
            --light: #f8f9fa;
            --gray: #6c757d;
            --border: #dee2e6;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fb;
            color: var(--dark);
            min-height: 100vh;
        }

        /* Auth Styles */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fb 0%, #e4e8f5 100%);
        }

        .auth-box {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 400px;
            padding: 40px 30px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border);
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: all 0.3s;
        }

        .auth-tab.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: border 0.3s;
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 14px 20px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .auth-footer {
            margin-top: 20px;
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* Landing Page Styles */
        .landing-container {
            display: none;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fb 0%, #e4e8f5 100%);
        }

        .container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 600px;
            padding: 50px 40px;
            text-align: center;
            border: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }

        .logo {
            margin-bottom: 30px;
        }

        .logo h1 {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            letter-spacing: -0.5px;
        }

        .logo .tagline {
            color: var(--gray);
            font-size: 1rem;
            margin-top: 8px;
            font-weight: 400;
        }

        h2 {
            color: var(--dark);
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 1.8rem;
        }

        p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .timer-container {
            margin: 40px 0;
            padding: 30px;
            background-color: #f9f9f9;
            border-radius: 10px;
            border: 1px solid #eee;
        }

        .timer {
            font-size: 4.5rem;
            font-weight: 700;
            color: var(--primary);
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .timer-label {
            color: var(--gray);
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        .buttons-container {
            display: none;
            margin-top: 40px;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn-landing {
            background: #ffffff;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 16px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-landing:hover {
            background: var(--primary);
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: var(--primary);
            color: #ffffff;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        .loader {
            display: inline-block;
            width: 60px;
            height: 60px;
            margin: 20px auto;
        }

        .loader:after {
            content: " ";
            display: block;
            width: 48px;
            height: 48px;
            margin: 8px;
            border-radius: 50%;
            border: 4px solid var(--primary);
            border-color: var(--primary) transparent var(--primary) transparent;
            animation: loader 1.2s linear infinite;
        }

        @keyframes loader {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .instructions {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary);
            padding: 20px;
            margin: 30px 0;
            text-align: left;
            border-radius: 0 8px 8px 0;
        }

        .instructions h3 {
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .instructions ul {
            padding-left: 20px;
            color: #555;
        }

        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .footer {
            margin-top: 40px;
            color: #95a5a6;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        /* Dashboard Styles */
        .dashboard-container {
            display: none;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background: var(--dark);
            color: white;
            height: 100vh;
            position: fixed;
            padding: 20px 0;
            transition: all 0.3s;
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .sidebar-header h2 {
            color: white;
            font-size: 1.5rem;
            margin: 0;
        }

        .sidebar-menu {
            list-style: none;
            padding: 0;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .sidebar-menu i {
            margin-right: 10px;
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
            width: calc(100% - 250px);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .header h1 {
            font-size: 1.8rem;
            color: var(--dark);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 1.5rem;
        }

        .stat-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .stat-info p {
            color: var(--gray);
            margin: 0;
            font-size: 0.9rem;
        }

        .chart-container {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .section-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .links-table {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            color: var(--gray);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            color: var(--dark);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .subscription-timer {
            background: var(--warning);
            color: white;
            padding: 10px 15px;
            border-radius: var(--radius);
            display: inline-flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .subscription-timer i {
            margin-right: 10px;
        }

        .admin-controls {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .admin-section {
            display: none;
        }

        .alert {
            padding: 12px 15px;
            border-radius: var(--radius);
            margin-bottom: 20px;
        }

        .alert-danger {
            background: rgba(247, 37, 133, 0.1);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .alert-success {
            background: rgba(76, 201, 240, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .system-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .system-stat {
            background: white;
            padding: 15px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--shadow);
        }

        .system-stat h3 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .system-stat p {
            color: var(--gray);
            margin: 0;
            font-size: 0.9rem;
        }

        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
                overflow: hidden;
            }
            
            .sidebar-header h2, .sidebar-menu span {
                display: none;
            }
            
            .sidebar-menu i {
                margin-right: 0;
                font-size: 1.5rem;
            }
            
            .main-content {
                margin-left: 70px;
                width: calc(100% - 70px);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
            }
            
            .logo h1 {
                font-size: 1.8rem;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            .timer {
                font-size: 3.5rem;
            }
            
            .btn-landing {
                padding: 14px 30px;
                min-width: 160px;
                font-size: 1rem;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 576px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            
            .sidebar-menu {
                display: flex;
                overflow-x: auto;
            }
            
            .sidebar-menu li {
                flex: 0 0 auto;
                margin-bottom: 0;
            }
            
            .sidebar-menu a {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">Login</div>
                <div class="auth-tab" data-tab="signup">Sign Up</div>
            </div>
            
            <div class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" class="form-control" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password">
                </div>
                <button class="btn" id="loginBtn">Login</button>
                <div class="auth-footer">
                    Don't have an account? <a href="#" id="showSignup">Sign up</a>
                </div>
            </div>
            
            <div class="auth-form" id="signupForm">
                <div class="form-group">
                    <label for="signupName">Full Name</label>
                    <input type="text" id="signupName" class="form-control" placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" class="form-control" placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" class="form-control" placeholder="Create a password">
                </div>
                <button class="btn" id="signupBtn">Sign Up</button>
                <div class="auth-footer">
                    Already have an account? <a href="#" id="showLogin">Login</a>
                </div>
            </div>
            
            <div id="authMessage" class="alert" style="display: none;"></div>
        </div>
    </div>

    <!-- Landing Page -->
    <div class="landing-container" id="landingPage">
        <div class="container">
            <div class="logo">
                <h1>ACCESS PORTAL</h1>
                <div class="tagline">Professional Content Delivery</div>
            </div>
            
            <h2>Your Request Is Being Processed</h2>
            
            <p>Thank you for your interest. We're preparing your content for access. Please wait a moment while we complete the setup.</p>
            
            <div class="instructions">
                <h3>How to Access Your Content:</h3>
                <ul>
                    <li>Wait for the countdown to complete</li>
                    <li>Click on either access button that appears</li>
                    <li>Follow the on-screen instructions</li>
                </ul>
            </div>
            
            <div class="timer-container">
                <div class="loader"></div>
                <div class="timer">5</div>
                <div class="timer-label">Seconds Remaining</div>
            </div>
            
            <div class="buttons-container" id="buttonsContainer">
                <button class="btn-landing btn-primary" id="accessBtn1">Access Content Now</button>
                <button class="btn-landing" id="accessBtn2">Continue to Portal</button>
            </div>
            
            <div class="footer">
                &copy; 2023 Professional Access Portal. All rights reserved.
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard-container" id="dashboard">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>LinkMonetize Pro</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" class="active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                <li><a href="#" data-section="links"><i class="fas fa-link"></i> <span>My Links</span></a></li>
                <li><a href="#" data-section="analytics"><i class="fas fa-chart-bar"></i> <span>Analytics</span></a></li>
                <li><a href="#" data-section="settings"><i class="fas fa-cog"></i> <span>Settings</span></a></li>
                <li><a href="#" data-section="admin" id="adminLink" style="display: none;"><i class="fas fa-user-shield"></i> <span>Admin</span></a></li>
                <li><a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a></li>
            </ul>
        </div>
        
        <div class="main-content">
            <div class="header">
                <h1 id="pageTitle">Dashboard</h1>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">JD</div>
                    <div>
                        <div id="userName">John Doe</div>
                        <div id="userStatus" class="text-muted">Free User</div>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Section -->
            <div class="section" id="dashboardSection">
                <div class="subscription-timer" id="subscriptionTimer" style="display: none;">
                    <i class="fas fa-clock"></i>
                    <span id="timerDisplay">Your subscription expires in 15 days</span>
                </div>
                
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--primary);">
                            <i class="fas fa-link" style="color: white;"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalLinks">0</h3>
                            <p>Total Links</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--success);">
                            <i class="fas fa-mouse" style="color: white;"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalClicks">0</h3>
                            <p>Total Clicks</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--secondary);">
                            <i class="fas fa-dollar-sign" style="color: white;"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="totalEarnings">$0.00</h3>
                            <p>Total Earnings</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--warning);">
                            <i class="fas fa-chart-line" style="color: white;"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="conversionRate">0%</h3>
                            <p>Conversion Rate</p>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="section-title">
                        <span>Clicks Overview</span>
                    </div>
                    <canvas id="clicksChart" height="100"></canvas>
                </div>
                
                <div class="links-table">
                    <div class="section-title">
                        <span>Recent Links</span>
                        <button class="btn btn-primary" id="createLinkBtn">Create New Link</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Destination URL</th>
                                <th>Clicks</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="linksTableBody">
                            <tr><td colspan="5" style="text-align: center;">No links created yet</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Links Section -->
            <div class="section" id="linksSection" style="display: none;">
                <div class="section-title">
                    <span>My Links</span>
                    <button class="btn btn-primary" id="createLinkBtn2">Create New Link</button>
                </div>
                <div class="links-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Short URL</th>
                                <th>Destination URL</th>
                                <th>Clicks</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="allLinksTableBody">
                            <tr><td colspan="6" style="text-align: center;">No links created yet</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Analytics Section -->
            <div class="section" id="analyticsSection" style="display: none;">
                <div class="section-title">
                    <span>Analytics Overview</span>
                </div>
                
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--primary);">
                            <i class="fas fa-users" style="color: white;"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="uniqueVisitors">0</h3>
                            <p>Unique Visitors</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--success);">
                            <i class="fas fa-mouse-pointer" style="color: white;"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="analyticsTotalClicks">0</h3>
                            <p>Total Clicks</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--secondary);">
                            <i class="fas fa-globe" style="color: white;"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="countriesCount">0</h3>
                            <p>Countries</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--warning);">
                            <i class="fas fa-clock" style="color: white;"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="avgSession">0s</h3>
                            <p>Avg. Session</p>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="section-title">
                        <span>Clicks by Date</span>
                    </div>
                    <canvas id="analyticsChart" height="100"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="section-title">
                        <span>Top Performing Links</span>
                    </div>
                    <canvas id="topLinksChart" height="100"></canvas>
                </div>
            </div>
            
            <!-- Settings Section -->
            <div class="section" id="settingsSection" style="display: none;">
                <div class="section-title">
                    <span>Account Settings</span>
                </div>
                
                <div class="admin-controls">
                    <h3>Adsterra Configuration</h3>
                    <div class="form-group">
                        <label for="adsterraLink">Your Adsterra Link</label>
                        <input type="url" id="adsterraLink" class="form-control" placeholder="https://your-adsterra-link.com">
                    </div>
                    <button class="btn btn-primary" id="saveAdsterra">Save Adsterra Link</button>
                </div>
                
                <div class="admin-controls">
                    <h3>Subscription</h3>
                    <div id="subscriptionInfo">
                        <p>Your current plan: <strong id="currentPlan">Free</strong></p>
                        <p id="nextBillingInfo" style="display: none;">Next billing date: <strong id="nextBillingDate">N/A</strong></p>
                    </div>
                    <button class="btn btn-warning" id="upgradePlan">Upgrade Plan</button>
                </div>
                
                <div class="admin-controls">
                    <h3>Profile Settings</h3>
                    <div class="form-group">
                        <label for="userNameInput">Full Name</label>
                        <input type="text" id="userNameInput" class="form-control" placeholder="Your Name">
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Email Address</label>
                        <input type="email" id="userEmail" class="form-control" placeholder="your@email.com">
                    </div>
                    <button class="btn btn-primary" id="saveProfile">Save Profile</button>
                </div>
            </div>
            
            <!-- Admin Section -->
            <div class="section admin-section" id="adminSection" style="display: none;">
                <div class="section-title">
                    <span>Admin Controls</span>
                </div>
                
                <div class="system-stats" id="systemStats">
                    <!-- System stats will be loaded here -->
                </div>
                
                <div class="admin-controls">
                    <h3>System Configuration</h3>
                    <div class="form-group">
                        <label for="adminAdsterraLink">Admin Adsterra Link</label>
                        <input type="url" id="adminAdsterraLink" class="form-control" placeholder="https://admin-adsterra-link.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="subscriptionToggle">Enable Monthly Subscriptions</label>
                        <select id="subscriptionToggle" class="form-control">
                            <option value="enabled">Enabled</option>
                            <option value="disabled">Disabled</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="subscriptionPrice">Subscription Price</label>
                        <input type="text" id="subscriptionPrice" class="form-control" placeholder="$9.99">
                    </div>
                    
                    <div class="form-group">
                        <label for="supportLink">Contact Support Link</label>
                        <input type="url" id="supportLink" class="form-control" placeholder="https://support.yoursite.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="renewLink">Renew Subscription Link</label>
                        <input type="url" id="renewLink" class="form-control" placeholder="https://payment.yoursite.com">
                    </div>
                    
                    <button class="btn btn-primary" id="saveAdminConfig">Save Configuration</button>
                </div>
                
                <div class="admin-controls">
                    <h3>User Management</h3>
                    <div class="links-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Email</th>
                                    <th>Status</th>
                                    <th>Subscription</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr><td colspan="5" style="text-align: center;">Loading users...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Link Modal -->
    <div class="modal" id="createLinkModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New Link</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="linkName">Link Name</label>
                <input type="text" id="linkName" class="form-control" placeholder="My Awesome Link">
            </div>
            <div class="form-group">
                <label for="destinationUrl">Destination URL</label>
                <input type="url" id="destinationUrl" class="form-control" placeholder="https://example.com">
            </div>
            <button class="btn btn-primary" id="generateLink">Generate Link</button>
        </div>
    </div>

    <!-- Account Locked Modal -->
    <div class="modal" id="lockedAccountModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Account Locked</h3>
            </div>
            <p id="lockedAccountMessage">Your account has been temporarily locked. Please contact support for assistance.</p>
            <button class="btn btn-primary" id="contactSupport">Contact Support</button>
        </div>
    </div>

    <!-- Subscription Expired Modal -->
    <div class="modal" id="subscriptionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Subscription Expired</h3>
            </div>
            <p>Your subscription has expired. Please renew to continue using our services.</p>
            <button class="btn btn-primary" id="renewSubscription">Renew Now</button>
        </div>
    </div>

    <script>
        // Main Application Logic
        class LinkMonetizeApp {
            constructor() {
                this.currentUser = null;
                this.userData = null;
                this.links = [];
                this.analytics = [];
                this.adminUsers = [];
                this.charts = {};
                this.adminManager = null;
                this.adminConfig = null;
                
                this.initFirebase();
                this.initEventListeners();
                this.checkAuthState();
            }
            
            initFirebase() {
                firebase.initializeApp(firebaseConfig);
                this.auth = firebase.auth();
                this.db = firebase.firestore();
                this.adminManager = new AdminManager(this.db);
            }
            
            initEventListeners() {
                // Auth Event Listeners
                document.getElementById('showSignup').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showAuthTab('signup');
                });
                
                document.getElementById('showLogin').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showAuthTab('login');
                });
                
                document.querySelectorAll('.auth-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        this.showAuthTab(tab.dataset.tab);
                    });
                });
                
                document.getElementById('loginBtn').addEventListener('click', () => {
                    this.login();
                });
                
                document.getElementById('signupBtn').addEventListener('click', () => {
                    this.signup();
                });
                
                document.getElementById('logoutBtn').addEventListener('click', () => {
                    this.logout();
                });
                
                // Dashboard Navigation
                document.querySelectorAll('.sidebar-menu a').forEach(link => {
                    if (link.id !== 'logoutBtn') {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            this.showSection(link.dataset.section);
                        });
                    }
                });
                
                // Link Management
                document.getElementById('createLinkBtn').addEventListener('click', () => {
                    this.showCreateLinkModal();
                });
                
                document.getElementById('createLinkBtn2').addEventListener('click', () => {
                    this.showCreateLinkModal();
                });
                
                document.querySelector('.close-modal').addEventListener('click', () => {
                    document.getElementById('createLinkModal').style.display = 'none';
                });
                
                document.getElementById('generateLink').addEventListener('click', () => {
                    this.createLink();
                });
                
                // Settings
                document.getElementById('saveAdsterra').addEventListener('click', () => {
                    this.saveAdsterraLink();
                });
                
                document.getElementById('saveProfile').addEventListener('click', () => {
                    this.saveProfile();
                });
                
                document.getElementById('upgradePlan').addEventListener('click', () => {
                    this.upgradePlan();
                });
                
                // Admin
                document.getElementById('saveAdminConfig').addEventListener('click', () => {
                    this.saveAdminConfig();
                });
                
                // Modal buttons
                document.getElementById('contactSupport').addEventListener('click', () => {
                    if (this.adminConfig) {
                        window.open(this.adminConfig.contactSupportLink, '_blank');
                    }
                });
                
                document.getElementById('renewSubscription').addEventListener('click', () => {
                    if (this.adminConfig) {
                        window.open(this.adminConfig.renewSubscriptionLink, '_blank');
                    }
                });
                
                // Landing page buttons
                document.getElementById('accessBtn1').addEventListener('click', () => {
                    this.handleLandingButtonClick();
                });
                
                document.getElementById('accessBtn2').addEventListener('click', () => {
                    this.handleLandingButtonClick();
                });
            }
            
            async login() {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                if (!email || !password) {
                    this.showAuthMessage('Please fill in all fields', 'danger');
                    return;
                }
                
                try {
                    const result = await this.auth.signInWithEmailAndPassword(email, password);
                    this.currentUser = result.user;
                    this.showAuthMessage('Login successful!', 'success');
                    
                    await this.loadUserData();
                    this.showDashboard();
                } catch (error) {
                    this.showAuthMessage(error.message, 'danger');
                }
            }
            
            async signup() {
                const name = document.getElementById('signupName').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                
                if (!name || !email || !password) {
                    this.showAuthMessage('Please fill in all fields', 'danger');
                    return;
                }
                
                try {
                    const result = await this.auth.createUserWithEmailAndPassword(email, password);
                    this.currentUser = result.user;
                    
                    // Check if user should be admin
                    const isAdmin = CONFIG.adminEmails.includes(email);
                    
                    await this.db.collection('users').doc(this.currentUser.uid).set({
                        name: name,
                        email: email,
                        adsterraLink: '',
                        isAdmin: isAdmin,
                        subscription: 'free',
                        subscriptionEndDate: null,
                        accountLocked: false,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    this.showAuthMessage('Account created successfully!', 'success');
                    
                    await this.loadUserData();
                    this.showDashboard();
                } catch (error) {
                    this.showAuthMessage(error.message, 'danger');
                }
            }
            
            async logout() {
                try {
                    await this.auth.signOut();
                    this.currentUser = null;
                    this.userData = null;
                    this.showAuth();
                } catch (error) {
                    console.error('Logout error:', error);
                }
            }
            
            showAuthMessage(message, type) {
                const messageEl = document.getElementById('authMessage');
                messageEl.textContent = message;
                messageEl.className = `alert alert-${type}`;
                messageEl.style.display = 'block';
                
                setTimeout(() => {
                    messageEl.style.display = 'none';
                }, 5000);
            }
            
            checkAuthState() {
                this.auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        this.currentUser = user;
                        await this.loadUserData();
                        
                        if (this.userData.accountLocked) {
                            this.showLockedAccountModal();
                            return;
                        }
                        
                        const urlParams = new URLSearchParams(window.location.search);
                        const linkId = urlParams.get('id');
                        
                        if (linkId) {
                            this.showLandingPage(linkId);
                        } else {
                            this.showDashboard();
                        }
                    } else {
                        this.showAuth();
                    }
                });
            }
            
            async loadUserData() {
                if (!this.currentUser) return;
                
                try {
                    const userDoc = await this.db.collection('users').doc(this.currentUser.uid).get();
                    if (userDoc.exists) {
                        this.userData = userDoc.data();
                        
                        // Load admin config
                        this.adminConfig = await this.adminManager.getAdminConfig();
                        if (!this.adminConfig) {
                            await this.adminManager.initializeAdminConfig();
                            this.adminConfig = await this.adminManager.getAdminConfig();
                        }
                        
                        await this.loadUserLinks();
                        await this.loadAnalytics();
                        
                        if (this.userData.isAdmin) {
                            document.getElementById('adminLink').style.display = 'block';
                            await this.loadAdminUsers();
                        }
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                }
            }
            
            async loadUserLinks() {
                if (!this.currentUser) return;
                
                try {
                    const linksSnapshot = await this.db
                        .collection('links')
                        .where('userId', '==', this.currentUser.uid)
                        .orderBy('createdAt', 'desc')
                        .get();
                    
                    this.links = [];
                    linksSnapshot.forEach(doc => {
                        this.links.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    this.updateLinksUI();
                } catch (error) {
                    console.error('Error loading links:', error);
                }
            }
            
            async loadAnalytics() {
                if (!this.currentUser) return;
                
                try {
                    const now = new Date();
                    const analyticsData = [];
                    
                    for (let i = 6; i >= 0; i--) {
                        const date = new Date(now);
                        date.setDate(date.getDate() - i);
                        analyticsData.push({
                            date: date.toISOString().split('T')[0],
                            clicks: Math.floor(Math.random() * 50) + 10
                        });
                    }
                    
                    this.analytics = analyticsData;
                    this.updateAnalyticsUI();
                } catch (error) {
                    console.error('Error loading analytics:', error);
                }
            }
            
            async loadAdminUsers() {
                try {
                    this.adminUsers = await this.adminManager.getAllUsers();
                    this.updateAdminUI();
                } catch (error) {
                    console.error('Error loading admin data:', error);
                }
            }
            
            showAuth() {
                document.getElementById('authContainer').style.display = 'flex';
                document.getElementById('landingPage').style.display = 'none';
                document.getElementById('dashboard').style.display = 'none';
            }
            
            showDashboard() {
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('landingPage').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                
                this.updateDashboardUI();
                this.showSection('dashboard');
            }
            
            showLandingPage(linkId) {
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('landingPage').style.display = 'flex';
                
                this.startLandingTimer(linkId);
            }
            
            showSection(section) {
                document.querySelectorAll('.sidebar-menu a').forEach(a => {
                    a.classList.remove('active');
                });
                document.querySelector(`.sidebar-menu a[data-section="${section}"]`).classList.add('active');
                
                document.querySelectorAll('.section').forEach(sec => {
                    sec.style.display = 'none';
                });
                document.getElementById(`${section}Section`).style.display = 'block';
                
                document.getElementById('pageTitle').textContent = 
                    document.querySelector(`.sidebar-menu a[data-section="${section}"] span`).textContent;
                
                if (section === 'admin') {
                    this.initAdminSection();
                }
                
                if (section === 'dashboard' || section === 'analytics') {
                    setTimeout(() => {
                        this.initCharts();
                    }, 100);
                }
            }
            
            updateDashboardUI() {
                if (!this.userData) return;
                
                document.getElementById('userName').textContent = this.userData.name;
                document.getElementById('userAvatar').textContent = 
                    this.userData.name.split(' ').map(n => n[0]).join('');
                
                document.getElementById('totalLinks').textContent = this.links.length;
                const totalClicks = this.links.reduce((sum, link) => sum + (link.clicks || 0), 0);
                document.getElementById('totalClicks').textContent = totalClicks.toLocaleString();
                document.getElementById('totalEarnings').textContent = `$${(totalClicks * 0.01).toFixed(2)}`;
                
                // Update subscription info
                if (this.adminConfig && this.adminConfig.subscriptionEnabled && this.userData.subscription !== 'free') {
                    const timerElement = document.getElementById('subscriptionTimer');
                    timerElement.style.display = 'inline-flex';
                    
                    if (this.userData.subscriptionEndDate) {
                        const now = new Date();
                        const endDate = this.userData.subscriptionEndDate.toDate();
                        const diffTime = endDate - now;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        
                        document.getElementById('timerDisplay').textContent = 
                            `Your subscription expires in ${diffDays} days`;
                        
                        if (diffDays <= 0) {
                            document.getElementById('subscriptionModal').style.display = 'flex';
                        }
                    }
                }
                
                // Update settings form
                document.getElementById('adsterraLink').value = this.userData.adsterraLink || '';
                document.getElementById('userNameInput').value = this.userData.name;
                document.getElementById('userEmail').value = this.userData.email;
                document.getElementById('currentPlan').textContent = this.userData.subscription || 'Free';
                
                if (this.userData.subscriptionEndDate) {
                    document.getElementById('nextBillingInfo').style.display = 'block';
                    document.getElementById('nextBillingDate').textContent = 
                        this.userData.subscriptionEndDate.toDate().toLocaleDateString();
                }
            }
            
            updateLinksUI() {
                const linksTableBody = document.getElementById('linksTableBody');
                const allLinksTableBody = document.getElementById('allLinksTableBody');
                
                linksTableBody.innerHTML = '';
                allLinksTableBody.innerHTML = '';
                
                if (this.links.length === 0) {
                    linksTableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No links created yet</td></tr>';
                    allLinksTableBody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No links created yet</td></tr>';
                    return;
                }
                
                this.links.forEach(link => {
                    const shortUrl = `${this.adminConfig.baseUrl}?id=${link.id}`;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${link.name}</td>
                        <td>${link.destinationUrl}</td>
                        <td>${link.clicks || 0}</td>
                        <td>${this.formatDate(link.createdAt)}</td>
                        <td class="action-buttons">
                            <button class="btn-sm btn-success copy-link" data-url="${shortUrl}">Copy</button>
                            <button class="btn-sm btn-warning" onclick="app.editLink('${link.id}')">Edit</button>
                            <button class="btn-sm btn-danger" onclick="app.deleteLink('${link.id}')">Delete</button>
                        </td>
                    `;
                    linksTableBody.appendChild(row);
                    
                    const allRow = document.createElement('tr');
                    allRow.innerHTML = `
                        <td>${link.name}</td>
                        <td>${shortUrl}</td>
                        <td>${link.destinationUrl}</td>
                        <td>${link.clicks || 0}</td>
                        <td>${this.formatDate(link.createdAt)}</td>
                        <td class="action-buttons">
                            <button class="btn-sm btn-success copy-link" data-url="${shortUrl}">Copy</button>
                            <button class="btn-sm btn-warning" onclick="app.editLink('${link.id}')">Edit</button>
                            <button class="btn-sm btn-danger" onclick="app.deleteLink('${link.id}')">Delete</button>
                        </td>
                    `;
                    allLinksTableBody.appendChild(allRow);
                });
                
                document.querySelectorAll('.copy-link').forEach(button => {
                    button.addEventListener('click', () => {
                        const url = button.getAttribute('data-url');
                        navigator.clipboard.writeText(url).then(() => {
                            alert('Link copied to clipboard!');
                        });
                    });
                });
            }
            
            updateAnalyticsUI() {
                if (!this.analytics.length) return;
                
                const totalClicks = this.analytics.reduce((sum, day) => sum + day.clicks, 0);
                document.getElementById('analyticsTotalClicks').textContent = totalClicks.toLocaleString();
                document.getElementById('uniqueVisitors').textContent = Math.floor(totalClicks * 0.7).toLocaleString();
                document.getElementById('countriesCount').textContent = Math.floor(Math.random() * 50) + 10;
                document.getElementById('avgSession').textContent = `${Math.floor(Math.random() * 30) + 10}s`;
            }
            
            async initAdminSection() {
                // Load system stats
                const stats = await this.adminManager.getSystemStats();
                if (stats) {
                    const systemStatsEl = document.getElementById('systemStats');
                    systemStatsEl.innerHTML = `
                        <div class="system-stat">
                            <h3>${stats.totalUsers}</h3>
                            <p>Total Users</p>
                        </div>
                        <div class="system-stat">
                            <h3>${stats.totalLinks}</h3>
                            <p>Total Links</p>
                        </div>
                        <div class="system-stat">
                            <h3>${stats.totalClicks}</h3>
                            <p>Total Clicks</p>
                        </div>
                        <div class="system-stat">
                            <h3>$${stats.totalEarnings}</h3>
                            <p>Total Earnings</p>
                        </div>
                    `;
                }
                
                this.updateAdminUI();
            }
            
            updateAdminUI() {
                const usersTableBody = document.getElementById('usersTableBody');
                usersTableBody.innerHTML = '';
                
                if (this.adminUsers.length === 0) {
                    usersTableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No users found</td></tr>';
                    return;
                }
                
                this.adminUsers.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.name}</td>
                        <td>${user.email}</td>
                        <td>${user.accountLocked ? 'Locked' : 'Active'}</td>
                        <td>${user.subscription || 'Free'}</td>
                        <td class="action-buttons">
                            <button class="btn-sm ${user.accountLocked ? 'btn-success' : 'btn-danger'}" 
                                onclick="app.toggleUserLock('${user.id}', ${!user.accountLocked})">
                                ${user.accountLocked ? 'Unlock' : 'Lock'}
                            </button>
                            ${!user.isAdmin ? `<button class="btn-sm btn-warning" onclick="app.makeUserAdmin('${user.id}')">Make Admin</button>` : ''}
                        </td>
                    `;
                    usersTableBody.appendChild(row);
                });
                
                // Load admin config into form
                if (this.adminConfig) {
                    document.getElementById('adminAdsterraLink').value = this.adminConfig.adminAdsterraLink;
                    document.getElementById('subscriptionToggle').value = 
                        this.adminConfig.subscriptionEnabled ? 'enabled' : 'disabled';
                    document.getElementById('subscriptionPrice').value = this.adminConfig.subscriptionPrice;
                    document.getElementById('supportLink').value = this.adminConfig.contactSupportLink;
                    document.getElementById('renewLink').value = this.adminConfig.renewSubscriptionLink;
                }
            }
            
            initCharts() {
                // Clicks Chart
                const clicksCtx = document.getElementById('clicksChart');
                if (clicksCtx) {
                    if (this.charts.clicks) {
                        this.charts.clicks.destroy();
                    }
                    
                    this.charts.clicks = new Chart(clicksCtx, {
                        type: 'line',
                        data: {
                            labels: this.analytics.map(item => {
                                const date = new Date(item.date);
                                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                            }),
                            datasets: [{
                                label: 'Clicks',
                                data: this.analytics.map(item => item.clicks),
                                borderColor: '#4361ee',
                                backgroundColor: 'rgba(67, 97, 238, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
                
                // Analytics Chart
                const analyticsCtx = document.getElementById('analyticsChart');
                if (analyticsCtx) {
                    if (this.charts.analytics) {
                        this.charts.analytics.destroy();
                    }
                    
                    this.charts.analytics = new Chart(analyticsCtx, {
                        type: 'bar',
                        data: {
                            labels: this.analytics.map(item => {
                                const date = new Date(item.date);
                                return date.toLocaleDateString('en-US', { weekday: 'short' });
                            }),
                            datasets: [{
                                label: 'Clicks',
                                data: this.analytics.map(item => item.clicks),
                                backgroundColor: '#7209b7'
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                }
                
                // Top Links Chart
                const topLinksCtx = document.getElementById('topLinksChart');
                if (topLinksCtx && this.links.length) {
                    if (this.charts.topLinks) {
                        this.charts.topLinks.destroy();
                    }
                    
                    const topLinks = [...this.links]
                        .sort((a, b) => (b.clicks || 0) - (a.clicks || 0))
                        .slice(0, 5);
                    
                    this.charts.topLinks = new Chart(topLinksCtx, {
                        type: 'doughnut',
                        data: {
                            labels: topLinks.map(link => link.name),
                            datasets: [{
                                data: topLinks.map(link => link.clicks || 0),
                                backgroundColor: [
                                    '#4361ee',
                                    '#7209b7',
                                    '#4cc9f0',
                                    '#f8961e',
                                    '#f72585'
                                ]
                            }]
                        },
                        options: {
                            responsive: true
                        }
                    });
                }
            }
            
            showAuthTab(tab) {
                document.querySelectorAll('.auth-tab').forEach(t => {
                    t.classList.remove('active');
                });
                document.querySelectorAll('.auth-form').forEach(f => {
                    f.classList.remove('active');
                });
                
                document.querySelector(`.auth-tab[data-tab="${tab}"]`).classList.add('active');
                document.getElementById(`${tab}Form`).classList.add('active');
            }
            
            showCreateLinkModal() {
                document.getElementById('createLinkModal').style.display = 'flex';
                document.getElementById('linkName').value = '';
                document.getElementById('destinationUrl').value = '';
            }
            
            async createLink() {
                const name = document.getElementById('linkName').value;
                const destinationUrl = document.getElementById('destinationUrl').value;
                
                if (!name || !destinationUrl) {
                    alert('Please fill in all fields');
                    return;
                }
                
                try {
                    const linkRef = await this.db.collection('links').add({
                        name: name,
                        destinationUrl: destinationUrl,
                        userId: this.currentUser.uid,
                        clicks: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    document.getElementById('createLinkModal').style.display = 'none';
                    alert('Link created successfully!');
                    
                    await this.loadUserLinks();
                } catch (error) {
                    console.error('Error creating link:', error);
                    alert('Error creating link. Please try again.');
                }
            }
            
            async editLink(linkId) {
                const link = this.links.find(l => l.id === linkId);
                if (!link) return;
                
                const newName = prompt('Enter new name for the link:', link.name);
                if (newName === null) return;
                
                const newUrl = prompt('Enter new destination URL:', link.destinationUrl);
                if (newUrl === null) return;
                
                try {
                    await this.db.collection('links').doc(linkId).update({
                        name: newName,
                        destinationUrl: newUrl
                    });
                    
                    alert('Link updated successfully!');
                    await this.loadUserLinks();
                } catch (error) {
                    console.error('Error updating link:', error);
                    alert('Error updating link. Please try again.');
                }
            }
            
            async deleteLink(linkId) {
                if (!confirm('Are you sure you want to delete this link?')) return;
                
                try {
                    await this.db.collection('links').doc(linkId).delete();
                    alert('Link deleted successfully!');
                    await this.loadUserLinks();
                } catch (error) {
                    console.error('Error deleting link:', error);
                    alert('Error deleting link. Please try again.');
                }
            }
            
            async saveAdsterraLink() {
                const adsterraLink = document.getElementById('adsterraLink').value;
                
                if (!adsterraLink) {
                    alert('Please enter your Adsterra link');
                    return;
                }
                
                try {
                    await this.db.collection('users').doc(this.currentUser.uid).update({
                        adsterraLink: adsterraLink
                    });
                    
                    this.userData.adsterraLink = adsterraLink;
                    alert('Adsterra link saved successfully!');
                } catch (error) {
                    console.error('Error saving Adsterra link:', error);
                    alert('Error saving Adsterra link. Please try again.');
                }
            }
            
            async saveProfile() {
                const name = document.getElementById('userNameInput').value;
                const email = document.getElementById('userEmail').value;
                
                if (!name || !email) {
                    alert('Please fill in all fields');
                    return;
                }
                
                try {
                    await this.db.collection('users').doc(this.currentUser.uid).update({
                        name: name,
                        email: email
                    });
                    
                    await this.currentUser.updateEmail(email);
                    
                    this.userData.name = name;
                    this.userData.email = email;
                    
                    this.updateDashboardUI();
                    alert('Profile updated successfully!');
                } catch (error) {
                    console.error('Error saving profile:', error);
                    alert('Error saving profile. Please try again.');
                }
            }
            
            upgradePlan() {
                if (this.adminConfig) {
                    alert('Redirecting to payment page...');
                    window.open(this.adminConfig.renewSubscriptionLink, '_blank');
                } else {
                    alert('Payment system not configured');
                }
            }
            
            async saveAdminConfig() {
                const adminAdsterraLink = document.getElementById('adminAdsterraLink').value;
                const subscriptionToggle = document.getElementById('subscriptionToggle').value;
                const subscriptionPrice = document.getElementById('subscriptionPrice').value;
                const supportLink = document.getElementById('supportLink').value;
                const renewLink = document.getElementById('renewLink').value;
                
                const updates = {
                    adminAdsterraLink: adminAdsterraLink,
                    subscriptionEnabled: subscriptionToggle === 'enabled',
                    subscriptionPrice: subscriptionPrice,
                    contactSupportLink: supportLink,
                    renewSubscriptionLink: renewLink
                };
                
                const success = await this.adminManager.updateAdminConfig(updates);
                if (success) {
                    this.adminConfig = { ...this.adminConfig, ...updates };
                    alert('Admin configuration saved successfully!');
                } else {
                    alert('Error saving admin configuration. Please try again.');
                }
            }
            
            async toggleUserLock(userId, lock) {
                const reason = lock ? prompt("Enter reason for locking account:") : "";
                if (lock && !reason) return;
                
                const success = await this.adminManager.toggleUserLock(userId, lock, reason);
                if (success) {
                    alert(`User ${lock ? 'locked' : 'unlocked'} successfully!`);
                    await this.loadAdminUsers();
                } else {
                    alert('Error updating user. Please try again.');
                }
            }
            
            async makeUserAdmin(userId) {
                const success = await this.adminManager.makeUserAdmin(userId);
                if (success) {
                    alert('User granted admin access successfully!');
                    await this.loadAdminUsers();
                } else {
                    alert('Error granting admin access. Please try again.');
                }
            }
            
            showLockedAccountModal() {
                if (this.adminConfig) {
                    document.getElementById('lockedAccountMessage').textContent = this.adminConfig.accountLockMessage;
                }
                document.getElementById('lockedAccountModal').style.display = 'flex';
            }
            
            startLandingTimer(linkId) {
                let countdown = this.adminConfig ? this.adminConfig.landingPageTimer : 5;
                const timerElement = document.querySelector('.timer');
                const buttonsContainer = document.getElementById('buttonsContainer');
                const loader = document.querySelector('.loader');
                
                this.currentLinkId = linkId;
                
                const timerInterval = setInterval(() => {
                    countdown--;
                    timerElement.textContent = countdown;
                    
                    if (countdown <= 0) {
                        clearInterval(timerInterval);
                        timerElement.style.display = 'none';
                        loader.style.display = 'none';
                        buttonsContainer.style.display = 'flex';
                        document.querySelector('.timer-label').textContent = 'Ready to Access';
                    }
                }, 1000);
            }
            
            async handleLandingButtonClick() {
                if (!this.currentLinkId) return;
                
                try {
                    const linkDoc = await this.db.collection('links').doc(this.currentLinkId).get();
                    if (!linkDoc.exists) {
                        alert('Invalid link');
                        return;
                    }
                    
                    const link = linkDoc.data();
                    const userDoc = await this.db.collection('users').doc(link.userId).get();
                    const user = userDoc.data();
                    
                    await this.db.collection('links').doc(this.currentLinkId).update({
                        clicks: (link.clicks || 0) + 1
                    });
                    
                    await this.db.collection('analytics').add({
                        linkId: this.currentLinkId,
                        userId: link.userId,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        type: 'click'
                    });
                    
                    const useUserAdsterra = (link.clicks || 0) % 2 === 0;
                    
                    if (this.clickCount === undefined) {
                        this.clickCount = 0;
                    }
                    
                    this.clickCount++;
                    
                    if (this.clickCount === 1) {
                        const adsterraLink = useUserAdsterra ? 
                            (user.adsterraLink || '') : 
                            this.adminConfig.adminAdsterraLink;
                        
                        if (adsterraLink) {
                            window.open(adsterraLink, '_blank');
                        } else {
                            alert('No Adsterra link configured for this URL');
                        }
                    } else {
                        window.location.href = link.destinationUrl;
                    }
                } catch (error) {
                    console.error('Error handling landing button click:', error);
                    alert('Error processing your request. Please try again.');
                }
            }
            
            formatDate(timestamp) {
                if (!timestamp) return 'N/A';
                
                const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            window.app = new LinkMonetizeApp();
        });
    </script>
</body>
</html>
