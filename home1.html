<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConnectX - Connect Instantly</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --gray-color: #6c757d;
            --card-bg: #ffffff;
            --body-bg: #f5f7fb;
            --text-color: #333333;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.12);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --transition-smooth: all 0.3s ease;
            --border-radius: 20px;
            --border-radius-small: 12px;
        }

        .dark-mode {
            --primary-color: #4895ef;
            --secondary-color: #560bad;
            --accent-color: #b5179e;
            --light-color: #2d3748;
            --dark-color: #f8f9fa;
            --card-bg: #1a202c;
            --body-bg: #121826;
            --text-color: #e2e8f0;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
            --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.35);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-color);
            transition: var(--transition-smooth);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .keypad-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            max-width: 400px;
            margin: 0 auto;
            width: 100%;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            color: white;
            font-weight: 600;
        }

        .time {
            font-size: 16px;
        }

        .status-icons {
            display: flex;
            gap: 5px;
        }

        .status-icons i {
            font-size: 14px;
        }

        .display-area {
            text-align: center;
            margin: 30px 0;
        }

        .phone-number {
            font-size: 36px;
            font-weight: 300;
            color: white;
            letter-spacing: 2px;
            margin-bottom: 10px;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .call-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            font-weight: 400;
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .key {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            user-select: none;
        }

        .key:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        .key:active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0.95);
        }

        .number {
            font-size: 32px;
            font-weight: 300;
        }

        .letters {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: -5px;
        }

        .call-actions {
            display: flex;
            justify-content: center;
            gap: 30px;
        }

        .action-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .call-btn {
            background: #00c853;
            color: white;
            width: 70px;
            height: 70px;
        }

        .call-btn:hover {
            background: #00e676;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 200, 83, 0.5);
        }

        .backspace-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .backspace-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .bottom-nav {
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            margin-top: 20px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            padding: 10px 15px;
            border-radius: var(--border-radius-small);
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-item i {
            font-size: 20px;
        }

        .nav-item span {
            font-size: 12px;
            font-weight: 500;
        }

        /* Auth Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-smooth);
            backdrop-filter: blur(10px);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow-hover);
            transform: translateY(30px) scale(0.9);
            transition: var(--transition);
        }

        .modal.active .modal-content {
            transform: translateY(0) scale(1);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            margin-bottom: 10px;
            color: var(--primary-color);
            font-weight: 700;
        }

        .modal-header p {
            color: var(--gray-color);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 1px solid var(--body-bg);
            border-radius: var(--border-radius-small);
            background-color: var(--body-bg);
            color: var(--text-color);
            transition: var(--transition);
            font-size: 16px;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .btn {
            padding: 15px 20px;
            border: none;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            width: 100%;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
        }

        .auth-toggle {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: var(--gray-color);
        }

        .auth-toggle a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow-hover);
            z-index: 1100;
            transform: translateX(150%) scale(0.9);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 300px;
            border-left: 4px solid var(--primary-color);
        }

        .notification.active {
            transform: translateX(0) scale(1);
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .notification-header i {
            color: var(--primary-color);
            font-size: 20px;
        }

        .notification-header h4 {
            font-size: 16px;
            font-weight: 600;
        }

        .notification p {
            font-size: 14px;
            color: var(--gray-color);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* App Logo */
        .app-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .app-logo i {
            font-size: 50px;
            color: white;
            margin-bottom: 10px;
        }

        .app-logo h1 {
            font-size: 28px;
            font-weight: 700;
            color: white;
            letter-spacing: 1px;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .key {
                width: 70px;
                height: 70px;
            }
            
            .number {
                font-size: 28px;
            }
            
            .phone-number {
                font-size: 32px;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="authTitle">Create Account</h2>
                <p>Join ConnectX to start connecting with others</p>
            </div>
            <form id="authForm">
                <div class="form-group" id="fullNameGroup">
                    <label for="fullName"><i class="fas fa-user"></i> Full Name</label>
                    <input type="text" id="fullName" placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="email"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="email" placeholder="Enter your email" required>
                </div>
                <div class="form-group" id="usernameGroup">
                    <label for="username"><i class="fas fa-at"></i> Username</label>
                    <input type="text" id="username" placeholder="Choose a username">
                </div>
                <div class="form-group">
                    <label for="password"><i class="fas fa-lock"></i> Password</label>
                    <input type="password" id="password" placeholder="Create a password" required>
                </div>
                <button type="submit" class="btn btn-primary" id="authButton">
                    <span id="authButtonText">Create Account</span>
                </button>
            </form>
            <div class="auth-toggle">
                <p>Already have an account? <a id="toggleAuth">Sign In</a></p>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-header">
            <i class="fas fa-bell"></i>
            <h4 id="notificationTitle">Welcome</h4>
        </div>
        <p id="notificationMessage">Welcome to ConnectX!</p>
    </div>

    <!-- Keypad Interface -->
    <div class="keypad-container">
        <div class="status-bar">
            <div class="time" id="currentTime">9:41</div>
            <div class="status-icons">
                <i class="fas fa-signal"></i>
                <i class="fas fa-wifi"></i>
                <i class="fas fa-battery-three-quarters"></i>
            </div>
        </div>

        <div class="app-logo">
            <i class="fas fa-phone-alt"></i>
            <h1>ConnectX</h1>
        </div>

        <div class="display-area">
            <div class="phone-number" id="phoneNumber"></div>
            <div class="call-label" id="callLabel">Enter phone number</div>
        </div>

        <div class="keypad">
            <div class="key" data-number="1">
                <div class="number">1</div>
                <div class="letters"></div>
            </div>
            <div class="key" data-number="2">
                <div class="number">2</div>
                <div class="letters">ABC</div>
            </div>
            <div class="key" data-number="3">
                <div class="number">3</div>
                <div class="letters">DEF</div>
            </div>
            <div class="key" data-number="4">
                <div class="number">4</div>
                <div class="letters">GHI</div>
            </div>
            <div class="key" data-number="5">
                <div class="number">5</div>
                <div class="letters">JKL</div>
            </div>
            <div class="key" data-number="6">
                <div class="number">6</div>
                <div class="letters">MNO</div>
            </div>
            <div class="key" data-number="7">
                <div class="number">7</div>
                <div class="letters">PQRS</div>
            </div>
            <div class="key" data-number="8">
                <div class="number">8</div>
                <div class="letters">TUV</div>
            </div>
            <div class="key" data-number="9">
                <div class="number">9</div>
                <div class="letters">WXYZ</div>
            </div>
            <div class="key" data-number="*">
                <div class="number">*</div>
            </div>
            <div class="key" data-number="0">
                <div class="number">0</div>
                <div class="letters">+</div>
            </div>
            <div class="key" data-number="#">
                <div class="number">#</div>
            </div>
        </div>

        <div class="call-actions">
            <div class="action-btn backspace-btn" id="backspaceBtn">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="action-btn call-btn" id="callBtn">
                <i class="fas fa-phone"></i>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item" id="navKeypad">
                <i class="fas fa-dialpad"></i>
                <span>Keypad</span>
            </div>
            <div class="nav-item" id="navContacts">
                <i class="fas fa-address-book"></i>
                <span>Contacts</span>
            </div>
            <div class="nav-item" id="navRecents">
                <i class="fas fa-history"></i>
                <span>Recents</span>
            </div>
            <div class="nav-item" id="navVoicemail">
                <i class="fas fa-voicemail"></i>
                <span>Voicemail</span>
            </div>
        </div>
    </div>

    <!-- External Configuration -->
    <script src="configuration.js"></script>
    <script src="agora.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        // Keypad Application
        class ConnectXKeypad {
            constructor() {
                this.state = {
                    phoneNumber: '',
                    isLoggedIn: false,
                    currentUser: null
                };

                this.init();
            }

            init() {
                this.setupDOMReferences();
                this.setupEventListeners();
                this.updateTime();
                this.checkAuthStatus();
                
                // Update time every minute
                setInterval(() => this.updateTime(), 60000);
            }

            setupDOMReferences() {
                this.elements = {
                    authModal: document.getElementById('authModal'),
                    authForm: document.getElementById('authForm'),
                    authTitle: document.getElementById('authTitle'),
                    authButton: document.getElementById('authButton'),
                    authButtonText: document.getElementById('authButtonText'),
                    toggleAuth: document.getElementById('toggleAuth'),
                    fullNameGroup: document.getElementById('fullNameGroup'),
                    usernameGroup: document.getElementById('usernameGroup'),
                    notification: document.getElementById('notification'),
                    notificationTitle: document.getElementById('notificationTitle'),
                    notificationMessage: document.getElementById('notificationMessage'),
                    phoneNumber: document.getElementById('phoneNumber'),
                    callLabel: document.getElementById('callLabel'),
                    keys: document.querySelectorAll('.key'),
                    backspaceBtn: document.getElementById('backspaceBtn'),
                    callBtn: document.getElementById('callBtn'),
                    currentTime: document.getElementById('currentTime'),
                    navKeypad: document.getElementById('navKeypad'),
                    navContacts: document.getElementById('navContacts'),
                    navRecents: document.getElementById('navRecents'),
                    navVoicemail: document.getElementById('navVoicemail')
                };
            }

            setupEventListeners() {
                // Keypad buttons
                this.elements.keys.forEach(key => {
                    key.addEventListener('click', () => {
                        const number = key.getAttribute('data-number');
                        this.appendNumber(number);
                    });
                });

                // Backspace button
                this.elements.backspaceBtn.addEventListener('click', () => {
                    this.removeLastNumber();
                });

                // Call button
                this.elements.callBtn.addEventListener('click', () => {
                    this.handleCall();
                });

                // Auth events
                this.elements.toggleAuth.addEventListener('click', () => this.toggleAuthForm());
                this.elements.authForm.addEventListener('submit', (e) => this.handleAuthSubmit(e));

                // Navigation
                this.elements.navContacts.addEventListener('click', () => {
                    this.showNotification('Contacts', 'Please sign in to access contacts');
                });

                this.elements.navRecents.addEventListener('click', () => {
                    this.showNotification('Recents', 'Please sign in to view call history');
                });

                this.elements.navVoicemail.addEventListener('click', () => {
                    this.showNotification('Voicemail', 'Please sign in to access voicemail');
                });
            }

            appendNumber(number) {
                this.state.phoneNumber += number;
                this.updateDisplay();
                
                // If user is not logged in and starts typing, show auth modal
                if (!this.state.isLoggedIn && this.state.phoneNumber.length === 1) {
                    setTimeout(() => {
                        this.showAuthModal();
                    }, 500);
                }
            }

            removeLastNumber() {
                this.state.phoneNumber = this.state.phoneNumber.slice(0, -1);
                this.updateDisplay();
            }

            updateDisplay() {
                this.elements.phoneNumber.textContent = this.formatPhoneNumber(this.state.phoneNumber);
                
                if (this.state.phoneNumber.length === 0) {
                    this.elements.callLabel.textContent = 'Enter phone number';
                } else {
                    this.elements.callLabel.textContent = 'Ready to connect';
                }
            }

            formatPhoneNumber(phoneNumber) {
                // Simple formatting for display
                if (phoneNumber.length <= 3) {
                    return phoneNumber;
                } else if (phoneNumber.length <= 6) {
                    return phoneNumber.slice(0, 3) + ' ' + phoneNumber.slice(3);
                } else {
                    return phoneNumber.slice(0, 3) + ' ' + phoneNumber.slice(3, 6) + ' ' + phoneNumber.slice(6);
                }
            }

            updateTime() {
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                this.elements.currentTime.textContent = `${hours}:${minutes}`;
            }

            async handleCall() {
                if (this.state.phoneNumber.length === 0) {
                    this.showNotification('Error', 'Please enter a phone number');
                    return;
                }

                if (!this.state.isLoggedIn) {
                    this.showAuthModal();
                    this.showNotification('Authentication Required', 'Please sign in to make calls');
                    return;
                }

                try {
                    this.showNotification('Calling', `Connecting to ${this.formatPhoneNumber(this.state.phoneNumber)}`);
                    
                    // In a real app, you would initiate a call here
                    // For demo purposes, we'll simulate a call
                    setTimeout(() => {
                        this.showNotification('Call Connected', 'You are now connected');
                    }, 2000);
                } catch (error) {
                    this.showNotification('Call Failed', 'Unable to connect. Please try again.');
                }
            }

            // Authentication Methods
            async checkAuthStatus() {
                return new Promise((resolve) => {
                    firebase.auth().onAuthStateChanged(async (user) => {
                        if (user) {
                            this.state.currentUser = user;
                            this.state.isLoggedIn = true;
                            this.hideAuthModal();
                            this.showNotification('Welcome Back', `Hello ${user.displayName || 'User'}!`);
                        } else {
                            this.state.isLoggedIn = false;
                            this.state.currentUser = null;
                        }
                        resolve();
                    });
                });
            }

            async handleAuthSubmit(e) {
                e.preventDefault();
                
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                // Show loading state
                const originalText = this.elements.authButtonText.textContent;
                this.elements.authButtonText.innerHTML = '<div class="loading"></div>';
                this.elements.authButton.disabled = true;
                
                try {
                    let userCredential;
                    
                    if (this.elements.authTitle.textContent === 'Create Account') {
                        const fullName = document.getElementById('fullName').value;
                        const username = document.getElementById('username').value;
                        
                        userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                        
                        // Update user profile
                        await userCredential.user.updateProfile({
                            displayName: fullName
                        });
                        
                        // Save user data to Firestore
                        await firebase.firestore().collection('users').doc(userCredential.user.uid).set({
                            name: fullName,
                            username: username,
                            email: email,
                            createdAt: new Date().toISOString(),
                            usernameChanges: 0,
                            lastUsernameChange: null,
                            bio: '',
                            followers: [],
                            following: [],
                            posts: []
                        });
                    } else {
                        userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                    }
                    
                    this.showNotification('Success', `Welcome ${this.elements.authTitle.textContent === 'Create Account' ? 'to ConnectX' : 'back'}!`);
                    this.elements.authForm.reset();
                    this.hideAuthModal();
                    
                    // Redirect to home page after successful auth
                    setTimeout(() => {
                        window.location.href = 'home.html';
                    }, 1500);
                } catch (error) {
                    this.showNotification('Error', error.message);
                } finally {
                    // Reset button state
                    this.elements.authButtonText.textContent = originalText;
                    this.elements.authButton.disabled = false;
                }
            }

            toggleAuthForm() {
                if (this.elements.authTitle.textContent === 'Create Account') {
                    this.elements.authTitle.textContent = 'Sign In';
                    this.elements.authButtonText.textContent = 'Sign In';
                    this.elements.toggleAuth.textContent = 'Create Account';
                    this.elements.fullNameGroup.style.display = 'none';
                    this.elements.usernameGroup.style.display = 'none';
                } else {
                    this.elements.authTitle.textContent = 'Create Account';
                    this.elements.authButtonText.textContent = 'Create Account';
                    this.elements.toggleAuth.textContent = 'Sign In';
                    this.elements.fullNameGroup.style.display = 'block';
                    this.elements.usernameGroup.style.display = 'block';
                }
            }

            showAuthModal() {
                this.elements.authModal.classList.add('active');
            }

            hideAuthModal() {
                this.elements.authModal.classList.remove('active');
            }

            showNotification(title, message) {
                this.elements.notificationTitle.textContent = title;
                this.elements.notificationMessage.textContent = message;
                this.elements.notification.classList.add('active');
                
                setTimeout(() => {
                    this.elements.notification.classList.remove('active');
                }, 4000);
            }
        }

        // Initialize the keypad when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Firebase if not already initialized
            if (typeof firebaseConfig !== 'undefined' && !firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            
            window.connectXKeypad = new ConnectXKeypad();
        });
    </script>
</body>
</html>
