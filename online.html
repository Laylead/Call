<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeadConnect - Secure Affiliate Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-functions.js"></script>
    
    <!-- External configuration file -->
    <script src="configuration.js"></script>
    
    <style>
        /* CSS remains the same as previous implementation */
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --warning: #f72585;
            --danger: #e63946;
            --dark: #14213d;
            --light: #f8f9fa;
            --gray: #adb5bd;
            --card-bg: #ffffff;
            --bg: #f0f2f5;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg);
            color: var(--dark);
            line-height: 1.6;
        }
        
        .hidden {
            display: none !important;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
            box-shadow: var(--shadow);
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            flex: 1;
            font-weight: 500;
        }
        
        .tab:hover {
            background: rgba(67, 97, 238, 0.1);
        }
        
        .tab.active {
            background: var(--primary);
            color: white;
        }
        
        .card {
            background: var(--card-bg);
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }
        
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .badge.success {
            background: rgba(76, 201, 240, 0.15);
            color: #4cc9f0;
        }
        
        .badge.warning {
            background: rgba(247, 37, 133, 0.15);
            color: #f72585;
        }
        
        .badge.info {
            background: rgba(67, 97, 238, 0.15);
            color: var(--primary);
        }
        
        .badge.danger {
            background: rgba(230, 57, 70, 0.15);
            color: var(--danger);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.95rem;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .table th, .table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f0f2f5;
        }
        
        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: var(--dark);
        }
        
        .table tr:last-child td {
            border-bottom: none;
        }
        
        .table tr:hover td {
            background: rgba(67, 97, 238, 0.03);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            margin: 8px 0 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: border 0.3s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        button {
            padding: 12px 25px;
            margin: 5px 0;
            border: none;
            border-radius: 8px;
            background: var(--primary);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        button:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(67, 97, 238, 0.25);
        }
        
        button:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        button i {
            margin-right: 8px;
        }
        
        button.danger {
            background: var(--danger);
        }
        
        button.danger:hover {
            background: #c1121f;
            box-shadow: 0 4px 8px rgba(230, 57, 70, 0.25);
        }
        
        button.success {
            background: var(--success);
        }
        
        button.success:hover {
            background: #3a9fc7;
            box-shadow: 0 4px 8px rgba(76, 201, 240, 0.25);
        }
        
        button.admin {
            background: var(--warning);
        }
        
        button.admin:hover {
            background: #d21e6f;
        }
        
        .progress {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            width: 0;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }
        
        .alert i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .alert.info {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }
        
        .alert.success {
            background: rgba(76, 201, 240, 0.1);
            color: #4cc9f0;
        }
        
        .alert.danger {
            background: rgba(230, 57, 70, 0.1);
            color: var(--danger);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
        }
        
        .stat-card .icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .stat-card .icon.users {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }
        
        .stat-card .icon.earnings {
            background: rgba(76, 201, 240, 0.1);
            color: #4cc9f0;
        }
        
        .stat-card .icon.pending {
            background: rgba(247, 37, 133, 0.1);
            color: #f72585;
        }
        
        .stat-card .icon.tokens {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
        }
        
        .stat-card h3 {
            font-size: 1.8rem;
            margin: 5px 0;
        }
        
        .stat-card p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .page-title {
            margin: 20px 0;
            font-size: 1.8rem;
            color: var(--dark);
            display: flex;
            align-items: center;
        }
        
        .page-title i {
            margin-right: 10px;
            background: rgba(67, 97, 238, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }
        
        .section {
            margin: 30px 0;
        }
        
        .section-title {
            margin-bottom: 15px;
            font-size: 1.3rem;
            color: var(--dark);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            color: var(--primary);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .input-group {
            position: relative;
        }
        
        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--gray);
        }
        
        .admin-login-btn {
            background: var(--warning);
            margin-top: 10px;
            width: 100%;
        }
        
        .admin-login-btn:hover {
            background: #d21e6f;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1 0 45%;
                padding: 12px;
                font-size: 0.9rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .tab {
                flex: 1 0 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Screen -->
    <div id="auth-screen" class="container">
        <div class="card" style="max-width:500px;margin:40px auto;">
            <div style="text-align:center;margin-bottom:20px;">
                <h1 style="color:var(--primary);margin-bottom:10px;">LeadConnect</h1>
                <p>Secure Affiliate Marketing Platform</p>
            </div>
            
            <div class="tabs">
                <div id="to-login" class="tab active">Login</div>
                <div id="to-register" class="tab">Register</div>
            </div>
            
            <div id="login-form">
                <div class="section">
                    <input type="email" id="login-email" placeholder="Email Address">
                    
                    <div class="input-group">
                        <input type="password" id="login-password" placeholder="Password">
                        <span class="password-toggle" id="password-toggle">
                            <i class="fas fa-eye"></i>
                        </span>
                    </div>
                    
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px;">
                        <div>
                            <input type="checkbox" id="remember">
                            <label for="remember">Remember me</label>
                        </div>
                        <a href="#" style="color:var(--primary);text-decoration:none;">Forgot password?</a>
                    </div>
                    
                    <button id="login-btn" onclick="login()">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                    
                    <div id="login-error" class="alert danger hidden" style="margin-top:15px;">
                        <i class="fas fa-exclamation-circle"></i> 
                        <span id="error-msg"></span>
                    </div>
                </div>
            </div>
            
            <div id="register-form" class="hidden">
                <div class="section">
                    <div class="form-row">
                        <div>
                            <input type="text" id="reg-name" placeholder="Full Name">
                        </div>
                        <div>
                            <input type="text" id="reg-phone" placeholder="Phone Number">
                        </div>
                    </div>
                    
                    <input type="email" id="reg-email" placeholder="Email Address">
                    
                    <div class="input-group">
                        <input type="password" id="reg-password" placeholder="Password">
                        <span class="password-toggle" id="reg-password-toggle">
                            <i class="fas fa-eye"></i>
                        </span>
                    </div>
                    
                    <div class="input-group">
                        <input type="password" id="reg-confirm-password" placeholder="Confirm Password">
                        <span class="password-toggle" id="reg-confirm-password-toggle">
                            <i class="fas fa-eye"></i>
                        </span>
                    </div>
                    
                    <input type="text" id="reg-ref" placeholder="Referral Code (optional)">
                    
                    <button id="register-btn" onclick="register()">
                        <i class="fas fa-user-plus"></i> Register
                    </button>
                    <div id="register-error" class="alert danger hidden" style="margin-top:15px;">
                        <i class="fas fa-exclamation-circle"></i> 
                        <span id="register-error-msg"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="container hidden">
        <header>
            <h1 id="app-title"><i class="fas fa-chart-line"></i> Dashboard</h1>
            <div>
                <span id="user-name" style="margin-right:15px;"></span>
                <button onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </header>
        
        <div class="tabs" id="tabs"></div>
        
        <div id="content"></div>
    </div>

    <script>
        // Initialize Firebase with configuration from external file
        firebase.initializeApp(firebaseConfig);
        
        // Enable offline persistence
        firebase.firestore().enablePersistence()
          .catch((err) => {
            if (err.code == 'failed-precondition') {
              console.log("Persistence failed - multiple tabs open");
            } else if (err.code == 'unimplemented') {
              console.log("Persistence not available in this browser");
            }
          });
        
        const auth = firebase.auth();
        const db = firebase.firestore();
        const functions = firebase.functions();
        const logs = db.collection('logs');
        
        let currentUser = null;
        let isAdmin = false;
        let loadingStates = {};
        let userCache = {};

        // Password visibility toggle
        document.getElementById('password-toggle').addEventListener('click', function() {
            const passwordInput = document.getElementById('login-password');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
        });
        
        document.getElementById('reg-password-toggle').addEventListener('click', function() {
            const passwordInput = document.getElementById('reg-password');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
        });
        
        document.getElementById('reg-confirm-password-toggle').addEventListener('click', function() {
            const passwordInput = document.getElementById('reg-confirm-password');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
        });

        // UI toggles
        document.getElementById('to-login').onclick = () => switchForms('login');
        document.getElementById('to-register').onclick = () => switchForms('register');
        
        function switchForms(mode) {
            document.getElementById('to-login').classList.toggle('active', mode === 'login');
            document.getElementById('to-register').classList.toggle('active', mode === 'register');
            document.getElementById('login-form').classList.toggle('hidden', mode !== 'login');
            document.getElementById('register-form').classList.toggle('hidden', mode !== 'register');
        }

        // Activity logger with offline support
        function logEvent(uid, action, meta = {}) {
            return new Promise((resolve) => {
                const logData = {
                    uid,
                    action,
                    meta,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                logs.add(logData)
                  .then(resolve)
                  .catch(err => {
                    if (err.code === 'unavailable') {
                      const offlineLogs = JSON.parse(localStorage.getItem('offlineLogs') || '[]');
                      offlineLogs.push(logData);
                      localStorage.setItem('offlineLogs', JSON.stringify(offlineLogs));
                      resolve();
                    }
                  });
            });
        }

        // Process offline logs when connection is restored
        function processOfflineLogs() {
            const offlineLogs = JSON.parse(localStorage.getItem('offlineLogs') || '[]');
            if (offlineLogs.length === 0) return;
            
            const batch = db.batch();
            offlineLogs.forEach(log => {
                const ref = logs.doc();
                batch.set(ref, log);
            });
            
            batch.commit()
              .then(() => {
                localStorage.removeItem('offlineLogs');
              })
              .catch(console.error);
        }

        // Set loading state for buttons
        function setLoading(buttonId, isLoading) {
            const button = document.getElementById(buttonId);
            if (!button) return;
            
            if (isLoading) {
                loadingStates[buttonId] = button.innerHTML;
                button.innerHTML = '<div class="loading"></div> Processing...';
                button.disabled = true;
            } else {
                if (loadingStates[buttonId]) {
                    button.innerHTML = loadingStates[buttonId];
                }
                button.disabled = false;
            }
        }
        
        // Show error message
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.classList.remove('hidden');
            errorElement.querySelector('span').textContent = message;
        }
        
        // Hide error message
        function hideError(elementId) {
            document.getElementById(elementId).classList.add('hidden');
        }

        // Registration with validation
        function register() {
            hideError('register-error');
            const name = document.getElementById('reg-name').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const phone = document.getElementById('reg-phone').value.trim();
            const pwd = document.getElementById('reg-password').value;
            const confirmPwd = document.getElementById('reg-confirm-password').value;
            const ref = document.getElementById('reg-ref').value.trim();
            
            if (!name) return showError('register-error', 'Please enter your full name');
            if (!email || !validateEmail(email)) return showError('register-error', 'Please enter a valid email address');
            if (!phone) return showError('register-error', 'Please enter your phone number');
            if (pwd.length < 8) return showError('register-error', 'Password must be at least 8 characters');
            if (pwd !== confirmPwd) return showError('register-error', 'Passwords do not match');
            
            setLoading('register-btn', true);
            
            // Simulate registration since we can't connect to Firebase
            setTimeout(() => {
                currentUser = { uid: 'user-' + Date.now(), email };
                userCache[currentUser.uid] = {
                    name,
                    email,
                    phone,
                    ref,
                    role: 'user',
                    status: 'active',
                    balance: 0,
                    referrals: 0,
                    commissionRate: 0.15,
                    twoFA: false
                };
                isAdmin = false;
                initApp();
                setLoading('register-btn', false);
            }, 1500);
        }

        // Email validation
        function validateEmail(email) {
            const re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(String(email).toLowerCase());
        }

        // Login function with admin check
        function login() {
            hideError('login-error');
            const email = document.getElementById('login-email').value.trim();
            const pwd = document.getElementById('login-password').value;
            
            if (!email || !validateEmail(email)) return showError('login-error', 'Please enter a valid email address');
            if (!pwd) return showError('login-error', 'Please enter your password');
            
            setLoading('login-btn', true);
            
            // Simulate login since we can't connect to Firebase
            setTimeout(() => {
                if (email === adminCredentials.email && pwd === adminCredentials.password) {
                    // Admin login
                    currentUser = { uid: 'admin-' + Date.now(), email };
                    userCache[currentUser.uid] = {
                        name: "Admin",
                        email: email,
                        role: 'admin',
                        status: 'active',
                        balance: 0,
                        referrals: 0,
                        commissionRate: 0.15,
                        twoFA: false
                    };
                    isAdmin = true;
                    initApp();
                } else {
                    // Regular user login
                    currentUser = { uid: 'user-' + Date.now(), email };
                    userCache[currentUser.uid] = {
                        name: "Demo User",
                        email: email,
                        role: 'user',
                        status: 'active',
                        balance: 420.50,
                        referrals: 8,
                        commissionRate: 0.15,
                        twoFA: false
                    };
                    isAdmin = false;
                    initApp();
                }
                setLoading('login-btn', false);
            }, 1000);
        }

        // Auth state handler
        // Simulated for demo purposes
        function checkAuth() {
            // For demo, we'll just show the login screen
            document.getElementById('auth-screen').classList.remove('hidden');
            document.getElementById('app').classList.add('hidden');
        }
        
        function logout() { 
            currentUser = null;
            userCache = {};
            window.location.reload();
        }

        // Initialize app UI
        function initApp() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            // Use cached user data
            if (currentUser && userCache[currentUser.uid]) {
                document.getElementById('user-name').innerText = userCache[currentUser.uid].name || currentUser.email;
            }
            
            buildTabs();
            const first = isAdmin ? 'Overview' : 'Dashboard';
            setActiveTab(first);
            loadTab(first);
        }

        // Tabs setup
        const adminTabs = ['Overview', 'Tokens', 'Users', 'Affiliates', 'Withdrawals', 'Settings'];
        const userTabs = ['Dashboard', 'Referrals', 'Withdrawals', 'Account'];
        
        function buildTabs() {
            const tabsEl = document.getElementById('tabs');
            tabsEl.innerHTML = '';
            
            const tabs = isAdmin ? adminTabs : userTabs;
            tabs.forEach(t => {
                const div = document.createElement('div');
                div.innerText = t;
                div.className = 'tab';
                div.onclick = () => { setActiveTab(t); loadTab(t); };
                tabsEl.appendChild(div);
            });
        }
        
        function setActiveTab(tab) {
            document.getElementById('app-title').innerHTML = `<i class="fas ${getTabIcon(tab)}"></i> ${tab}`;
            document.querySelectorAll('.tabs .tab').forEach(el => {
                el.classList.toggle('active', el.innerText === tab);
            });
        }
        
        function getTabIcon(tab) {
            const icons = {
                'Overview': 'fa-tachometer-alt',
                'Dashboard': 'fa-tachometer-alt',
                'Tokens': 'fa-key',
                'Users': 'fa-users',
                'Affiliates': 'fa-handshake',
                'Withdrawals': 'fa-money-check-alt',
                'Settings': 'fa-cog',
                'Referrals': 'fa-user-friends',
                'Account': 'fa-user-cog'
            };
            return icons[tab] || 'fa-file';
        }
        
        function loadTab(tab) {
            document.getElementById('content').innerHTML = '';
            isAdmin ? loadAdminTab(tab) : loadUserTab(tab);
        }

        // Admin Functions
        function loadAdminTab(tab) {
            switch(tab) {
                case 'Overview': return adminOverview();
                case 'Tokens': return adminTokens();
                case 'Users': return adminUsers();
                case 'Affiliates': return adminAffiliates();
                case 'Withdrawals': return adminWithdrawals();
                case 'Settings': return adminSettings();
            }
        }

        function adminOverview() {
            const c = document.getElementById('content');
            c.innerHTML = `
                <h1 class="page-title"><i class="fas fa-tachometer-alt"></i> System Overview</h1>
                <div class="grid">
                    <div class="stat-card">
                        <div class="icon users"><i class="fas fa-users"></i></div>
                        <h3 id="stat-users">42</h3>
                        <p>Total Users</p>
                    </div>
                    <div class="stat-card">
                        <div class="icon earnings"><i class="fas fa-chart-line"></i></div>
                        <h3 id="stat-earnings">$1,850</h3>
                        <p>Total Earnings</p>
                    </div>
                    <div class="stat-card">
                        <div class="icon pending"><i class="fas fa-clock"></i></div>
                        <h3 id="stat-pending">$420</h3>
                        <p>Pending Withdrawals</p>
                    </div>
                    <div class="stat-card">
                        <div class="icon tokens"><i class="fas fa-key"></i></div>
                        <h3 id="stat-tokens">15</h3>
                        <p>Active Tokens</p>
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-title"><i class="fas fa-exclamation-circle"></i> Recent Activities</h2>
                    <div class="table-container">
                        <table class="table">
                            <tr><th>User</th><th>Action</th><th>Time</th></tr>
                            <tr>
                                <td>user1@example.com</td>
                                <td>Login</td>
                                <td>${new Date().toLocaleString()}</td>
                            </tr>
                            <tr>
                                <td>user2@example.com</td>
                                <td>Withdrawal Request</td>
                                <td>${new Date(Date.now() - 86400000).toLocaleString()}</td>
                            </tr>
                            <tr>
                                <td>user3@example.com</td>
                                <td>Registration</td>
                                <td>${new Date(Date.now() - 172800000).toLocaleString()}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            `;
        }

        function adminTokens() {
            const c = document.getElementById('content');
            c.innerHTML = `
                <h1 class="page-title"><i class="fas fa-key"></i> Token Management</h1>
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-plus-circle"></i> Generate Tokens</h2>
                    <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                        <button onclick="adminCreateToken('one-time')"><i class="fas fa-key"></i> One-Time Token</button>
                        <button onclick="adminCreateToken('reusable')"><i class="fas fa-redo"></i> Reusable Token</button>
                        <button onclick="adminBulkGenerate()"><i class="fas fa-bolt"></i> Bulk Generate</button>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-list"></i> Token List</h2>
                    <div style="margin-bottom: 15px;">
                        <label>Filter: </label>
                        <select id="token-filter" style="width: auto; display: inline-block; margin-left: 10px;">
                            <option value="">All Tokens</option>
                            <option value="unused">Unused Only</option>
                            <option value="used">Used Only</option>
                        </select>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <tr>
                                <th>Token</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Used By</th>
                                <th>Actions</th>
                            </tr>
                            <tr>
                                <td><code>A1B2C3D4E5F6</code></td>
                                <td>one-time</td>
                                <td><span class="badge info">unused</span></td>
                                <td>${new Date().toLocaleDateString()}</td>
                                <td>-</td>
                                <td>
                                    <button class="danger" onclick="adminDeleteToken('A1B2C3D4E5F6')">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><code>G7H8I9J0K1L2</code></td>
                                <td>reusable</td>
                                <td><span class="badge success">used</span></td>
                                <td>${new Date(Date.now() - 86400000).toLocaleDateString()}</td>
                                <td>user@example.com</td>
                                <td>
                                    <button class="danger" onclick="adminDeleteToken('G7H8I9J0K1L2')">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td><code>M3N4O5P6Q7R8</code></td>
                                <td>one-time</td>
                                <td><span class="badge info">unused</span></td>
                                <td>${new Date(Date.now() - 172800000).toLocaleDateString()}</td>
                                <td>-</td>
                                <td>
                                    <button class="danger" onclick="adminDeleteToken('M3N4O5P6Q7R8')">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function adminCreateToken(type) {
            const tok = Math.random().toString(36).substr(2, 12).toUpperCase();
            alert(`Generated ${type} token: ${tok}`);
        }
        
        function adminBulkGenerate() {
            alert("Bulk token generation initiated - 5 tokens created!");
        }
        
        function adminDeleteToken(id) {
            if (confirm('Are you sure you want to delete this token?')) {
                alert(`Token ${id} deleted successfully!`);
            }
        }

        function adminUsers() {
            const c = document.getElementById('content');
            c.innerHTML = `
                <h1 class="page-title"><i class="fas fa-users"></i> User Management</h1>
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-search"></i> Search Users</h2>
                    <input id="user-search" placeholder="Search by name or email">
                </div>
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-list"></i> User List</h2>
                    <div class="table-container">
                        <table class="table">
                            <tr><th>Name</th><th>Email</th><th>Joined</th><th>Status</th><th>Balance</th><th>Actions</th></tr>
                            <tr>
                                <td>John Doe</td>
                                <td>john@example.com</td>
                                <td>${new Date().toLocaleDateString()}</td>
                                <td><span class="badge success">active</span></td>
                                <td>$150</td>
                                <td>
                                    <button onclick="adminToggleUserStatus('john@example.com', 'active')">
                                        Suspend
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>Jane Smith</td>
                                <td>jane@example.com</td>
                                <td>${new Date(Date.now() - 86400000).toLocaleDateString()}</td>
                                <td><span class="badge warning">suspended</span></td>
                                <td>$75</td>
                                <td>
                                    <button onclick="adminToggleUserStatus('jane@example.com', 'suspended')">
                                        Activate
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td>Bob Johnson</td>
                                <td>bob@example.com</td>
                                <td>${new Date(Date.now() - 259200000).toLocaleDateString()}</td>
                                <td><span class="badge success">active</span></td>
                                <td>$230</td>
                                <td>
                                    <button onclick="adminToggleUserStatus('bob@example.com', 'active')">
                                        Suspend
                                    </button>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function adminToggleUserStatus(uid, current) {
            const next = current === 'active' ? 'suspended' : 'active';
            alert(`User ${uid} status changed to ${next}`);
        }

        function adminAffiliates() {
            const c = document.getElementById('content');
            c.innerHTML = `
                <h1 class="page-title"><i class="fas fa-handshake"></i> Affiliate Program</h1>
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-cog"></i> Settings</h2>
                    <div class="form-row">
                        <div>
                            <label>Commission Rate (%)</label>
                            <input type="number" id="aff-commission" min="0" max="50" step="0.1" value="15">
                        </div>
                        <div>
                            <label>Minimum Referrals</label>
                            <input type="number" id="aff-minref" min="0" value="5">
                        </div>
                    </div>
                    <div class="form-row">
                        <div>
                            <label>Minimum Withdrawal ($)</label>
                            <input type="number" id="aff-minwd" min="0" value="20">
                        </div>
                        <div>
                            <label>Payout Schedule</label>
                            <select id="aff-payout">
                                <option value="weekly" selected>Weekly</option>
                                <option value="biweekly">Bi-weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="adminSaveAffiliateSettings()">Save Settings</button>
                </div>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-chart-bar"></i> Performance</h2>
                    <div class="table-container">
                        <table class="table">
                            <tr><th>Affiliate</th><th>Referrals</th><th>Commission Rate</th><th>Balance</th><th>Earned</th></tr>
                            <tr>
                                <td>John Doe</td>
                                <td>12</td>
                                <td>15.0%</td>
                                <td>$150</td>
                                <td>$180.00</td>
                            </tr>
                            <tr>
                                <td>Jane Smith</td>
                                <td>8</td>
                                <td>15.0%</td>
                                <td>$75</td>
                                <td>$120.00</td>
                            </tr>
                            <tr>
                                <td>Bob Johnson</td>
                                <td>15</td>
                                <td>20.0%</td>
                                <td>$230</td>
                                <td>$300.00</td>
                            </tr>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function adminSaveAffiliateSettings() {
            alert('Affiliate settings saved successfully!');
        }

        function adminWithdrawals() {
            const c = document.getElementById('content');
            c.innerHTML = `
                <h1 class="page-title"><i class="fas fa-money-check-alt"></i> Withdrawal Requests</h1>
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-filter"></i> Filter</h2>
                    <div style="display: flex; gap: 15px;">
                        <select id="wd-status" style="flex: 1;">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                        </select>
                        <input type="date" id="wd-date" style="flex: 1;">
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-list"></i> Requests</h2>
                    <div class="table-container">
                        <table class="table">
                            <tr><th>User</th><th>Amount</th><th>Method</th><th>Date</th><th>Status</th><th>Actions</th></tr>
                            <tr>
                                <td>John Doe</td>
                                <td>$50</td>
                                <td>PayPal</td>
                                <td>${new Date().toLocaleDateString()}</td>
                                <td><span class="badge warning">pending</span></td>
                                <td>
                                    <button class="success" onclick="adminProcessWithdrawal('John Doe', 'approved')">Approve</button>
                                    <button class="danger" onclick="adminProcessWithdrawal('John Doe', 'rejected')">Reject</button>
                                </td>
                            </tr>
                            <tr>
                                <td>Jane Smith</td>
                                <td>$75</td>
                                <td>Bank Transfer</td>
                                <td>${new Date(Date.now() - 86400000).toLocaleDateString()}</td>
                                <td><span class="badge success">approved</span></td>
                                <td>-</td>
                            </tr>
                            <tr>
                                <td>Bob Johnson</td>
                                <td>$100</td>
                                <td>Crypto</td>
                                <td>${new Date(Date.now() - 172800000).toLocaleDateString()}</td>
                                <td><span class="badge danger">rejected</span></td>
                                <td>-</td>
                            </tr>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function adminProcessWithdrawal(id, status) {
            alert(`Withdrawal for ${id} ${status} successfully!`);
        }

        function adminSettings() {
            const c = document.getElementById('content');
            c.innerHTML = `
                <h1 class="page-title"><i class="fas fa-cog"></i> System Settings</h1>
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-sliders-h"></i> General Settings</h2>
                    <div class="form-row">
                        <div>
                            <label>System Currency</label>
                            <select id="sys-currency">
                                <option value="USD" selected>US Dollar (USD)</option>
                                <option value="EUR">Euro (EUR)</option>
                                <option value="GBP">British Pound (GBP)</option>
                            </select>
                        </div>
                        <div>
                            <label>Session Timeout (minutes)</label>
                            <input type="number" id="sys-timeout" min="5" max="120" value="30">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div>
                            <label>Maximum Commission (%)</label>
                            <input type="number" id="sys-maxcom" min="0" max="50" value="30">
                        </div>
                        <div>
                            <label>System Status</label>
                            <select id="sys-status">
                                <option value="active" selected>Active</option>
                                <option value="maintenance">Maintenance</option>
                            </select>
                        </div>
                    </div>
                    
                    <button onclick="adminSaveSystemSettings()">Save Settings</button>
                </div>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-shield-alt"></i> Security Settings</h2>
                    <div>
                        <label>
                            <input type="checkbox" id="sys-2fa" checked> 
                            Require 2FA for all users
                        </label>
                    </div>
                    <div>
                        <label>
                            <input type="checkbox" id="sys-pwd"> 
                            Require strong passwords
                        </label>
                    </div>
                </div>
            `;
        }
        
        function adminSaveSystemSettings() {
            alert('System settings saved successfully!');
        }

        // User Functions
        function loadUserTab(tab) {
            switch(tab) {
                case 'Dashboard': return userDashboard();
                case 'Referrals': return userReferrals();
                case 'Withdrawals': return userWithdrawals();
                case 'Account': return userAccount();
            }
        }

        function userDashboard() {
            const c = document.getElementById('content');
            c.innerHTML = `
                <h1 class="page-title"><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
                
                <div class="grid">
                    <div class="card">
                        <h2 class="section-title"><i class="fas fa-wallet"></i> Account Summary</h2>
                        <div>
                            <div style="margin-bottom: 15px;">
                                <p><strong>Account Balance:</strong></p>
                                <h2 style="color: var(--primary);">$420.50</h2>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                <div>
                                    <p><strong>Referrals:</strong></p>
                                    <p style="font-size: 1.5rem;">8</p>
                                </div>
                                <div>
                                    <p><strong>Commission Rate:</strong></p>
                                    <p style="font-size: 1.5rem;">15%</p>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <label>
                                    <input type="checkbox" id="twofa-toggle" checked> 
                                    Enable Two-Factor Authentication
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h2 class="section-title"><i class="fas fa-chart-bar"></i> Performance</h2>
                        <div style="text-align: center; padding: 20px;">
                            <div style="height:200px;display:flex;align-items:flex-end;justify-content:center;gap:20px;">
                                <div style="width:40px;background:var(--primary);height:80%;border-radius:5px;"></div>
                                <div style="width:40px;background:var(--success);height:60%;border-radius:5px;"></div>
                                <div style="width:40px;background:var(--warning);height:40%;border-radius:5px;"></div>
                                <div style="width:40px;background:var(--danger);height:30%;border-radius:5px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-history"></i> Recent Activity</h2>
                    <div class="table-container">
                        <table class="table">
                            <tr><th>Action</th><th>Time</th></tr>
                            <tr>
                                <td>Login</td>
                                <td>${new Date().toLocaleString()}</td>
                            </tr>
                            <tr>
                                <td>Referred new user</td>
                                <td>${new Date(Date.now() - 86400000).toLocaleString()}</td>
                            </tr>
                            <tr>
                                <td>Token activated</td>
                                <td>${new Date(Date.now() - 172800000).toLocaleString()}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            `;
        }

        function userReferrals() {
            const c = document.getElementById('content');
            c.innerHTML = `
                <h1 class="page-title"><i class="fas fa-user-friends"></i> Referral Program</h1>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-link"></i> Your Referral Link</h2>
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <input type="text" id="referral-link" readonly style="flex: 1;" value="https://leadconnect.com?ref=user123">
                        <button onclick="copyReferralLink()"><i class="fas fa-copy"></i> Copy</button>
                    </div>
                    
                    <div class="alert info">
                        <i class="fas fa-info-circle"></i> 
                        Earn 15% commission for each successful referral
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-chart-line"></i> Referral Progress</h2>
                    <p>Complete your referral goals to unlock higher commission rates</p>
                    
                    <div class="progress">
                        <div id="ref-progress" class="progress-bar" style="width: 66%"></div>
                    </div>
                    <p id="ref-status" style="text-align: center; font-weight: 500;">Referrals: 8/12 (66%)</p>
                </div>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-users"></i> Your Referrals</h2>
                    <div class="table-container">
                        <table class="table">
                            <tr><th>Name</th><th>Email</th><th>Joined</th><th>Status</th></tr>
                            <tr>
                                <td>John Doe</td>
                                <td>john@example.com</td>
                                <td>${new Date().toLocaleDateString()}</td>
                                <td><span class="badge success">active</span></td>
                            </tr>
                            <tr>
                                <td>Jane Smith</td>
                                <td>jane@example.com</td>
                                <td>${new Date(Date.now() - 86400000).toLocaleDateString()}</td>
                                <td><span class="badge success">active</span></td>
                            </tr>
                            <tr>
                                <td>Bob Johnson</td>
                                <td>bob@example.com</td>
                                <td>${new Date(Date.now() - 172800000).toLocaleDateString()}</td>
                                <td><span class="badge success">active</span></td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-key"></i> Activate Token</h2>
                    <p>Enter a token to activate your account features</p>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="token-code" placeholder="Token code" style="flex: 1;">
                        <button onclick="activateToken()">Activate</button>
                    </div>
                    <div id="token-msg" class="alert" style="margin-top: 15px; display: none;"></div>
                </div>
            `;
        }
        
        function copyReferralLink() {
            const url = document.getElementById('referral-link').value;
            alert('Referral link copied to clipboard!');
        }
        
        function activateToken() {
            const msgEl = document.getElementById('token-msg');
            msgEl.innerText = 'Token activated successfully! $50 added to your account';
            msgEl.className = 'alert success';
            msgEl.style.display = 'block';
        }

        function userWithdrawals() {
            const c = document.getElementById('content');
            c.innerHTML = `
                <h1 class="page-title"><i class="fas fa-money-check-alt"></i> Withdraw Funds</h1>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-hand-holding-usd"></i> Request Withdrawal</h2>
                    <p>Minimum withdrawal amount: $20</p>
                    
                    <div class="form-row">
                        <div>
                            <label>Amount ($)</label>
                            <input type="number" id="wd-amount" min="20" step="0.01" value="50">
                        </div>
                        <div>
                            <label>Payment Method</label>
                            <select id="wd-method">
                                <option value="paypal" selected>PayPal</option>
                                <option value="bank">Bank Transfer</option>
                                <option value="crypto">Cryptocurrency</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="wd-details">
                        <label>PayPal Email</label>
                        <input type="email" id="wd-account" placeholder="your@paypal.com" value="user@example.com">
                    </div>
                    
                    <button id="wd-request-btn" onclick="requestWithdrawal()">Request Withdrawal</button>
                    <div id="wd-msg" class="alert" style="display: none; margin-top: 15px;"></div>
                </div>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-history"></i> Withdrawal History</h2>
                    <div class="table-container">
                        <table class="table">
                            <tr><th>Amount</th><th>Method</th><th>Date</th><th>Status</th></tr>
                            <tr>
                                <td>$100</td>
                                <td>PayPal</td>
                                <td>${new Date().toLocaleDateString()}</td>
                                <td><span class="badge success">approved</span></td>
                            </tr>
                            <tr>
                                <td>$50</td>
                                <td>Bank Transfer</td>
                                <td>${new Date(Date.now() - 86400000).toLocaleDateString()}</td>
                                <td><span class="badge warning">pending</span></td>
                            </tr>
                            <tr>
                                <td>$75</td>
                                <td>Crypto</td>
                                <td>${new Date(Date.now() - 172800000).toLocaleDateString()}</td>
                                <td><span class="badge success">approved</span></td>
                            </tr>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function requestWithdrawal() {
            const msgEl = document.getElementById('wd-msg');
            msgEl.innerText = 'Withdrawal request submitted successfully!';
            msgEl.className = 'alert success';
            msgEl.style.display = 'block';
        }

        function userAccount() {
            const c = document.getElementById('content');
            c.innerHTML = `
                <h1 class="page-title"><i class="fas fa-user-cog"></i> Account Settings</h1>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-user"></i> Profile Information</h2>
                    <div class="form-row">
                        <div>
                            <label>Full Name</label>
                            <input type="text" id="acc-name" placeholder="Your full name" value="John Doe">
                        </div>
                        <div>
                            <label>Phone Number</label>
                            <input type="tel" id="acc-phone" placeholder="Your phone number" value="+1 (555) 123-4567">
                        </div>
                    </div>
                    
                    <label>Email Address</label>
                    <input type="email" id="acc-email" placeholder="Your email" disabled value="user@example.com">
                    
                    <button onclick="updateProfile()">Update Profile</button>
                    <div id="profile-msg" class="alert" style="display: none; margin-top: 15px;"></div>
                </div>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-lock"></i> Security</h2>
                    <div>
                        <label>
                            <input type="checkbox" id="acc-2fa" checked> 
                            Enable Two-Factor Authentication
                        </label>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h3>Change Password</h3>
                        <input type="password" id="acc-old-pwd" placeholder="Current password">
                        <input type="password" id="acc-new-pwd" placeholder="New password">
                        <input type="password" id="acc-confirm-pwd" placeholder="Confirm new password">
                        
                        <button onclick="changePassword()">Change Password</button>
                        <div id="pwd-msg" class="alert" style="display: none; margin-top: 15px;"></div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="section-title"><i class="fas fa-wallet"></i> Payment Information</h2>
                    <p>Set your preferred payment method for withdrawals</p>
                    <div id="payment-info">
                        <p><strong>PayPal:</strong> user@example.com</p>
                        <p><strong>Bank Account:</strong> **** **** **** 1234</p>
                    </div>
                </div>
            `;
        }
        
        function updateProfile() {
            const msgEl = document.getElementById('profile-msg');
            msgEl.innerText = 'Profile updated successfully!';
            msgEl.className = 'alert success';
            msgEl.style.display = 'block';
        }
        
        function changePassword() {
            const msgEl = document.getElementById('pwd-msg');
            msgEl.innerText = 'Password changed successfully!';
            msgEl.className = 'alert success';
            msgEl.style.display = 'block';
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize offline logs processing
            processOfflineLogs();
            checkAuth();
        });
    </script>
</body>
</html>
