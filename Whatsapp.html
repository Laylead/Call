<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camsilo - Premium Adult Entertainment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #e91e63;
            --secondary: #9c27b0;
            --dark: #121212;
            --darker: #0a0a0a;
            --light: #f5f5f5;
            --gray: #6c757d;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --surface: #1e1e1e;
            --surface-light: #2d2d2d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--dark);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Header Styles */
        header {
            background: rgba(18, 18, 18, 0.98);
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .nav-links a {
            color: var(--light);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }

        .nav-links a:hover, .nav-links a.active {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
        }

        .auth-buttons {
            display: flex;
            gap: 0.8rem;
        }

        .btn {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-outline {
            border: 2px solid var(--primary);
            color: var(--primary);
            background: transparent;
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        /* Hero Section */
        .hero {
            margin-top: 80px;
            padding: 6rem 2rem;
            text-align: center;
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.1), rgba(156, 39, 176, 0.1));
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Models Grid */
        .models-section {
            padding: 4rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .section-title {
            text-align: center;
            margin-bottom: 3rem;
            font-size: 2rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
        }

        .model-card {
            background: var(--surface);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .model-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(233, 30, 99, 0.2);
        }

        .model-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }

        .model-info {
            padding: 1.5rem;
        }

        .model-name {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .verified {
            color: #1da1f2;
        }

        .model-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 1rem 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .likes, .comments {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .like-btn, .comment-btn {
            background: none;
            border: none;
            color: var(--light);
            cursor: pointer;
            font-size: 1.2rem;
        }

        .like-btn:hover {
            color: var(--primary);
        }

        .comment-btn:hover {
            color: var(--secondary);
        }

        .liked {
            color: var(--primary);
        }

        .book-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 1rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
        }

        .modal-content {
            position: relative;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--surface);
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--light);
            font-weight: 600;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            background: var(--surface-light);
            color: var(--light);
        }

        /* User Info */
        .user-info {
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.1), rgba(156, 39, 176, 0.1));
            padding: 2rem;
            border-radius: 12px;
            margin: 2rem auto;
            max-width: 1400px;
            text-align: center;
        }

        .account-timer {
            font-size: 1.2rem;
            color: var(--primary);
            margin-top: 1rem;
            font-weight: bold;
        }

        .expired {
            color: var(--danger);
        }

        /* Comments */
        .comments-section {
            margin-top: 1rem;
        }

        .comment {
            background: rgba(255, 255, 255, 0.05);
            padding: 0.8rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .models-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header id="mainHeader">
        <div class="nav-container">
            <div class="logo">Camsilo</div>
            <nav class="nav-links">
                <a href="#home" class="active">Home</a>
                <a href="#models">Models</a>
            </nav>
            <div class="auth-buttons" id="authButtons">
                <button class="btn btn-outline" onclick="openLoginModal()">
                    <i class="fas fa-user"></i>Login
                </button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="hero-content">
            <h1>Premium Adult Entertainment</h1>
            <p>Experience exclusive content with our premium models. Private shows, custom content, and unforgettable experiences.</p>
            <button class="btn btn-primary" onclick="loadModels()">
                <i class="fas fa-star"></i>View Models
            </button>
        </div>
    </section>

    <!-- Models Section -->
    <section class="models-section" id="models">
        <h2 class="section-title">Premium Models</h2>
        <div id="modelsGrid" class="models-grid">
            <!-- Models will be loaded here from Firebase -->
        </div>
    </section>

    <!-- User Info Section -->
    <section class="user-info" id="userInfo" style="display: none;">
        <h2>Your Account</h2>
        <div>
            <strong>Subscription Active Until:</strong> <span id="accountExpires">-</span>
        </div>
        <div class="account-timer" id="accountTimer"></div>
        <button class="btn btn-primary" onclick="renewAccount()" style="margin-top: 1rem;">
            <i class="fas fa-sync-alt"></i>Renew Subscription
        </button>
    </section>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <h2>User Login</h2>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="loginEmail" placeholder="your@email.com" required>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="loginPassword" placeholder="Enter your password" required>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-outline" onclick="closeModal('loginModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary" onclick="userLogin()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </div>
        </div>
    </div>

    <!-- Video Call Modal -->
    <div class="modal" id="videoCallModal">
        <div class="modal-content">
            <h2>Book Private Show</h2>
            <div class="form-group">
                <label>Your Email</label>
                <input type="email" id="userEmailInput" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
                <label>Preferred Date & Time</label>
                <input type="datetime-local" id="callDateTime">
            </div>
            <div class="form-group">
                <label>Special Requests</label>
                <textarea id="callRequests" rows="3" placeholder="Any special preferences..."></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-outline" onclick="closeModal('videoCallModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary" onclick="bookVideoCall()">
                    <i class="fas fa-video"></i> Book Show
                </button>
            </div>
        </div>
    </div>

    <!-- Comment Modal -->
    <div class="modal" id="commentModal">
        <div class="modal-content">
            <h2>Add Comment</h2>
            <div class="form-group">
                <label>Your Comment</label>
                <textarea id="commentText" rows="4" placeholder="Write your comment..." required></textarea>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-outline" onclick="closeModal('commentModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary" onclick="submitComment()">
                    <i class="fas fa-comment"></i> Post Comment
                </button>
            </div>
        </div>
    </div>

    <!-- Subscription Modal -->
    <div class="modal" id="subscriptionModal">
        <div class="modal-content">
            <h2>Premium Subscription Required</h2>
            <p>Subscribe to access all features including private shows, messaging, and exclusive content.</p>
            <div class="modal-buttons">
                <button class="btn btn-outline" onclick="closeModal('subscriptionModal')">
                    <i class="fas fa-times"></i> Later
                </button>
                <button class="btn btn-primary" onclick="redirectToSubscribe()">
                    <i class="fas fa-gem"></i> Subscribe Now
                </button>
            </div>
        </div>
    </div>

    <!-- Renewal Modal -->
    <div class="modal" id="renewalModal">
        <div class="modal-content">
            <h2>Subscription Expired</h2>
            <p>Your subscription has expired. Renew to continue enjoying premium features.</p>
            <div class="modal-buttons">
                <button class="btn btn-outline" onclick="closeModal('renewalModal')">
                    <i class="fas fa-times"></i> Later
                </button>
                <button class="btn btn-primary" onclick="redirectToRenewal()">
                    <i class="fas fa-sync-alt"></i> Renew Now
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>
    <script src="config.js"></script>
    <script>
        // Firebase Initialization
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Toastr configuration
        toastr.options = {
            closeButton: true,
            progressBar: true,
            positionClass: "toast-top-right",
            timeOut: 5000
        };

        // Firebase References
        const modelsRef = db.collection('models');
        const usersRef = db.collection('users');
        const bookingsRef = db.collection('bookings');
        const commentsRef = db.collection('comments');

        // State Management
        let currentUser = null;
        let allModels = [];
        let currentCommentModelId = null;
        let currentModelId = null;

        // Initialize Website
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthState();
        });

        // Authentication State Listener
        function checkAuthState() {
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    const userDoc = await usersRef.doc(user.uid).get();
                    if (userDoc.exists) {
                        currentUser = { uid: user.uid, ...userDoc.data() };
                        showUserInterface();
                        checkAccountExpiry();
                        loadModels(); // Load models when user logs in
                        toastr.success('Welcome back!');
                    } else {
                        await auth.signOut();
                    }
                    updateAuthButtons();
                } else {
                    currentUser = null;
                    updateAuthButtons();
                    hideUserInterface();
                    // Clear models when logged out
                    document.getElementById('modelsGrid').innerHTML = 
                        '<p style="text-align: center; grid-column: 1/-1;">Please login to view models</p>';
                }
            });
        }

        // Load Models from Firestore
        async function loadModels() {
            if (!currentUser) {
                openModal('subscriptionModal');
                return;
            }

            try {
                const snapshot = await modelsRef.orderBy('createdAt', 'desc').get();
                allModels = [];
                const modelsGrid = document.getElementById('modelsGrid');
                modelsGrid.innerHTML = '';

                snapshot.forEach(doc => {
                    const model = { id: doc.id, ...doc.data() };
                    allModels.push(model);
                    
                    // Create model card for every model from Firestore
                    const modelCard = createModelCard(model);
                    modelsGrid.appendChild(modelCard);
                });

                if (allModels.length === 0) {
                    modelsGrid.innerHTML = '<p style="text-align: center; grid-column: 1/-1;">No models available</p>';
                }

            } catch (error) {
                console.error('Error loading models:', error);
                toastr.error('Failed to load models');
            }
        }

        // Create Model Card
        function createModelCard(model) {
            const card = document.createElement('div');
            card.className = 'model-card';
            
            const modelComments = model.comments || [];
            const publicPosts = model.publicPosts || [];
            
            card.innerHTML = `
                <img src="${model.image}" alt="${model.name}" class="model-image">
                <div class="model-info">
                    <div class="model-name">
                        <h3>${model.name}</h3>
                        ${model.verified ? '<i class="fas fa-check-circle verified"></i>' : ''}
                    </div>
                    
                    ${model.embedVideo ? `
                        <div style="margin: 1rem 0;">
                            <iframe width="100%" height="200" src="${model.embedVideo}" frameborder="0" allowfullscreen></iframe>
                        </div>
                    ` : ''}

                    <div class="model-stats">
                        <div class="likes">
                            <button class="like-btn" onclick="handleLike('${model.id}')">
                                <i class="fas fa-heart"></i>
                            </button>
                            <span>${model.likes || 0}</span>
                        </div>
                        <div class="comments">
                            <button class="comment-btn" onclick="openCommentModal('${model.id}')">
                                <i class="fas fa-comment"></i>
                            </button>
                            <span>${modelComments.length}</span>
                        </div>
                    </div>

                    ${modelComments.length > 0 ? `
                        <div class="comments-section">
                            ${modelComments.slice(0, 3).map(comment => `
                                <div class="comment">${comment}</div>
                            `).join('')}
                        </div>
                    ` : ''}

                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <button class="book-btn" onclick="openVideoCallModal('${model.id}')" style="flex: 2;">
                            <i class="fas fa-video"></i> Book Show
                        </button>
                        <button class="btn btn-outline" onclick="openChatPage('${model.id}')" style="flex: 1;">
                            <i class="fas fa-comments"></i> Chat
                        </button>
                    </div>
                </div>
            `;
            return card;
        }

        // Handle Like
        async function handleLike(modelId) {
            if (!currentUser) {
                openModal('subscriptionModal');
                return;
            }

            if (!isSubscriptionActive(currentUser)) {
                openModal('renewalModal');
                return;
            }

            try {
                const model = allModels.find(m => m.id === modelId);
                const newLikes = (model.likes || 0) + 1;
                
                await modelsRef.doc(modelId).update({
                    likes: newLikes
                });

                // Update local state
                model.likes = newLikes;
                
                // Update UI
                loadModels();
                toastr.success('Liked! ❤️');

            } catch (error) {
                console.error('Error liking model:', error);
                toastr.error('Failed to like model');
            }
        }

        // Open Comment Modal
        function openCommentModal(modelId) {
            if (!currentUser) {
                openModal('subscriptionModal');
                return;
            }

            if (!isSubscriptionActive(currentUser)) {
                openModal('renewalModal');
                return;
            }
            
            currentCommentModelId = modelId;
            document.getElementById('commentText').value = '';
            openModal('commentModal');
        }

        // Submit Comment
        async function submitComment() {
            const commentText = document.getElementById('commentText').value.trim();
            
            if (!commentText) {
                toastr.error('Please enter a comment');
                return;
            }

            try {
                const model = allModels.find(m => m.id === currentCommentModelId);
                const currentComments = model.comments || [];
                
                currentComments.unshift(commentText);
                
                await modelsRef.doc(currentCommentModelId).update({
                    comments: currentComments
                });

                toastr.success('Comment added!');
                closeModal('commentModal');
                await loadModels();
                
            } catch (error) {
                console.error('Error adding comment:', error);
                toastr.error('Failed to add comment');
            }
        }

        // Open Video Call Modal
        function openVideoCallModal(modelId) {
            if (!currentUser) {
                openModal('subscriptionModal');
                return;
            }

            if (!isSubscriptionActive(currentUser)) {
                openModal('renewalModal');
                return;
            }
            
            currentModelId = modelId;
            openModal('videoCallModal');
        }

        // Book Video Call
        async function bookVideoCall() {
            const email = document.getElementById('userEmailInput').value;
            const datetime = document.getElementById('callDateTime').value;
            const requests = document.getElementById('callRequests').value;

            if (!email) {
                toastr.error('Please enter your email');
                return;
            }

            try {
                const model = allModels.find(m => m.id === currentModelId);
                
                await bookingsRef.add({
                    modelId: currentModelId,
                    modelName: model.name,
                    userEmail: email,
                    callDateTime: datetime,
                    specialRequests: requests,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    userId: currentUser.uid
                });

                toastr.success('Booking request sent! We will contact you soon.');
                closeModal('videoCallModal');
                
                // Reset form
                document.getElementById('userEmailInput').value = '';
                document.getElementById('callDateTime').value = '';
                document.getElementById('callRequests').value = '';

            } catch (error) {
                console.error('Error booking video call:', error);
                toastr.error('Failed to book show');
            }
        }

        // Open Chat Page
        function openChatPage(modelId) {
            if (!currentUser) {
                openModal('subscriptionModal');
                return;
            }

            if (!isSubscriptionActive(currentUser)) {
                openModal('renewalModal');
                return;
            }
            
            window.open('chat1.html?model=' + modelId, '_blank');
        }

        // Check if subscription is active
        function isSubscriptionActive(user) {
            if (!user.expiresAt) return false;
            const now = new Date();
            const expires = user.expiresAt.toDate();
            return now < expires && user.isActive !== false;
        }

        // User Interface Functions
        function showUserInterface() {
            document.getElementById('userInfo').style.display = 'block';
            updateUserInfo();
        }

        function hideUserInterface() {
            document.getElementById('userInfo').style.display = 'none';
        }

        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('accountExpires').textContent = 
                    currentUser.expiresAt ? new Date(currentUser.expiresAt.toDate()).toLocaleDateString() : 'N/A';
                startAccountTimer();
            }
        }

        function startAccountTimer() {
            function updateTimer() {
                if (!currentUser || !currentUser.expiresAt) return;
                
                const now = new Date();
                const expires = currentUser.expiresAt.toDate();
                const diff = expires - now;

                const timerElement = document.getElementById('accountTimer');
                
                if (diff <= 0) {
                    timerElement.textContent = 'SUBSCRIPTION EXPIRED';
                    timerElement.className = 'account-timer expired';
                    return;
                }

                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));

                timerElement.textContent = `${days}d ${hours}h ${minutes}m remaining`;
                timerElement.className = 'account-timer';
            }

            updateTimer();
            setInterval(updateTimer, 60000); // Update every minute
        }

        function checkAccountExpiry() {
            if (!currentUser || !currentUser.expiresAt) return;
            
            const now = new Date();
            const expires = currentUser.expiresAt.toDate();

            if (now > expires) {
                openModal('renewalModal');
            }
        }

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function openLoginModal() {
            openModal('loginModal');
        }

        async function userLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                await auth.signInWithEmailAndPassword(email, password);
                closeModal('loginModal');
            } catch (error) {
                console.error('Login error:', error);
                toastr.error('Login failed: ' + error.message);
            }
        }

        function updateAuthButtons() {
            const authButtons = document.getElementById('authButtons');
            
            if (currentUser) {
                authButtons.innerHTML = `
                    <button class="btn btn-danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                `;
            } else {
                authButtons.innerHTML = `
                    <button class="btn btn-outline" onclick="openLoginModal()">
                        <i class="fas fa-user"></i> Login
                    </button>
                `;
            }
        }

        async function logout() {
            try {
                await auth.signOut();
                toastr.info('Logged out successfully');
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        function renewAccount() {
            redirectToRenewal();
        }

        function redirectToSubscribe() {
            window.location.href = 'subscription.html';
        }

        function redirectToRenewal() {
            window.location.href = 'renewal.html';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.getElementsByClassName('modal');
            for (let modal of modals) {
                if (event.target === modal) {
                    closeModal(modal.id);
                }
            }
        }
    </script>
</body>
</html>
