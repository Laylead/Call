<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Signup/Login</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="configuration.js"></script>
  <style>
    body { font-family: Arial; background: #f0f0f0; padding:20px; }
    .container { max-width:400px; margin:auto; background:#fff; padding:20px; border-radius:8px; }
    input, select { width:100%; padding:10px; margin:8px 0; }
    button { width:100%; padding:10px; }
    #loginBtn.loading { opacity:0.6; pointer-events:none; }
    #loginBtn.loading::after {
      content: " ...Loading";
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Signup / Login</h2>
    <input type="text" id="name" placeholder="Name" required>
    <input type="email" id="email" placeholder="Email" required>
    <input type="text" id="phone" placeholder="Phone Number" required>
    <select id="gender">
      <option value="">Select Gender</option>
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
    </select>
    <input type="text" id="referral" placeholder="Referral Code (optional)">
    <input type="password" id="password" placeholder="Password" required>
    <button id="signupBtn">Sign Up</button>
    <hr>
    <input type="email" id="loginEmail" placeholder="Email" required>
    <input type="password" id="loginPassword" placeholder="Password" required>
    <button id="loginBtn">Login</button>
    <p id="message"></p>
  </div>

  <script>
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const signupBtn = document.getElementById('signupBtn');
    const loginBtn = document.getElementById('loginBtn');
    const message = document.getElementById('message');

    signupBtn.addEventListener('click', async () => {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const gender = document.getElementById('gender').value;
      const referral = document.getElementById('referral').value.trim();
      const password = document.getElementById('password').value;

      if (!name || !email || !phone || !gender || !password) {
        message.textContent = "Please fill all fields.";
        return;
      }
      message.textContent = "";

      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const uid = userCredential.user.uid;
        await db.collection('users').doc(uid).set({
          name, email, phone, gender, referral, createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        window.location.href = "dashboard.html";
      } catch (error) {
        message.textContent = error.message;
      }
    });

    loginBtn.addEventListener('click', async () => {
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      if (!email || !password) {
        message.textContent = "Enter email and password.";
        return;
      }
      message.textContent = "";
      loginBtn.classList.add('loading');
      try {
        await auth.signInWithEmailAndPassword(email, password);
        window.location.href = "dashboard.html";
      } catch (error) {
        message.textContent = error.message;
      }
      loginBtn.classList.remove('loading');
    });
  </script>
</body>
</html>
