<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConnectX - Profile</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #7209b7;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --gray-color: #6c757d;
            --card-bg: #ffffff;
            --body-bg: #f5f7fb;
            --text-color: #333333;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.12);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --transition-smooth: all 0.3s ease;
            --border-radius: 16px;
            --border-radius-small: 12px;
        }

        .dark-mode {
            --primary-color: #4895ef;
            --secondary-color: #560bad;
            --accent-color: #b5179e;
            --light-color: #2d3748;
            --dark-color: #f8f9fa;
            --card-bg: #1a202c;
            --body-bg: #121826;
            --text-color: #e2e8f0;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
            --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.35);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--body-bg);
            color: var(--text-color);
            transition: var(--transition-smooth);
            min-height: 100vh;
            padding-bottom: 70px;
            overflow-x: hidden;
        }

        /* Header */
        header {
            background-color: var(--card-bg);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            color: var(--primary-color);
            font-size: 24px;
            transition: var(--transition);
        }

        .logo h1 {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            position: relative;
            overflow: hidden;
        }

        .logo h1::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            transition: var(--transition);
        }

        .logo:hover h1::after {
            width: 100%;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            position: relative;
        }

        .header-actions i {
            font-size: 20px;
            color: var(--gray-color);
            cursor: pointer;
            transition: var(--transition);
            padding: 8px;
            border-radius: 50%;
            background-color: transparent;
        }

        .header-actions i:hover {
            color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.1);
            transform: translateY(-2px);
        }

        .notification-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--warning-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            animation: pulse 1.5s infinite;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.1);
            z-index: 100;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .bottom-nav.hidden {
            transform: translateY(100%);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: var(--transition);
            padding: 8px 12px;
            border-radius: var(--border-radius-small);
            text-decoration: none;
            position: relative;
        }

        .nav-item.active, .nav-item:hover {
            background-color: rgba(67, 97, 238, 0.1);
            transform: translateY(-5px);
        }

        .nav-item i {
            font-size: 20px;
            color: var(--gray-color);
            transition: var(--transition);
        }

        .nav-item.active i, .nav-item:hover i {
            color: var(--primary-color);
        }

        .nav-item span {
            font-size: 12px;
            color: var(--gray-color);
            transition: var(--transition);
        }

        .nav-item.active span, .nav-item:hover span {
            color: var(--primary-color);
        }

        .nav-item::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 3px;
            transition: var(--transition);
        }

        .nav-item.active::after {
            width: 60%;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: -320px;
            width: 320px;
            height: 100%;
            background-color: var(--card-bg);
            box-shadow: var(--shadow);
            z-index: 200;
            transition: var(--transition);
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 199;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-smooth);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: var(--transition);
            cursor: pointer;
        }

        .user-avatar, .user-avatar-small, .post-avatar, .comment-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            object-fit: cover;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        }

        .user-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
        }

        .user-avatar-small {
            width: 40px;
            height: 40px;
            font-size: 16px;
        }

        .post-avatar, .comment-avatar {
            width: 40px;
            height: 40px;
            font-size: 16px;
        }

        .user-info h3 {
            font-size: 18px;
            margin-bottom: 5px;
            transition: var(--transition);
        }

        .user-info p {
            color: var(--gray-color);
            font-size: 14px;
            transition: var(--transition);
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
            overflow: hidden;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            border-radius: var(--border-radius-small);
            color: var(--text-color);
            text-decoration: none;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .sidebar-menu a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(67, 97, 238, 0.1), transparent);
            transition: left 0.7s;
        }

        .sidebar-menu a:hover::before, .sidebar-menu a.active::before {
            left: 100%;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            transform: translateX(5px);
        }

        .sidebar-menu i {
            font-size: 20px;
            width: 24px;
            text-align: center;
            transition: var(--transition);
        }

        /* Container */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Profile Header */
        .profile-header {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            padding: 30px 20px;
            color: white;
            text-align: center;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid white;
            margin: 0 auto 15px;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 36px;
            font-weight: bold;
        }

        .profile-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .change-avatar-btn {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .change-avatar-btn:hover {
            transform: scale(1.1);
        }

        .profile-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .profile-username {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .profile-bio {
            font-size: 14px;
            opacity: 0.8;
            max-width: 300px;
            margin: 0 auto;
            line-height: 1.4;
        }

        .profile-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 700;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }

        .profile-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .profile-btn {
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .edit-profile-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .edit-profile-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .message-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        .message-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-radius: var(--border-radius-small);
            transition: var(--transition);
            font-weight: 600;
        }

        .tab.active {
            background: var(--primary-color);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Post Feed */
        .post {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transform: translateY(10px);
            opacity: 0;
            animation: slideUpFade 0.5s forwards;
        }

        .post:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .post-user-info {
            flex: 1;
        }

        .post-user-info h4 {
            font-size: 16px;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .post-user-info p {
            font-size: 12px;
            color: var(--gray-color);
        }

        .post-options {
            color: var(--gray-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .post-options:hover {
            color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.1);
            transform: rotate(90deg);
        }

        .post-content {
            margin-bottom: 15px;
        }

        .post-text {
            margin-bottom: 10px;
            line-height: 1.5;
            white-space: pre-line;
        }

        .voice-note {
            background: linear-gradient(135deg, var(--body-bg), rgba(67, 97, 238, 0.05));
            border-radius: 25px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .voice-note:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .voice-player {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .voice-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .play-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 3px 10px rgba(67, 97, 238, 0.3);
        }

        .play-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }

        .voice-progress {
            flex: 1;
            height: 6px;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            position: relative;
            cursor: pointer;
        }

        .voice-progress-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s linear;
        }

        .voice-time {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--gray-color);
        }

        .voice-actions {
            display: flex;
            gap: 10px;
        }

        .voice-action-btn {
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            transition: var(--transition);
            padding: 5px;
            border-radius: 5px;
        }

        .voice-action-btn:hover {
            color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.1);
        }

        .post-image {
            width: 100%;
            border-radius: var(--border-radius-small);
            margin-bottom: 10px;
            transition: var(--transition);
            cursor: pointer;
        }

        .post-image:hover {
            transform: scale(1.02);
        }

        .post-stats {
            display: flex;
            justify-content: space-between;
            color: var(--gray-color);
            font-size: 14px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }

        .post-actions-bar {
            display: flex;
            justify-content: space-around;
        }

        .post-action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .post-action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(114, 9, 183, 0.1));
            border-radius: 25px;
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .post-action-btn:hover::before {
            transform: scaleX(1);
        }

        .post-action-btn:hover {
            transform: translateY(-3px);
        }

        .post-action-btn i {
            color: var(--gray-color);
            transition: var(--transition);
            position: relative;
            z-index: 1;
        }

        .post-action-btn.active i, .post-action-btn:hover i {
            color: var(--primary-color);
        }

        /* Comments Section */
        .comments-section {
            margin-top: 15px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding-top: 15px;
            transform: translateY(10px);
            opacity: 0;
            animation: slideUpFade 0.4s forwards;
        }

        .comment {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
            transition: var(--transition);
            padding: 10px;
            border-radius: var(--border-radius-small);
        }

        .comment:hover {
            background-color: rgba(0, 0, 0, 0.03);
        }

        .comment-content {
            flex: 1;
            background-color: var(--body-bg);
            padding: 12px 16px;
            border-radius: 18px;
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .comment-content:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .comment-author {
            font-weight: 600;
            font-size: 14px;
        }

        .comment-time {
            color: var(--gray-color);
            font-size: 12px;
        }

        .comment-text {
            font-size: 14px;
            line-height: 1.4;
        }

        .add-comment {
            display: flex;
            gap: 12px;
            margin-top: 10px;
        }

        .comment-input {
            flex: 1;
            padding: 12px 18px;
            border: none;
            background-color: var(--body-bg);
            border-radius: 25px;
            color: var(--text-color);
            font-size: 14px;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .comment-input:focus {
            outline: none;
            border-color: rgba(67, 97, 238, 0.3);
            box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.1);
        }

        .send-comment {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 3px 10px rgba(67, 97, 238, 0.3);
        }

        .send-comment:hover {
            background: linear-gradient(135deg, var(--secondary-color), var(--accent-color));
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }

        /* Edit Profile Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 300;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-smooth);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow);
            transform: translateY(20px) scale(0.95);
            transition: var(--transition);
        }

        .modal.active .modal-content {
            transform: translateY(0) scale(1);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin-bottom: 10px;
            color: var(--primary-color);
            position: relative;
            display: inline-block;
        }

        .modal-header h2::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            border-radius: 2px;
        }

        .close-modal {
            font-size: 20px;
            color: var(--gray-color);
            cursor: pointer;
            transition: var(--transition);
            padding: 8px;
            border-radius: 50%;
        }

        .close-modal:hover {
            color: var(--warning-color);
            background-color: rgba(247, 37, 133, 0.1);
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 15px 18px;
            border: 1px solid var(--body-bg);
            border-radius: var(--border-radius-small);
            background-color: var(--body-bg);
            color: var(--text-color);
            transition: var(--transition);
            font-size: 15px;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .btn {
            padding: 15px 20px;
            border: none;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            width: 100%;
            font-size: 16px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
        }

        .profile-picture-section {
            text-align: center;
            margin-bottom: 20px;
        }

        .profile-picture-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 40px;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }

        .profile-picture-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .upload-picture-btn {
            padding: 10px 20px;
            background: var(--body-bg);
            border: none;
            border-radius: 20px;
            color: var(--text-color);
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .upload-picture-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .username-change-info {
            background: rgba(67, 97, 238, 0.1);
            padding: 10px 15px;
            border-radius: var(--border-radius-small);
            margin-bottom: 15px;
            font-size: 14px;
            color: var(--primary-color);
        }

        .bio-textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 1px solid var(--body-bg);
            border-radius: var(--border-radius-small);
            background: var(--body-bg);
            color: var(--text-color);
            resize: vertical;
            font-family: inherit;
        }

        .bio-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .char-count {
            text-align: right;
            font-size: 12px;
            color: var(--gray-color);
            margin-top: 5px;
        }

        /* Verified Badge */
        .verified-badge {
            color: var(--primary-color);
            font-size: 12px;
        }

        /* Gender Badge */
        .gender-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 5px;
        }

        .gender-male {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .gender-female {
            background-color: rgba(247, 37, 133, 0.1);
            color: var(--warning-color);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes slideUpFade {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes pulse {
            0% { 
                transform: scale(1);
                box-shadow: 0 4px 15px rgba(247, 37, 133, 0.3);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 6px 25px rgba(247, 37, 133, 0.5);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 4px 15px rgba(247, 37, 133, 0.3);
            }
        }

        /* Media Grid */
        .user-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .user-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .user-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .user-card-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 10px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
        }

        .user-card-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .user-card-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-card-username {
            font-size: 12px;
            color: var(--gray-color);
            margin-bottom: 10px;
        }

        .user-card-bio {
            font-size: 12px;
            color: var(--text-color);
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .follow-btn-small {
            padding: 6px 12px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .follow-btn-small:hover {
            background: var(--secondary-color);
        }

        .follow-btn-small.following {
            background: var(--gray-color);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 280px;
            }
            
            .container {
                padding: 15px;
            }

            .user-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .post-actions-bar {
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .post-action-btn {
                padding: 8px 15px;
            }

            .profile-stats {
                gap: 15px;
            }
            
            .user-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Edit Profile Modal -->
    <div class="modal edit-profile-modal" id="editProfileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-edit"></i> Edit Profile</h2>
                <i class="fas fa-times close-modal" id="closeEditProfileModal"></i>
            </div>
            <form id="editProfileForm">
                <div class="profile-picture-section">
                    <div class="profile-picture-preview" id="profilePicturePreview">
                        <div id="profileInitials">U</div>
                        <img id="profilePictureImg" style="display: none;">
                    </div>
                    <input type="file" id="profilePictureInput" accept="image/*" style="display: none;">
                    <button type="button" class="upload-picture-btn" id="uploadPictureBtn">
                        <i class="fas fa-camera"></i> Change Photo
                    </button>
                </div>

                <div class="form-group">
                    <label for="editFullName"><i class="fas fa-user"></i> Full Name</label>
                    <input type="text" id="editFullName" placeholder="Enter your full name">
                </div>

                <div class="form-group">
                    <label for="editUsername"><i class="fas fa-at"></i> Username</label>
                    <input type="text" id="editUsername" placeholder="Choose a username">
                    <div class="username-change-info" id="usernameChangeInfo">
                        <i class="fas fa-info-circle"></i> You can change your username 2 times every 6 months
                    </div>
                </div>

                <div class="form-group">
                    <label for="editGender"><i class="fas fa-venus-mars"></i> Gender</label>
                    <select id="editGender">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editBio"><i class="fas fa-pencil-alt"></i> Bio</label>
                    <textarea class="bio-textarea" id="editBio" placeholder="Tell us about yourself"></textarea>
                    <div class="char-count"><span id="bioCharCount">0</span>/150</div>
                </div>

                <button type="submit" class="btn btn-primary" id="saveProfileBtn">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </form>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="logo">
            <i class="fas fa-phone-alt"></i>
            <h1>ConnectX</h1>
        </div>
        <div class="header-actions">
            <i class="fas fa-search" id="searchBtn" title="Search"></i>
            <a href="message.html" style="text-decoration: none; color: inherit;">
                <i class="fas fa-comments" id="messagesBtn" title="Messages"></i>
            </a>
            <div style="position: relative;">
                <i class="fas fa-bell" id="notificationsBtn" title="Notifications"></i>
                <div class="notification-badge" id="notificationBadge" style="display: none;">0</div>
            </div>
            <i class="fas fa-bars" id="menuToggle" title="Menu"></i>
        </div>
    </header>

    <!-- Profile Content -->
    <div class="profile-header">
        <div class="profile-avatar" id="profileAvatar">
            <div id="profileAvatarInitials">U</div>
            <img id="profileAvatarImg" style="display: none;">
            <div class="change-avatar-btn" id="changeAvatarBtn">
                <i class="fas fa-camera"></i>
            </div>
        </div>
        <h1 class="profile-name" id="profileName">User Name</h1>
        <p class="profile-username" id="profileUsername">@username</p>
        <p class="profile-bio" id="profileBio">This is a bio. It can be long or short.</p>
        
        <div class="profile-stats">
            <div class="stat">
                <span class="stat-value" id="postsCount">0</span>
                <span class="stat-label">Posts</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="followersCount">0</span>
                <span class="stat-label">Followers</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="followingCount">0</span>
                <span class="stat-label">Following</span>
            </div>
        </div>
        
        <div class="profile-actions" id="profileActions">
            <button class="profile-btn edit-profile-btn" id="editProfileBtn">
                <i class="fas fa-user-edit"></i> Edit Profile
            </button>
        </div>
    </div>

    <div class="container">
        <div class="tabs">
            <div class="tab active" data-tab="posts">Posts</div>
            <div class="tab" data-tab="media">Media</div>
            <div class="tab" data-tab="likes">Likes</div>
        </div>

        <div class="tab-content active" id="postsTab">
            <div id="userPosts">
                <!-- User's posts will be loaded here -->
            </div>
        </div>
        
        <div class="tab-content" id="mediaTab">
            <div id="userMedia">
                <!-- User's media will be loaded here -->
            </div>
        </div>
        
        <div class="tab-content" id="likesTab">
            <div id="userLikes">
                <!-- User's liked posts will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="sidebar" id="sidebar">
        <div class="user-profile" id="sidebarUserProfile">
            <div class="user-avatar" id="userAvatar">U</div>
            <div class="user-info">
                <h3 id="userName">Guest User</h3>
                <p id="userHandle">@guest</p>
            </div>
        </div>
        <ul class="sidebar-menu">
            <li><a href="home.html" class="sidebar-link"><i class="fas fa-home"></i> Home</a></li>
            <li><a href="#" class="sidebar-link active"><i class="fas fa-user"></i> Profile</a></li>
            <li><a href="friends.html" class="sidebar-link"><i class="fas fa-user-friends"></i> Find Friends</a></li>
            <li><a href="keypad.html" class="sidebar-link"><i class="fas fa-phone"></i> Keypad</a></li>
            <li><a href="groups.html" class="sidebar-link"><i class="fas fa-users"></i> Groups & Channels</a></li>
            <li><a href="mentors.html" class="sidebar-link"><i class="fas fa-user-graduate"></i> Mentors</a></li>
            <li><a href="smile.html" class="sidebar-link"><i class="fas fa-smile"></i> Smile</a></li>
            <li><a href="wallet.html" class="sidebar-link"><i class="fas fa-wallet"></i> Wallet</a></li>
            <li><a href="account.html" class="sidebar-link"><i class="fas fa-user-circle"></i> Account</a></li>
            <li><a href="#" id="themeToggleSidebar"><i class="fas fa-moon"></i> <span>Dark Mode</span></a></li>
            <li><a href="#" id="logoutBtn" class="sidebar-link"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav" id="bottomNav">
        <a href="home.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="friends.html" class="nav-item">
            <i class="fas fa-user-friends"></i>
            <span>Friends</span>
        </a>
        <a href="keypad.html" class="nav-item">
            <i class="fas fa-phone"></i>
            <span>Keypad</span>
        </a>
        <a href="contacts.html" class="nav-item">
            <i class="fas fa-address-book"></i>
            <span>Contacts</span>
        </a>
        <a href="#" class="nav-item active">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
    </div>

    <!-- External Configuration -->
    <script src="configuration.js"></script>

    <!-- External Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <!-- Profile Page Script -->
    <script>
        // Profile Page Application
        class ConnectXProfile {
            constructor() {
                this.state = {
                    currentUser: null,
                    isLoggedIn: false,
                    userProfile: null,
                    profilePictureFile: null,
                    viewingUserId: null, // For viewing other users' profiles
                    posts: [],
                    mediaPosts: [],
                    likedPosts: [],
                    isOwnProfile: true
                };

                this.init();
            }

            async init() {
                try {
                    // Check if external configuration is loaded
                    if (typeof firebaseConfig === 'undefined') {
                        console.error('Configuration not loaded. Using demo mode.');
                        this.setupDemoMode();
                    } else {
                        // Initialize Firebase if not already initialized
                        if (!firebase.apps.length) {
                            firebase.initializeApp(firebaseConfig);
                        }
                    }
                    
                    this.setupDOMReferences();
                    this.setupEventListeners();
                    await this.checkAuthStatus();
                    await this.checkViewingUser();
                    this.loadTheme();
                    console.log('ConnectX Profile initialized successfully');
                } catch (error) {
                    console.error('Profile initialization failed:', error);
                }
            }

            setupDemoMode() {
                // Demo configuration for testing
                const demoConfig = {
                    apiKey: "demo-api-key",
                    authDomain: "connectx-demo.firebaseapp.com",
                    projectId: "connectx-demo",
                    storageBucket: "connectx-demo.appspot.com",
                    messagingSenderId: "123456789",
                    appId: "demo-app-id"
                };
                
                try {
                    if (!firebase.apps.length) {
                        firebase.initializeApp(demoConfig);
                    }
                    console.log('Demo mode activated');
                } catch (error) {
                    console.log('Firebase not available, running in offline mode');
                }
            }

            setupDOMReferences() {
                this.elements = {
                    menuToggle: document.getElementById('menuToggle'),
                    sidebar: document.getElementById('sidebar'),
                    sidebarOverlay: document.getElementById('sidebarOverlay'),
                    bottomNav: document.getElementById('bottomNav'),
                    themeToggleSidebar: document.getElementById('themeToggleSidebar'),
                    logoutBtn: document.getElementById('logoutBtn'),
                    userAvatar: document.getElementById('userAvatar'),
                    userName: document.getElementById('userName'),
                    userHandle: document.getElementById('userHandle'),
                    sidebarUserProfile: document.getElementById('sidebarUserProfile'),
                    
                    // Profile elements
                    profileAvatar: document.getElementById('profileAvatar'),
                    profileAvatarInitials: document.getElementById('profileAvatarInitials'),
                    profileAvatarImg: document.getElementById('profileAvatarImg'),
                    changeAvatarBtn: document.getElementById('changeAvatarBtn'),
                    profileName: document.getElementById('profileName'),
                    profileUsername: document.getElementById('profileUsername'),
                    profileBio: document.getElementById('profileBio'),
                    postsCount: document.getElementById('postsCount'),
                    followersCount: document.getElementById('followersCount'),
                    followingCount: document.getElementById('followingCount'),
                    profileActions: document.getElementById('profileActions'),
                    editProfileBtn: document.getElementById('editProfileBtn'),
                    
                    // Tabs
                    tabs: document.querySelectorAll('.tab'),
                    tabContents: document.querySelectorAll('.tab-content'),
                    
                    // Content areas
                    userPosts: document.getElementById('userPosts'),
                    userMedia: document.getElementById('userMedia'),
                    userLikes: document.getElementById('userLikes'),
                    
                    // Edit Profile Modal
                    editProfileModal: document.getElementById('editProfileModal'),
                    closeEditProfileModal: document.getElementById('closeEditProfileModal'),
                    uploadPictureBtn: document.getElementById('uploadPictureBtn'),
                    profilePictureInput: document.getElementById('profilePictureInput'),
                    profilePicturePreview: document.getElementById('profilePicturePreview'),
                    profileInitials: document.getElementById('profileInitials'),
                    profilePictureImg: document.getElementById('profilePictureImg'),
                    editFullName: document.getElementById('editFullName'),
                    editUsername: document.getElementById('editUsername'),
                    editGender: document.getElementById('editGender'),
                    editBio: document.getElementById('editBio'),
                    saveProfileBtn: document.getElementById('saveProfileBtn'),
                    usernameChangeInfo: document.getElementById('usernameChangeInfo'),
                    bioCharCount: document.getElementById('bioCharCount')
                };
            }

            setupEventListeners() {
                // Navigation Events
                this.elements.menuToggle.addEventListener('click', () => this.toggleSidebar());
                this.elements.sidebarOverlay.addEventListener('click', () => this.toggleSidebar());
                this.elements.themeToggleSidebar.addEventListener('click', () => this.toggleTheme());
                this.elements.sidebarUserProfile.addEventListener('click', () => {
                    // Already on profile page
                });

                // Logout
                this.elements.logoutBtn.addEventListener('click', (e) => this.handleLogout(e));

                // Profile Actions
                this.elements.editProfileBtn.addEventListener('click', () => this.showEditProfileModal());
                this.elements.changeAvatarBtn.addEventListener('click', () => this.elements.profilePictureInput.click());

                // Edit Profile Modal Events
                this.elements.closeEditProfileModal.addEventListener('click', () => this.hideEditProfileModal());
                this.elements.uploadPictureBtn.addEventListener('click', () => this.elements.profilePictureInput.click());
                this.elements.profilePictureInput.addEventListener('change', (e) => this.handleProfilePictureChange(e));
                this.elements.editBio.addEventListener('input', () => this.updateBioCharCount());
                this.elements.saveProfileBtn.addEventListener('click', (e) => this.handleSaveProfile(e));

                // Tab Navigation
                this.elements.tabs.forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabName = e.currentTarget.getAttribute('data-tab');
                        this.switchTab(tabName);
                    });
                });

                // Bottom nav scroll behavior
                let lastScrollTop = 0;
                window.addEventListener('scroll', () => {
                    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    if (scrollTop > lastScrollTop && scrollTop > 100) {
                        this.elements.bottomNav.classList.add('hidden');
                    } else {
                        this.elements.bottomNav.classList.remove('hidden');
                    }
                    lastScrollTop = scrollTop;
                });
            }

            // Authentication Methods
            async checkAuthStatus() {
                return new Promise((resolve) => {
                    firebase.auth().onAuthStateChanged(async (user) => {
                        if (user) {
                            this.state.currentUser = user;
                            this.state.isLoggedIn = true;
                            await this.updateUserUI();
                            await this.loadUserProfile();
                        } else {
                            this.state.isLoggedIn = false;
                            this.state.currentUser = null;
                            // Redirect to index.html for logged out users
                            window.location.href = 'index.html';
                        }
                        resolve();
                    });
                });
            }

            async checkViewingUser() {
                // Check if we're viewing another user's profile
                const urlParams = new URLSearchParams(window.location.search);
                const userId = urlParams.get('user');
                
                if (userId && userId !== this.state.currentUser?.uid) {
                    this.state.viewingUserId = userId;
                    this.state.isOwnProfile = false;
                    await this.loadOtherUserProfile(userId);
                } else {
                    this.state.isOwnProfile = true;
                    await this.loadUserProfilePage();
                }
            }

            async handleLogout(e) {
                e.preventDefault();
                if (confirm('Are you sure you want to logout?')) {
                    await firebase.auth().signOut();
                    // Redirect to index.html after logout
                    window.location.href = 'index.html';
                }
            }

            // UI Methods
            async updateUserUI() {
                if (this.state.currentUser) {
                    try {
                        const userDoc = await firebase.firestore().collection('users').doc(this.state.currentUser.uid).get();
                        if (userDoc.exists) {
                            const userData = userDoc.data();
                            this.elements.userName.textContent = userData.name;
                            this.elements.userHandle.textContent = `@${userData.username}`;
                            
                            // Set profile pictures
                            const initials = userData.name.split(' ').map(n => n[0]).join('').toUpperCase();
                            
                            if (userData.profilePicture) {
                                this.elements.userAvatar.innerHTML = `<img src="${userData.profilePicture}" alt="Profile Picture">`;
                            } else {
                                this.elements.userAvatar.textContent = initials;
                                this.elements.userAvatar.style.display = 'flex';
                                this.elements.userAvatar.style.alignItems = 'center';
                                this.elements.userAvatar.style.justifyContent = 'center';
                            }
                        }
                    } catch (error) {
                        console.error('Error loading user data:', error);
                    }
                }
            }

            // Sidebar Methods
            toggleSidebar(show = null) {
                if (show === null) {
                    // Toggle if no parameter provided
                    this.elements.sidebar.classList.toggle('active');
                    this.elements.sidebarOverlay.classList.toggle('active');
                } else {
                    // Set specific state
                    if (show) {
                        this.elements.sidebar.classList.add('active');
                        this.elements.sidebarOverlay.classList.add('active');
                    } else {
                        this.elements.sidebar.classList.remove('active');
                        this.elements.sidebarOverlay.classList.remove('active');
                    }
                }
            }

            // Theme Methods
            toggleTheme() {
                const currentTheme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                document.body.classList.toggle('dark-mode');
                
                const icon = this.elements.themeToggleSidebar.querySelector('i');
                const text = this.elements.themeToggleSidebar.querySelector('span');
                
                if (newTheme === 'dark') {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                    text.textContent = 'Light Mode';
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                    text.textContent = 'Dark Mode';
                }
                
                localStorage.setItem('theme', newTheme);
            }

            // Profile Methods
            async loadUserProfile() {
                if (!this.state.currentUser) return;

                try {
                    // Set up real-time listener for user profile
                    firebase.firestore()
                        .collection('users')
                        .doc(this.state.currentUser.uid)
                        .onSnapshot(doc => {
                            if (doc.exists) {
                                this.state.userProfile = doc.data();
                                this.updateProfileUI();
                            }
                        }, error => {
                            console.error('Error loading user profile:', error);
                        });
                } catch (error) {
                    console.error('Error loading user profile:', error);
                }
            }

            async loadUserProfilePage() {
                if (!this.state.currentUser) return;

                try {
                    const userDoc = await firebase.firestore().collection('users').doc(this.state.currentUser.uid).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        
                        // Update profile page
                        this.elements.profileName.textContent = userData.name;
                        this.elements.profileUsername.textContent = `@${userData.username}`;
                        this.elements.profileBio.textContent = userData.bio || 'No bio yet';
                        
                        // Update stats
                        this.elements.postsCount.textContent = userData.posts ? userData.posts.length : 0;
                        this.elements.followersCount.textContent = userData.followers ? userData.followers.length : 0;
                        this.elements.followingCount.textContent = userData.following ? userData.following.length : 0;
                        
                        // Update avatar
                        if (userData.profilePicture) {
                            this.elements.profileAvatar.innerHTML = `<img src="${userData.profilePicture}" alt="Profile Picture">`;
                            this.elements.profileAvatarInitials.style.display = 'none';
                            this.elements.profileAvatarImg.src = userData.profilePicture;
                            this.elements.profileAvatarImg.style.display = 'block';
                        } else {
                            const initials = userData.name.split(' ').map(n => n[0]).join('').toUpperCase();
                            this.elements.profileAvatarInitials.textContent = initials;
                            this.elements.profileAvatarInitials.style.display = 'flex';
                            this.elements.profileAvatarImg.style.display = 'none';
                        }

                        // Show edit profile button for own profile
                        this.elements.profileActions.innerHTML = `
                            <button class="profile-btn edit-profile-btn" id="editProfileBtn">
                                <i class="fas fa-user-edit"></i> Edit Profile
                            </button>
                        `;
                        
                        // Reattach event listener
                        document.getElementById('editProfileBtn').addEventListener('click', () => this.showEditProfileModal());

                        // Load user's posts
                        this.loadUserPosts();
                    }
                } catch (error) {
                    console.error('Error loading user profile page:', error);
                }
            }

            async loadOtherUserProfile(userId) {
                try {
                    const userDoc = await firebase.firestore().collection('users').doc(userId).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        
                        // Update profile page
                        this.elements.profileName.textContent = userData.name;
                        this.elements.profileUsername.textContent = `@${userData.username}`;
                        this.elements.profileBio.textContent = userData.bio || 'No bio yet';
                        
                        // Update stats
                        this.elements.postsCount.textContent = userData.posts ? userData.posts.length : 0;
                        this.elements.followersCount.textContent = userData.followers ? userData.followers.length : 0;
                        this.elements.followingCount.textContent = userData.following ? userData.following.length : 0;
                        
                        // Update avatar
                        if (userData.profilePicture) {
                            this.elements.profileAvatar.innerHTML = `<img src="${userData.profilePicture}" alt="Profile Picture">`;
                            this.elements.profileAvatarInitials.style.display = 'none';
                            this.elements.profileAvatarImg.src = userData.profilePicture;
                            this.elements.profileAvatarImg.style.display = 'block';
                        } else {
                            const initials = userData.name.split(' ').map(n => n[0]).join('').toUpperCase();
                            this.elements.profileAvatarInitials.textContent = initials;
                            this.elements.profileAvatarInitials.style.display = 'flex';
                            this.elements.profileAvatarImg.style.display = 'none';
                        }

                        // Hide change avatar button for other users
                        this.elements.changeAvatarBtn.style.display = 'none';

                        // Check if current user is following this user
                        const currentUserDoc = await firebase.firestore().collection('users').doc(this.state.currentUser.uid).get();
                        const currentUserData = currentUserDoc.data();
                        const isFollowing = currentUserData.following && currentUserData.following.includes(userId);

                        // Show follow/message buttons for other users
                        this.elements.profileActions.innerHTML = `
                            <button class="profile-btn message-btn" id="messageUserBtn">
                                <i class="fas fa-envelope"></i> Message
                            </button>
                            <button class="profile-btn edit-profile-btn ${isFollowing ? 'following' : ''}" id="followUserBtn">
                                <i class="fas fa-user-${isFollowing ? 'check' : 'plus'}"></i> ${isFollowing ? 'Following' : 'Follow'}
                            </button>
                        `;

                        // Add event listeners
                        document.getElementById('messageUserBtn').addEventListener('click', () => this.messageUser(userId));
                        document.getElementById('followUserBtn').addEventListener('click', () => this.handleFollowUser(userId, document.getElementById('followUserBtn')));

                        // Hide likes tab for other users
                        document.querySelector('.tab[data-tab="likes"]').style.display = 'none';

                        // Load user's posts
                        this.loadOtherUserPosts(userId);
                    }
                } catch (error) {
                    console.error('Error loading other user profile:', error);
                }
            }

            async loadUserPosts() {
                try {
                    const userDoc = await firebase.firestore().collection('users').doc(this.state.currentUser.uid).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        const postIds = userData.posts || [];
                        
                        if (postIds.length === 0) {
                            this.elements.userPosts.innerHTML = `
                                <div style="text-align: center; padding: 40px 20px; color: var(--gray-color);">
                                    <i class="fas fa-feather-alt" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                                    <p>No posts yet</p>
                                </div>
                            `;
                            return;
                        }
                        
                        // Fetch posts
                        const posts = [];
                        for (const postId of postIds) {
                            const postDoc = await firebase.firestore().collection('posts').doc(postId).get();
                            if (postDoc.exists) {
                                posts.push({ id: postDoc.id, ...postDoc.data() });
                            }
                        }
                        
                        // Sort by creation date
                        posts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                        
                        // Render posts
                        this.elements.userPosts.innerHTML = posts.map(post => {
                            const isLiked = post.likedBy && post.likedBy.includes(this.state.currentUser?.uid);
                            const likeCount = post.likes ? post.likes.length : 0;
                            const commentCount = post.comments ? post.comments.length : 0;
                            
                            // Determine post content based on media type
                            let mediaContent = '';
                            if (post.mediaType === 'image') {
                                mediaContent = `<img src="${post.mediaUrl}" alt="Post image" class="post-image">`;
                            } else if (post.mediaType === 'video') {
                                mediaContent = `<video controls class="post-image"><source src="${post.mediaUrl}" type="video/mp4"></video>`;
                            } else if (post.mediaType === 'voice') {
                                mediaContent = `
                                    <div class="voice-note">
                                        <div class="voice-player">
                                            <div class="voice-controls">
                                                <div class="play-btn" id="voicePlayBtn-${post.id}">
                                                    <i class="fas fa-play"></i>
                                                </div>
                                                <div class="voice-progress" id="voiceProgress-${post.id}">
                                                    <div class="voice-progress-bar" id="voiceProgressBar-${post.id}"></div>
                                                </div>
                                                <div class="voice-time">
                                                    <span id="voiceCurrentTime-${post.id}">00:00</span>
                                                    <span id="voiceDurationDisplay-${post.id}">${post.voiceDuration || '1:25'}</span>
                                                </div>
                                            </div>
                                            <div class="voice-actions">
                                                <button class="voice-action-btn" id="voiceRewindBtn-${post.id}" title="Rewind 10s">
                                                    <i class="fas fa-backward"></i>
                                                </button>
                                                <button class="voice-action-btn" id="voiceForwardBtn-${post.id}" title="Forward 10s">
                                                    <i class="fas fa-forward"></i>
                                                </button>
                                                <button class="voice-action-btn" id="voiceSpeedBtn-${post.id}" title="Change Speed">
                                                    1x
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <audio id="audio-${post.id}" src="${post.mediaUrl}" style="display: none;"></audio>
                                `;
                            }
                            
                            return `
                            <div class="post" data-post-id="${post.id}">
                                <div class="post-header">
                                    ${post.authorProfilePicture ? 
                                        `<div class="post-avatar"><img src="${post.authorProfilePicture}" alt="${post.authorName}"></div>` :
                                        `<div class="post-avatar">${post.authorName ? post.authorName.charAt(0).toUpperCase() : 'U'}</div>`
                                    }
                                    <div class="post-user-info">
                                        <h4>${post.authorName || 'Unknown User'} ${post.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}</h4>
                                        <p><i class="far fa-clock"></i> ${this.formatTime(post.createdAt)}</p>
                                    </div>
                                    <div class="post-options">
                                        <i class="fas fa-ellipsis-h"></i>
                                        <div class="post-menu" style="display: none; position: absolute; right: 0; top: 30px; background: var(--card-bg); border-radius: 10px; box-shadow: var(--shadow); padding: 10px; z-index: 10;">
                                            <div class="post-menu-item delete-post" data-post-id="${post.id}" style="padding: 8px 12px; cursor: pointer; border-radius: 5px; transition: var(--transition);">
                                                <i class="fas fa-trash"></i> Delete
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="post-content">
                                    <p class="post-text">${post.content || ''}</p>
                                    ${mediaContent}
                                </div>
                                <div class="post-stats">
                                    <span><i class="fas fa-thumbs-up"></i> ${likeCount} likes</span>
                                    <span><i class="fas fa-comment"></i> ${commentCount} comments</span>
                                    <span><i class="fas fa-share"></i> ${post.shares || 0} shares</span>
                                </div>
                                <div class="post-actions-bar">
                                    <div class="post-action-btn like-btn ${isLiked ? 'active' : ''}" data-post-id="${post.id}">
                                        <i class="${isLiked ? 'fas' : 'far'} fa-thumbs-up"></i>
                                        <span>${isLiked ? 'Liked' : 'Like'}</span>
                                    </div>
                                    <div class="post-action-btn comment-btn" data-post-id="${post.id}">
                                        <i class="far fa-comment"></i>
                                        <span>Comment</span>
                                    </div>
                                    <div class="post-action-btn share-btn" data-post-id="${post.id}">
                                        <i class="fas fa-share"></i>
                                        <span>Share</span>
                                    </div>
                                </div>
                            </div>
                        `}).join('');
                        
                        // Add event listeners to user posts
                        this.addUserPostEventListeners();
                        
                        // Setup voice players for posts with voice notes
                        posts.forEach(post => {
                            if (post.mediaType === 'voice') {
                                this.setupPostVoicePlayer(post.id);
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error loading user posts:', error);
                }
            }

            async loadOtherUserPosts(userId) {
                try {
                    const userDoc = await firebase.firestore().collection('users').doc(userId).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        const postIds = userData.posts || [];
                        
                        if (postIds.length === 0) {
                            this.elements.userPosts.innerHTML = `
                                <div style="text-align: center; padding: 40px 20px; color: var(--gray-color);">
                                    <i class="fas fa-feather-alt" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                                    <p>No posts yet</p>
                                </div>
                            `;
                            return;
                        }
                        
                        // Fetch posts
                        const posts = [];
                        for (const postId of postIds) {
                            const postDoc = await firebase.firestore().collection('posts').doc(postId).get();
                            if (postDoc.exists) {
                                posts.push({ id: postDoc.id, ...postDoc.data() });
                            }
                        }
                        
                        // Sort by creation date
                        posts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                        
                        // Render posts
                        this.elements.userPosts.innerHTML = posts.map(post => {
                            const isLiked = post.likedBy && post.likedBy.includes(this.state.currentUser?.uid);
                            const likeCount = post.likes ? post.likes.length : 0;
                            const commentCount = post.comments ? post.comments.length : 0;
                            
                            // Determine post content based on media type
                            let mediaContent = '';
                            if (post.mediaType === 'image') {
                                mediaContent = `<img src="${post.mediaUrl}" alt="Post image" class="post-image">`;
                            } else if (post.mediaType === 'video') {
                                mediaContent = `<video controls class="post-image"><source src="${post.mediaUrl}" type="video/mp4"></video>`;
                            } else if (post.mediaType === 'voice') {
                                mediaContent = `
                                    <div class="voice-note">
                                        <div class="voice-player">
                                            <div class="voice-controls">
                                                <div class="play-btn" id="voicePlayBtn-${post.id}">
                                                    <i class="fas fa-play"></i>
                                                </div>
                                                <div class="voice-progress" id="voiceProgress-${post.id}">
                                                    <div class="voice-progress-bar" id="voiceProgressBar-${post.id}"></div>
                                                </div>
                                                <div class="voice-time">
                                                    <span id="voiceCurrentTime-${post.id}">00:00</span>
                                                    <span id="voiceDurationDisplay-${post.id}">${post.voiceDuration || '1:25'}</span>
                                                </div>
                                            </div>
                                            <div class="voice-actions">
                                                <button class="voice-action-btn" id="voiceRewindBtn-${post.id}" title="Rewind 10s">
                                                    <i class="fas fa-backward"></i>
                                                </button>
                                                <button class="voice-action-btn" id="voiceForwardBtn-${post.id}" title="Forward 10s">
                                                    <i class="fas fa-forward"></i>
                                                </button>
                                                <button class="voice-action-btn" id="voiceSpeedBtn-${post.id}" title="Change Speed">
                                                    1x
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <audio id="audio-${post.id}" src="${post.mediaUrl}" style="display: none;"></audio>
                                `;
                            }
                            
                            return `
                            <div class="post" data-post-id="${post.id}">
                                <div class="post-header">
                                    ${post.authorProfilePicture ? 
                                        `<div class="post-avatar"><img src="${post.authorProfilePicture}" alt="${post.authorName}"></div>` :
                                        `<div class="post-avatar">${post.authorName ? post.authorName.charAt(0).toUpperCase() : 'U'}</div>`
                                    }
                                    <div class="post-user-info">
                                        <h4>${post.authorName || 'Unknown User'} ${post.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}</h4>
                                        <p><i class="far fa-clock"></i> ${this.formatTime(post.createdAt)}</p>
                                    </div>
                                </div>
                                <div class="post-content">
                                    <p class="post-text">${post.content || ''}</p>
                                    ${mediaContent}
                                </div>
                                <div class="post-stats">
                                    <span><i class="fas fa-thumbs-up"></i> ${likeCount} likes</span>
                                    <span><i class="fas fa-comment"></i> ${commentCount} comments</span>
                                    <span><i class="fas fa-share"></i> ${post.shares || 0} shares</span>
                                </div>
                                <div class="post-actions-bar">
                                    <div class="post-action-btn like-btn ${isLiked ? 'active' : ''}" data-post-id="${post.id}">
                                        <i class="${isLiked ? 'fas' : 'far'} fa-thumbs-up"></i>
                                        <span>${isLiked ? 'Liked' : 'Like'}</span>
                                    </div>
                                    <div class="post-action-btn comment-btn" data-post-id="${post.id}">
                                        <i class="far fa-comment"></i>
                                        <span>Comment</span>
                                    </div>
                                    <div class="post-action-btn share-btn" data-post-id="${post.id}">
                                        <i class="fas fa-share"></i>
                                        <span>Share</span>
                                    </div>
                                </div>
                            </div>
                        `}).join('');
                        
                        // Add event listeners to other user posts
                        this.addOtherUserPostEventListeners();
                        
                        // Setup voice players for posts with voice notes
                        posts.forEach(post => {
                            if (post.mediaType === 'voice') {
                                this.setupPostVoicePlayer(post.id);
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error loading other user posts:', error);
                }
            }

            async loadUserMedia() {
                try {
                    const userId = this.state.isOwnProfile ? this.state.currentUser.uid : this.state.viewingUserId;
                    const userDoc = await firebase.firestore().collection('users').doc(userId).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        const postIds = userData.posts || [];
                        
                        if (postIds.length === 0) {
                            this.elements.userMedia.innerHTML = `
                                <div style="text-align: center; padding: 40px 20px; color: var(--gray-color);">
                                    <i class="fas fa-images" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                                    <p>No media posts yet</p>
                                </div>
                            `;
                            return;
                        }
                        
                        // Fetch posts with media
                        const mediaPosts = [];
                        for (const postId of postIds) {
                            const postDoc = await firebase.firestore().collection('posts').doc(postId).get();
                            if (postDoc.exists) {
                                const postData = postDoc.data();
                                if (postData.mediaType && postData.mediaType !== 'voice') {
                                    mediaPosts.push({ id: postDoc.id, ...postData });
                                }
                            }
                        }
                        
                        // Sort by creation date
                        mediaPosts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                        
                        // Render media grid
                        if (mediaPosts.length === 0) {
                            this.elements.userMedia.innerHTML = `
                                <div style="text-align: center; padding: 40px 20px; color: var(--gray-color);">
                                    <i class="fas fa-images" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                                    <p>No media posts yet</p>
                                </div>
                            `;
                            return;
                        }
                        
                        this.elements.userMedia.innerHTML = `
                            <div class="user-grid">
                                ${mediaPosts.map(post => `
                                    <div class="user-card">
                                        ${post.mediaType === 'image' ? 
                                            `<img src="${post.mediaUrl}" alt="Post image" style="width: 100%; height: 150px; object-fit: cover; border-radius: 10px; margin-bottom: 10px;">` :
                                            `<video style="width: 100%; height: 150px; object-fit: cover; border-radius: 10px; margin-bottom: 10px;">
                                                <source src="${post.mediaUrl}" type="video/mp4">
                                            </video>`
                                        }
                                        <div class="user-card-name">${post.content ? post.content.substring(0, 30) + (post.content.length > 30 ? '...' : '') : 'Media Post'}</div>
                                        <div class="user-card-username"><i class="far fa-clock"></i> ${this.formatTime(post.createdAt)}</div>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('Error loading user media:', error);
                }
            }

            async loadUserLikes() {
                try {
                    const userDoc = await firebase.firestore().collection('users').doc(this.state.currentUser.uid).get();
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        const likedPostIds = userData.likedPosts || [];
                        
                        if (likedPostIds.length === 0) {
                            this.elements.userLikes.innerHTML = `
                                <div style="text-align: center; padding: 40px 20px; color: var(--gray-color);">
                                    <i class="fas fa-heart" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                                    <p>No liked posts yet</p>
                                </div>
                            `;
                            return;
                        }
                        
                        // Fetch liked posts
                        const likedPosts = [];
                        for (const postId of likedPostIds) {
                            const postDoc = await firebase.firestore().collection('posts').doc(postId).get();
                            if (postDoc.exists) {
                                likedPosts.push({ id: postDoc.id, ...postDoc.data() });
                            }
                        }
                        
                        // Sort by creation date
                        likedPosts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                        
                        // Render liked posts
                        this.elements.userLikes.innerHTML = likedPosts.map(post => {
                            const isLiked = post.likedBy && post.likedBy.includes(this.state.currentUser?.uid);
                            const likeCount = post.likes ? post.likes.length : 0;
                            const commentCount = post.comments ? post.comments.length : 0;
                            
                            // Determine post content based on media type
                            let mediaContent = '';
                            if (post.mediaType === 'image') {
                                mediaContent = `<img src="${post.mediaUrl}" alt="Post image" class="post-image">`;
                            } else if (post.mediaType === 'video') {
                                mediaContent = `<video controls class="post-image"><source src="${post.mediaUrl}" type="video/mp4"></video>`;
                            } else if (post.mediaType === 'voice') {
                                mediaContent = `
                                    <div class="voice-note">
                                        <div class="voice-player">
                                            <div class="voice-controls">
                                                <div class="play-btn" id="voicePlayBtn-${post.id}">
                                                    <i class="fas fa-play"></i>
                                                </div>
                                                <div class="voice-progress" id="voiceProgress-${post.id}">
                                                    <div class="voice-progress-bar" id="voiceProgressBar-${post.id}"></div>
                                                </div>
                                                <div class="voice-time">
                                                    <span id="voiceCurrentTime-${post.id}">00:00</span>
                                                    <span id="voiceDurationDisplay-${post.id}">${post.voiceDuration || '1:25'}</span>
                                                </div>
                                            </div>
                                            <div class="voice-actions">
                                                <button class="voice-action-btn" id="voiceRewindBtn-${post.id}" title="Rewind 10s">
                                                    <i class="fas fa-backward"></i>
                                                </button>
                                                <button class="voice-action-btn" id="voiceForwardBtn-${post.id}" title="Forward 10s">
                                                    <i class="fas fa-forward"></i>
                                                </button>
                                                <button class="voice-action-btn" id="voiceSpeedBtn-${post.id}" title="Change Speed">
                                                    1x
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <audio id="audio-${post.id}" src="${post.mediaUrl}" style="display: none;"></audio>
                                `;
                            }
                            
                            return `
                            <div class="post" data-post-id="${post.id}">
                                <div class="post-header">
                                    ${post.authorProfilePicture ? 
                                        `<div class="post-avatar"><img src="${post.authorProfilePicture}" alt="${post.authorName}"></div>` :
                                        `<div class="post-avatar">${post.authorName ? post.authorName.charAt(0).toUpperCase() : 'U'}</div>`
                                    }
                                    <div class="post-user-info">
                                        <h4>${post.authorName || 'Unknown User'} ${post.verified ? '<i class="fas fa-check-circle verified-badge"></i>' : ''}</h4>
                                        <p><i class="far fa-clock"></i> ${this.formatTime(post.createdAt)}</p>
                                    </div>
                                </div>
                                <div class="post-content">
                                    <p class="post-text">${post.content || ''}</p>
                                    ${mediaContent}
                                </div>
                                <div class="post-stats">
                                    <span><i class="fas fa-thumbs-up"></i> ${likeCount} likes</span>
                                    <span><i class="fas fa-comment"></i> ${commentCount} comments</span>
                                    <span><i class="fas fa-share"></i> ${post.shares || 0} shares</span>
                                </div>
                                <div class="post-actions-bar">
                                    <div class="post-action-btn like-btn ${isLiked ? 'active' : ''}" data-post-id="${post.id}">
                                        <i class="${isLiked ? 'fas' : 'far'} fa-thumbs-up"></i>
                                        <span>${isLiked ? 'Liked' : 'Like'}</span>
                                    </div>
                                    <div class="post-action-btn comment-btn" data-post-id="${post.id}">
                                        <i class="far fa-comment"></i>
                                        <span>Comment</span>
                                    </div>
                                    <div class="post-action-btn share-btn" data-post-id="${post.id}">
                                        <i class="fas fa-share"></i>
                                        <span>Share</span>
                                    </div>
                                </div>
                            </div>
                        `}).join('');
                        
                        // Add event listeners to liked posts
                        this.addOtherUserPostEventListeners();
                        
                        // Setup voice players for posts with voice notes
                        likedPosts.forEach(post => {
                            if (post.mediaType === 'voice') {
                                this.setupPostVoicePlayer(post.id);
                            }
                        });
                    }
                } catch (error) {
                    console.error('Error loading user likes:', error);
                }
            }

            addUserPostEventListeners() {
                // Like buttons
                this.elements.userPosts.querySelectorAll('.like-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = btn.getAttribute('data-post-id');
                        this.handleLikePost(postId, btn);
                    });
                });

                // Comment buttons
                this.elements.userPosts.querySelectorAll('.comment-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = btn.getAttribute('data-post-id');
                        this.toggleComments(postId);
                    });
                });

                // Share buttons
                this.elements.userPosts.querySelectorAll('.share-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = btn.getAttribute('data-post-id');
                        this.handleSharePost(postId);
                    });
                });

                // Post options menu
                this.elements.userPosts.querySelectorAll('.post-options').forEach(options => {
                    options.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const menu = options.querySelector('.post-menu');
                        if (menu) {
                            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
                        }
                    });
                });

                // Delete post
                this.elements.userPosts.querySelectorAll('.delete-post').forEach(deleteBtn => {
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const postId = deleteBtn.getAttribute('data-post-id');
                        this.deletePost(postId);
                    });
                });

                // Close menus when clicking elsewhere
                document.addEventListener('click', () => {
                    this.elements.userPosts.querySelectorAll('.post-menu').forEach(menu => {
                        menu.style.display = 'none';
                    });
                });
            }

            addOtherUserPostEventListeners() {
                // Like buttons
                this.elements.userPosts.querySelectorAll('.like-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = btn.getAttribute('data-post-id');
                        this.handleLikePost(postId, btn);
                    });
                });

                // Comment buttons
                this.elements.userPosts.querySelectorAll('.comment-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = btn.getAttribute('data-post-id');
                        this.toggleComments(postId);
                    });
                });

                // Share buttons
                this.elements.userPosts.querySelectorAll('.share-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = btn.getAttribute('data-post-id');
                        this.handleSharePost(postId);
                    });
                });
            }

            setupPostVoicePlayer(postId) {
                const audioElement = document.getElementById(`audio-${postId}`);
                const playBtn = document.getElementById(`voicePlayBtn-${postId}`);
                const progress = document.getElementById(`voiceProgress-${postId}`);
                const progressBar = document.getElementById(`voiceProgressBar-${postId}`);
                const currentTime = document.getElementById(`voiceCurrentTime-${postId}`);
                const durationDisplay = document.getElementById(`voiceDurationDisplay-${postId}`);
                const rewindBtn = document.getElementById(`voiceRewindBtn-${postId}`);
                const forwardBtn = document.getElementById(`voiceForwardBtn-${postId}`);
                const speedBtn = document.getElementById(`voiceSpeedBtn-${postId}`);
                
                let playbackRates = [0.5, 0.75, 1, 1.25, 1.5, 2];
                let currentRateIndex = 2; // Start at 1x
                
                // Update duration display
                audioElement.addEventListener('loadedmetadata', () => {
                    durationDisplay.textContent = this.formatTime(audioElement.duration);
                });
                
                // Play/pause functionality
                playBtn.addEventListener('click', () => {
                    if (audioElement.paused) {
                        audioElement.play();
                        playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    } else {
                        audioElement.pause();
                        playBtn.innerHTML = '<i class="fas fa-play"></i>';
                    }
                });
                
                // Update progress bar
                audioElement.addEventListener('timeupdate', () => {
                    const percent = (audioElement.currentTime / audioElement.duration) * 100;
                    progressBar.style.width = `${percent}%`;
                    currentTime.textContent = this.formatTime(audioElement.currentTime);
                });
                
                // Seek functionality
                progress.addEventListener('click', (e) => {
                    const rect = progress.getBoundingClientRect();
                    const percent = (e.clientX - rect.left) / rect.width;
                    audioElement.currentTime = percent * audioElement.duration;
                });
                
                // Rewind 10 seconds
                rewindBtn.addEventListener('click', () => {
                    audioElement.currentTime = Math.max(0, audioElement.currentTime - 10);
                });
                
                // Forward 10 seconds
                forwardBtn.addEventListener('click', () => {
                    audioElement.currentTime = Math.min(audioElement.duration, audioElement.currentTime + 10);
                });
                
                // Change playback speed
                speedBtn.addEventListener('click', () => {
                    currentRateIndex = (currentRateIndex + 1) % playbackRates.length;
                    const newRate = playbackRates[currentRateIndex];
                    audioElement.playbackRate = newRate;
                    speedBtn.textContent = `${newRate}x`;
                });
                
                // Reset play button when audio ends
                audioElement.addEventListener('ended', () => {
                    playBtn.innerHTML = '<i class="fas fa-play"></i>';
                });
            }

            // Post Interaction Methods
            async handleLikePost(postId, button) {
                if (!this.state.isLoggedIn) {
                    alert('Please login to like posts');
                    return;
                }

                const isLiked = button.classList.contains('active');
                const icon = button.querySelector('i');
                const span = button.querySelector('span');
                const postRef = firebase.firestore().collection('posts').doc(postId);
                
                try {
                    if (!isLiked) {
                        // Add like
                        await postRef.update({
                            likes: firebase.firestore.FieldValue.arrayUnion(this.state.currentUser.uid),
                            likedBy: firebase.firestore.FieldValue.arrayUnion(this.state.currentUser.uid)
                        });
                        
                        // Add to user's liked posts
                        await firebase.firestore().collection('users').doc(this.state.currentUser.uid).update({
                            likedPosts: firebase.firestore.FieldValue.arrayUnion(postId)
                        });
                        
                        button.classList.add('active');
                        icon.classList.remove('far');
                        icon.classList.add('fas');
                        span.textContent = 'Liked';
                    } else {
                        // Remove like
                        await postRef.update({
                            likes: firebase.firestore.FieldValue.arrayRemove(this.state.currentUser.uid),
                            likedBy: firebase.firestore.FieldValue.arrayRemove(this.state.currentUser.uid)
                        });
                        
                        // Remove from user's liked posts
                        await firebase.firestore().collection('users').doc(this.state.currentUser.uid).update({
                            likedPosts: firebase.firestore.FieldValue.arrayRemove(postId)
                        });
                        
                        button.classList.remove('active');
                        icon.classList.remove('fas');
                        icon.classList.add('far');
                        span.textContent = 'Like';
                    }
                } catch (error) {
                    console.error('Error toggling like:', error);
                    alert('Failed to update like');
                }
            }

            async toggleComments(postId) {
                const commentsSection = document.getElementById(`comments-${postId}`);
                
                if (!commentsSection) {
                    // Create comments section if it doesn't exist
                    const postElement = document.querySelector(`[data-post-id="${postId}"]`);
                    const commentsHTML = `
                        <div class="comments-section" id="comments-${postId}">
                            <div style="text-align: center; padding: 20px; color: var(--gray-color);">
                                <div class="loading"></div>
                                <p>Loading comments...</p>
                            </div>
                        </div>
                    `;
                    postElement.insertAdjacentHTML('beforeend', commentsHTML);
                    
                    await this.loadComments(postId);
                } else if (commentsSection.style.display === 'none') {
                    commentsSection.style.display = 'block';
                } else {
                    commentsSection.style.display = 'none';
                }
            }

            async loadComments(postId) {
                try {
                    const postDoc = await firebase.firestore().collection('posts').doc(postId).get();
                    const postData = postDoc.data();
                    const comments = postData.comments || [];
                    
                    this.renderComments(postId, comments);
                } catch (error) {
                    console.error('Error loading comments:', error);
                }
            }

            renderComments(postId, comments) {
                const commentsSection = document.getElementById(`comments-${postId}`);
                
                commentsSection.innerHTML = `
                    ${comments && comments.length > 0 ? comments.map(comment => `
                        <div class="comment">
                            <div class="comment-avatar">${comment.authorName ? comment.authorName.charAt(0).toUpperCase() : 'U'}</div>
                            <div class="comment-content">
                                <div class="comment-header">
                                    <div class="comment-author">${comment.authorName || 'Unknown User'}</div>
                                    <div class="comment-time"><i class="far fa-clock"></i> ${this.formatTime(comment.createdAt)}</div>
                                </div>
                                <div class="comment-text">${comment.content}</div>
                            </div>
                        </div>
                    `).join('') : '<p style="text-align: center; color: var(--gray-color); padding: 10px 0;">No comments yet</p>'}
                    <div class="add-comment">
                        <input type="text" class="comment-input" placeholder="Write a comment..." data-post-id="${postId}">
                        <button class="send-comment" data-post-id="${postId}">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                `;

                // Add event listeners to comment buttons
                commentsSection.querySelectorAll('.send-comment').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const postId = btn.getAttribute('data-post-id');
                        const input = commentsSection.querySelector('.comment-input');
                        this.addComment(postId, input.value);
                        input.value = '';
                    });
                });

                commentsSection.querySelectorAll('.comment-input').forEach(input => {
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            const postId = input.getAttribute('data-post-id');
                            this.addComment(postId, input.value);
                            input.value = '';
                        }
                    });
                });
            }

            async addComment(postId, content) {
                if (!content.trim() || !this.state.isLoggedIn) return;

                try {
                    const comment = {
                        id: Date.now().toString(),
                        authorId: this.state.currentUser.uid,
                        authorName: this.state.userProfile.name,
                        content: content,
                        createdAt: new Date().toISOString()
                    };

                    // Add comment to post
                    await firebase.firestore().collection('posts').doc(postId).update({
                        comments: firebase.firestore.FieldValue.arrayUnion(comment)
                    });

                    alert('Comment added successfully');
                    this.loadComments(postId);
                } catch (error) {
                    console.error('Error adding comment:', error);
                    alert('Failed to add comment');
                }
            }

            async deletePost(postId) {
                if (!confirm('Are you sure you want to delete this post?')) return;

                try {
                    // Delete post from Firestore
                    await firebase.firestore().collection('posts').doc(postId).delete();
                    
                    // Remove post from user's posts array
                    await firebase.firestore().collection('users').doc(this.state.currentUser.uid).update({
                        posts: firebase.firestore.FieldValue.arrayRemove(postId)
                    });

                    alert('Post deleted successfully');
                    // Reload posts
                    this.loadUserPosts();
                } catch (error) {
                    console.error('Error deleting post:', error);
                    alert('Failed to delete post');
                }
            }

            async handleSharePost(postId) {
                if (!this.state.isLoggedIn) {
                    alert('Please login to share posts');
                    return;
                }

                try {
                    // Update share count
                    await firebase.firestore().collection('posts').doc(postId).update({
                        shares: firebase.firestore.FieldValue.increment(1)
                    });

                    alert('Post shared successfully');
                } catch (error) {
                    console.error('Error sharing post:', error);
                    alert('Failed to share post');
                }
            }

            async handleFollowUser(userId, button) {
                if (!this.state.isLoggedIn) {
                    alert('Please login to follow users');
                    return;
                }

                const isFollowing = button.textContent.includes('Following');
                
                try {
                    if (!isFollowing) {
                        // Add to current user's following
                        await firebase.firestore()
                            .collection('users')
                            .doc(this.state.currentUser.uid)
                            .update({
                                following: firebase.firestore.FieldValue.arrayUnion(userId)
                            });
                        
                        // Add to target user's followers
                        await firebase.firestore()
                            .collection('users')
                            .doc(userId)
                            .update({
                                followers: firebase.firestore.FieldValue.arrayUnion(this.state.currentUser.uid)
                            });
                        
                        button.innerHTML = '<i class="fas fa-user-check"></i> Following';
                        button.classList.add('following');
                        
                        // Update followers count
                        this.elements.followersCount.textContent = parseInt(this.elements.followersCount.textContent) + 1;
                        
                        alert('You are now following this user');
                    } else {
                        // Remove from current user's following
                        await firebase.firestore()
                            .collection('users')
                            .doc(this.state.currentUser.uid)
                            .update({
                                following: firebase.firestore.FieldValue.arrayRemove(userId)
                            });
                        
                        // Remove from target user's followers
                        await firebase.firestore()
                            .collection('users')
                            .doc(userId)
                            .update({
                                followers: firebase.firestore.FieldValue.arrayRemove(this.state.currentUser.uid)
                            });
                        
                        button.innerHTML = '<i class="fas fa-user-plus"></i> Follow';
                        button.classList.remove('following');
                        
                        // Update followers count
                        this.elements.followersCount.textContent = parseInt(this.elements.followersCount.textContent) - 1;
                        
                        alert('You have unfollowed this user');
                    }
                } catch (error) {
                    console.error('Error following/unfollowing user:', error);
                    alert('Failed to follow user');
                }
            }

            messageUser(userId) {
                // Redirect to messages page with the user
                window.location.href = `message.html?user=${userId}`;
            }

            // Edit Profile Methods
            showEditProfileModal() {
                if (!this.state.userProfile) return;

                // Populate form with current data
                this.elements.editFullName.value = this.state.userProfile.name || '';
                this.elements.editUsername.value = this.state.userProfile.username || '';
                this.elements.editGender.value = this.state.userProfile.gender || '';
                this.elements.editBio.value = this.state.userProfile.bio || '';
                
                // Update character count
                this.updateBioCharCount();
                
                // Update username change info
                this.updateUsernameChangeInfo();
                
                // Update profile picture preview
                if (this.state.userProfile.profilePicture) {
                    this.elements.profilePictureImg.src = this.state.userProfile.profilePicture;
                    this.elements.profilePictureImg.style.display = 'block';
                    this.elements.profileInitials.style.display = 'none';
                } else {
                    const initials = this.state.userProfile.name.split(' ').map(n => n[0]).join('').toUpperCase();
                    this.elements.profileInitials.textContent = initials;
                    this.elements.profileInitials.style.display = 'flex';
                    this.elements.profilePictureImg.style.display = 'none';
                }
                
                // Show modal
                this.elements.editProfileModal.classList.add('active');
            }

            hideEditProfileModal() {
                this.elements.editProfileModal.classList.remove('active');
            }

            updateBioCharCount() {
                const bio = this.elements.editBio.value;
                const charCount = bio.length;
                this.elements.bioCharCount.textContent = charCount;
            }

            updateUsernameChangeInfo() {
                if (!this.state.userProfile) return;

                const changesLeft = 2 - (this.state.userProfile.usernameChanges || 0);
                
                if (changesLeft <= 0) {
                    this.elements.usernameChangeInfo.innerHTML = `<i class="fas fa-exclamation-triangle"></i> You've used all your username changes for this period`;
                    this.elements.usernameChangeInfo.style.backgroundColor = 'rgba(247, 37, 133, 0.1)';
                    this.elements.usernameChangeInfo.style.color = 'var(--warning-color)';
                } else {
                    this.elements.usernameChangeInfo.innerHTML = `<i class="fas fa-info-circle"></i> You have ${changesLeft} username change${changesLeft === 1 ? '' : 's'} left`;
                }
            }

            handleProfilePictureChange(e) {
                const file = e.target.files[0];
                if (file) {
                    this.previewProfilePicture(file);
                }
            }

            previewProfilePicture(file) {
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file');
                    return;
                }

                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    alert('Image size must be less than 5MB');
                    return;
                }

                this.state.profilePictureFile = file;

                const reader = new FileReader();
                reader.onload = (e) => {
                    this.elements.profilePictureImg.src = e.target.result;
                    this.elements.profilePictureImg.style.display = 'block';
                    this.elements.profileInitials.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }

            async handleSaveProfile(e) {
                e.preventDefault();
                
                if (!this.state.currentUser) return;

                const fullName = this.elements.editFullName.value.trim();
                const username = this.elements.editUsername.value.trim();
                const gender = this.elements.editGender.value;
                const bio = this.elements.editBio.value.trim();

                if (!fullName || !username) {
                    alert('Name and username are required');
                    return;
                }

                try {
                    const updates = {
                        name: fullName,
                        bio: bio,
                        gender: gender
                    };

                    // Check if username changed
                    if (username !== this.state.userProfile.username) {
                        const canChange = await this.canChangeUsername();
                        if (!canChange) {
                            alert('You cannot change your username at this time');
                            return;
                        }

                        updates.username = username;
                        updates.usernameChanges = (this.state.userProfile.usernameChanges || 0) + 1;
                        updates.lastUsernameChange = new Date().toISOString();
                    }

                    // Upload profile picture if changed
                    if (this.state.profilePictureFile) {
                        const imageRef = firebase.storage().ref().child(`profiles/${this.state.currentUser.uid}/profile.jpg`);
                        await imageRef.put(this.state.profilePictureFile);
                        const imageUrl = await imageRef.getDownloadURL();
                        updates.profilePicture = imageUrl;
                    }

                    // Update Firestore
                    await firebase.firestore().collection('users').doc(this.state.currentUser.uid).update(updates);

                    // Update auth profile
                    await this.state.currentUser.updateProfile({
                        displayName: fullName,
                        photoURL: updates.profilePicture || this.state.currentUser.photoURL
                    });

                    // Reload user profile
                    await this.loadUserProfile();
                    await this.loadUserProfilePage();

                    alert('Profile updated successfully');
                    this.hideEditProfileModal();
                } catch (error) {
                    console.error('Error updating profile:', error);
                    alert('Failed to update profile');
                }
            }

            async canChangeUsername() {
                if (!this.state.userProfile) return false;

                const changesUsed = this.state.userProfile.usernameChanges || 0;
                const lastChange = this.state.userProfile.lastUsernameChange;

                // Check if user has changes left
                if (changesUsed >= 2) { // 2 changes allowed
                    return false;
                }

                // If no previous changes, allow
                if (!lastChange) return true;

                // Check if 6 months have passed since last change
                const lastChangeDate = new Date(lastChange);
                const sixMonthsAgo = new Date();
                sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);

                return lastChangeDate <= sixMonthsAgo;
            }

            // Tab Navigation
            switchTab(tabName) {
                // Update active tab
                this.elements.tabs.forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');

                // Show active tab content
                this.elements.tabContents.forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabName}Tab`).classList.add('active');

                // Load tab-specific data
                if (tabName === 'posts') {
                    if (this.state.isOwnProfile) {
                        this.loadUserPosts();
                    } else {
                        this.loadOtherUserPosts(this.state.viewingUserId);
                    }
                } else if (tabName === 'media') {
                    this.loadUserMedia();
                } else if (tabName === 'likes') {
                    this.loadUserLikes();
                }
            }

            // Utility Methods
            formatTime(timestamp) {
                if (!timestamp) return 'Just now';
                
                const now = new Date();
                const postTime = new Date(timestamp);
                const diff = now - postTime;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(diff / 3600000);
                const days = Math.floor(diff / 86400000);

                if (days > 0) return `${days}d ago`;
                if (hours > 0) return `${hours}h ago`;
                if (minutes > 0) return `${minutes}m ago`;
                return 'Just now';
            }

            loadTheme() {
                const savedTheme = localStorage.getItem('theme') || 'light';
                
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-mode');
                    this.elements.themeToggleSidebar.querySelector('i').classList.remove('fa-moon');
                    this.elements.themeToggleSidebar.querySelector('i').classList.add('fa-sun');
                    this.elements.themeToggleSidebar.querySelector('span').textContent = 'Light Mode';
                }
            }

            updateProfileUI() {
                // Update UI with current user profile data
                if (this.state.userProfile) {
                    this.elements.userName.textContent = this.state.userProfile.name;
                    this.elements.userHandle.textContent = `@${this.state.userProfile.username}`;
                    
                    // Update avatar
                    if (this.state.userProfile.profilePicture) {
                        this.elements.userAvatar.innerHTML = `<img src="${this.state.userProfile.profilePicture}" alt="Profile Picture">`;
                    } else {
                        const initials = this.state.userProfile.name.split(' ').map(n => n[0]).join('').toUpperCase();
                        this.elements.userAvatar.textContent = initials;
                        this.elements.userAvatar.style.display = 'flex';
                        this.elements.userAvatar.style.alignItems = 'center';
                        this.elements.userAvatar.style.justifyContent = 'center';
                    }
                }
            }
        }

        // Initialize the profile page when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.connectXProfile = new ConnectXProfile();
        });
    </script>
</body>
</html>