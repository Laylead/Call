<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Camsilo - Adult Entertainment Platform</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  /* CSS variables and base styles */
  :root {
    --bg: #031226; --panel: #071427; --muted: #9aa2b2;
    --accent1: #ff6f2d; --accent2: #ff4b98; --danger: #e02323;
    --success: #2dd4bf; --warning: #f59e0b;
    --radius: 16px; --radius-sm: 8px;
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --shadow: 0 10px 25px rgba(0,0,0,0.3);
    --shadow-lg: 0 20px 50px rgba(0,0,0,0.5);
  }
  
  * { box-sizing: border-box; font-family: Inter, system-ui, Arial; margin: 0; padding: 0; }
  body { margin: 0; background: linear-gradient(180deg, var(--bg), #021020); color: #eaf2ff; min-height: 100vh; overflow-x: hidden; }
  
  /* App layout */
  #app {
    display: flex;
    min-height: 100vh;
  }
  
  /* Sidebar */
  .sidebar {
    width: 260px;
    background: var(--panel);
    border-right: 1px solid rgba(255,255,255,0.05);
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease;
    z-index: 100;
    position: fixed;
    height: 100vh;
    overflow-y: auto;
  }
  
  .sidebar-header {
    padding: 20px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    text-align: center;
  }
  
  .sidebar-logo {
    font-size: 24px;
    font-weight: 800;
    background: linear-gradient(90deg, var(--accent1), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  
  .sidebar-nav {
    flex: 1;
    padding: 20px 0;
  }
  
  .nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 20px;
    color: var(--muted);
    text-decoration: none;
    transition: var(--transition);
    border-left: 3px solid transparent;
  }
  
  .nav-item.active, .nav-item:hover {
    background: rgba(255,255,255,0.05);
    color: white;
    border-left-color: var(--accent1);
  }
  
  .nav-item i {
    font-size: 18px;
    width: 24px;
    text-align: center;
  }
  
  /* Main content area */
  .main-content {
    flex: 1;
    margin-left: 260px;
    transition: margin-left 0.3s ease;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  
  /* Top header */
  .top-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px 24px;
    background: rgba(7, 20, 39, 0.8);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255,255,255,0.05);
    z-index: 90;
    position: sticky;
    top: 0;
  }
  
  .header-title {
    font-weight: 800;
    font-size: 20px;
  }
  
  .header-actions {
    display: flex;
    align-items: center;
    gap: 16px;
  }
  
  /* Wallet balance */
  .wallet-balance {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255,255,255,0.05);
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: 600;
  }
  
  .wallet-balance i {
    color: var(--success);
  }
  
  /* Stories section */
  .stories-container {
    padding: 16px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    overflow-x: auto;
    white-space: nowrap;
    background: rgba(7, 20, 39, 0.5);
  }
  
  .stories-scroll {
    display: inline-flex;
    gap: 16px;
  }
  
  .story-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    transition: var(--transition);
  }
  
  .story-avatar {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background: linear-gradient(45deg, var(--accent1), var(--accent2));
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    position: relative;
    margin-bottom: 8px;
  }
  
  .story-live {
    position: absolute;
    bottom: -4px;
    right: -4px;
    background: var(--danger);
    color: white;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 10px;
    font-weight: 700;
  }
  
  .story-name {
    font-size: 12px;
    max-width: 70px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  
  /* Page container */
  .page-container {
    flex: 1;
    overflow: hidden;
    position: relative;
  }
  
  .page {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    padding: 20px;
    overflow-y: auto;
    transition: transform 0.4s ease;
  }
  
  .page.hidden {
    transform: translateX(100%);
  }
  
  .page.active {
    transform: translateX(0);
  }
  
  .page.left {
    transform: translateX(-100%);
  }
  
  /* Models grid */
  .models-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }
  
  .model-card {
    background: var(--panel);
    border-radius: var(--radius);
    overflow: hidden;
    transition: var(--transition);
    cursor: pointer;
  }
  
  .model-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow);
  }
  
  .model-image {
    width: 100%;
    height: 250px;
    object-fit: cover;
  }
  
  .model-info {
    padding: 16px;
  }
  
  .model-name {
    font-weight: 700;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  
  .verified-badge {
    color: var(--success);
  }
  
  .model-stats {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--muted);
  }
  
  /* Reels container */
  .reels-container {
    height: 100%;
    position: relative;
    overflow: hidden;
  }
  
  .reel {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.5s ease;
  }
  
  .reel-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .reel-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 20px;
    background: linear-gradient(transparent, rgba(0,0,0,0.7));
    color: white;
  }
  
  .reel-actions {
    position: absolute;
    right: 20px;
    bottom: 100px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    align-items: center;
  }
  
  .action-button {
    background: rgba(0,0,0,0.5);
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: var(--transition);
  }
  
  .action-button:hover {
    background: rgba(0,0,0,0.7);
    transform: scale(1.1);
  }
  
  /* Model profile */
  .profile-header {
    display: flex;
    gap: 20px;
    margin-bottom: 30px;
    background: var(--panel);
    padding: 20px;
    border-radius: var(--radius);
  }
  
  .profile-avatar {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid var(--accent1);
  }
  
  .profile-info {
    flex: 1;
  }
  
  .profile-name {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  
  .profile-bio {
    color: var(--muted);
    margin-bottom: 16px;
    line-height: 1.5;
  }
  
  .profile-stats {
    display: flex;
    gap: 20px;
  }
  
  .stat {
    text-align: center;
  }
  
  .stat-value {
    font-weight: 700;
    font-size: 18px;
  }
  
  .stat-label {
    font-size: 12px;
    color: var(--muted);
  }
  
  .profile-actions {
    display: flex;
    gap: 12px;
    margin-top: 16px;
  }
  
  /* Posts grid */
  .posts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
  }
  
  .post-card {
    background: var(--panel);
    border-radius: var(--radius);
    overflow: hidden;
    transition: var(--transition);
  }
  
  .post-media {
    width: 100%;
    height: 300px;
    object-fit: cover;
  }
  
  .post-locked {
    filter: blur(10px);
    position: relative;
  }
  
  .lock-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 12px;
    color: white;
  }
  
  .lock-icon {
    font-size: 40px;
  }
  
  .post-info {
    padding: 16px;
  }
  
  .post-caption {
    margin-bottom: 12px;
    line-height: 1.4;
  }
  
  .post-meta {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--muted);
  }
  
  /* Wallet page */
  .wallet-container {
    max-width: 600px;
    margin: 0 auto;
  }
  
  .wallet-card {
    background: var(--panel);
    border-radius: var(--radius);
    padding: 24px;
    margin-bottom: 20px;
  }
  
  .wallet-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  
  .wallet-balance-large {
    font-size: 32px;
    font-weight: 700;
    color: var(--success);
  }
  
  .payment-methods {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 16px;
    margin-top: 20px;
  }
  
  .payment-method {
    background: rgba(255,255,255,0.05);
    border-radius: var(--radius-sm);
    padding: 16px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
  }
  
  .payment-method:hover {
    background: rgba(255,255,255,0.1);
  }
  
  .payment-icon {
    font-size: 24px;
    margin-bottom: 8px;
  }
  
  /* Admin panel */
  .admin-panel {
    background: var(--panel);
    border-radius: var(--radius);
    padding: 24px;
    margin-top: 20px;
  }
  
  .admin-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    border-bottom: 1px solid rgba(255,255,255,0.05);
  }
  
  .admin-tab {
    padding: 12px 20px;
    background: transparent;
    border: none;
    color: var(--muted);
    cursor: pointer;
    transition: var(--transition);
    border-bottom: 2px solid transparent;
  }
  
  .admin-tab.active {
    color: white;
    border-bottom-color: var(--accent1);
  }
  
  .admin-content {
    display: none;
  }
  
  .admin-content.active {
    display: block;
  }
  
  .form-group {
    margin-bottom: 16px;
  }
  
  .form-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
  }
  
  .form-input {
    width: 100%;
    padding: 12px 16px;
    border-radius: var(--radius-sm);
    border: 1px solid rgba(255,255,255,0.06);
    background: rgba(255,255,255,0.05);
    color: inherit;
    transition: var(--transition);
  }
  
  .form-input:focus {
    outline: none;
    border-color: rgba(255,111,45,0.4);
    background: rgba(255,255,255,0.08);
  }
  
  .btn {
    background: linear-gradient(45deg, var(--accent1), var(--accent2));
    padding: 12px 20px;
    border-radius: var(--radius-sm);
    border: none;
    color: white;
    cursor: pointer;
    font-weight: 600;
    transition: var(--transition);
  }
  
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(255,111,45,0.3);
  }
  
  .btn-secondary {
    background: rgba(255,255,255,0.1);
  }
  
  .btn-secondary:hover {
    background: rgba(255,255,255,0.15);
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .sidebar {
      transform: translateX(-100%);
      width: 280px;
    }
    
    .sidebar.open {
      transform: translateX(0);
    }
    
    .main-content {
      margin-left: 0;
    }
    
    .menu-toggle {
      display: block;
    }
    
    .models-grid {
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    }
    
    .profile-header {
      flex-direction: column;
      text-align: center;
    }
    
    .profile-stats {
      justify-content: center;
    }
  }
  
  .menu-toggle {
    display: none;
    background: transparent;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
  }
  
  /* Swipe indicators */
  .swipe-indicator {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0,0,0,0.5);
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .swipe-left {
    left: 10px;
  }
  
  .swipe-right {
    right: 10px;
  }
  
  .swipe-visible {
    opacity: 1;
  }
</style>
</head>
<body>
<div id="app">
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo">CAMSILO</div>
    </div>
    <div class="sidebar-nav">
      <a href="#" class="nav-item active" data-page="home">
        <i>üè†</i> Home
      </a>
      <a href="#" class="nav-item" data-page="models">
        <i>üë©</i> Models
      </a>
      <a href="#" class="nav-item" data-page="reels">
        <i>üé¨</i> Reels
      </a>
      <a href="#" class="nav-item" data-page="wallet">
        <i>üí∞</i> Wallet
      </a>
      <a href="#" class="nav-item" data-page="chat">
        <i>üí¨</i> Chat
      </a>
      <a href="#" class="nav-item" data-page="admin" id="adminNav" style="display: none;">
        <i>‚öôÔ∏è</i> Admin
      </a>
    </div>
    <div style="padding: 20px; border-top: 1px solid rgba(255,255,255,0.05);">
      <button id="logoutBtn" class="btn btn-secondary" style="width: 100%;">Logout</button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Top Header -->
    <div class="top-header">
      <button class="menu-toggle" id="menuToggle">‚ò∞</button>
      <div class="header-title" id="pageTitle">Camsilo Models</div>
      <div class="header-actions">
        <div class="wallet-balance" id="walletBalance">
          <i>üí∞</i> <span id="balanceAmount">0</span> credits
        </div>
        <div id="userInfo" class="small">Not signed in</div>
        <button id="loginBtn" class="btn">Login</button>
      </div>
    </div>

    <!-- Stories Section -->
    <div class="stories-container" id="storiesContainer">
      <div class="stories-scroll" id="storiesScroll">
        <!-- Stories will be populated here -->
      </div>
    </div>

    <!-- Page Container -->
    <div class="page-container">
      <!-- Home Page -->
      <div class="page active" id="homePage">
        <h2>Welcome to Camsilo</h2>
        <p>Discover amazing models and exclusive content</p>
        
        <div class="models-grid" id="featuredModels">
          <!-- Featured models will be populated here -->
        </div>
      </div>

      <!-- Models Page -->
      <div class="page hidden" id="modelsPage">
        <h2>All Models</h2>
        <div class="models-grid" id="allModels">
          <!-- All models will be populated here -->
        </div>
      </div>

      <!-- Reels Page -->
      <div class="page hidden" id="reelsPage">
        <div class="reels-container" id="reelsContainer">
          <!-- Reels will be populated here -->
        </div>
      </div>

      <!-- Wallet Page -->
      <div class="page hidden" id="walletPage">
        <div class="wallet-container">
          <div class="wallet-card">
            <div class="wallet-header">
              <h3>Your Wallet</h3>
              <div class="wallet-balance-large" id="walletBalanceLarge">0 credits</div>
            </div>
            <p>Add credits to unlock exclusive content and tip your favorite models</p>
            
            <div class="form-group">
              <label class="form-label">Add Credits</label>
              <input type="number" class="form-input" id="creditAmount" placeholder="Enter amount" min="10">
            </div>
            
            <button class="btn" id="addCreditsBtn" style="width: 100%;">Add Credits</button>
            
            <h4 style="margin-top: 30px; margin-bottom: 16px;">Payment Methods</h4>
            <div class="payment-methods" id="paymentMethods">
              <!-- Payment methods will be populated here -->
            </div>
          </div>
          
          <div class="wallet-card">
            <h3>Transaction History</h3>
            <div id="transactionHistory">
              <!-- Transactions will be populated here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Chat Page -->
      <div class="page hidden" id="chatPage">
        <!-- Chat interface will be loaded here -->
        <div id="chatContainer"></div>
      </div>

      <!-- Admin Page -->
      <div class="page hidden" id="adminPage">
        <h2>Admin Panel</h2>
        
        <div class="admin-tabs">
          <button class="admin-tab active" data-tab="models">Manage Models</button>
          <button class="admin-tab" data-tab="content">Manage Content</button>
          <button class="admin-tab" data-tab="stories">Manage Stories</button>
          <button class="admin-tab" data-tab="payments">Payment Links</button>
        </div>
        
        <div class="admin-content active" id="adminModels">
          <h3>Manage Models</h3>
          <!-- Model management interface -->
        </div>
        
        <div class="admin-content" id="adminContent">
          <h3>Manage Content</h3>
          <!-- Content management interface -->
        </div>
        
        <div class="admin-content" id="adminStories">
          <h3>Manage Stories</h3>
          <!-- Story management interface -->
        </div>
        
        <div class="admin-content" id="adminPayments">
          <h3>Payment Links</h3>
          <!-- Payment links management -->
        </div>
      </div>

      <!-- Model Profile Page -->
      <div class="page hidden" id="modelProfilePage">
        <!-- Model profile will be loaded here -->
      </div>
    </div>
  </div>
</div>

<!-- Swipe Indicators -->
<div class="swipe-indicator swipe-left">‚Üê</div>
<div class="swipe-indicator swipe-right">‚Üí</div>

<!-- Login Modal -->
<div id="loginModal" class="modal">
  <!-- Login modal content -->
</div>

<!-- Story Viewer Modal -->
<div id="storyModal" class="modal">
  <!-- Story viewer content -->
</div>

<!-- Unlock Content Modal -->
<div id="unlockModal" class="modal">
  <!-- Unlock content modal -->
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<!-- External Config -->
<script src="configuration.js"></script>
<!-- Continue from Part 1 -->
<style>
  /* Modal styles */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 20px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  .modal.open {
    display: flex;
    opacity: 1;
  }
  
  .modal-content {
    background: var(--panel);
    border-radius: var(--radius);
    padding: 24px;
    width: 100%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    transform: translateY(20px);
    transition: transform 0.3s ease;
  }
  
  .modal.open .modal-content {
    transform: translateY(0);
  }
  
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }
  
  .modal-title {
    font-weight: 700;
    font-size: 20px;
  }
  
  .modal-close {
    background: transparent;
    border: none;
    color: var(--muted);
    font-size: 24px;
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: var(--transition);
  }
  
  .modal-close:hover {
    color: white;
    background: rgba(255,255,255,0.05);
  }
  
  /* Login Modal */
  .login-form {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  
  .form-actions {
    display: flex;
    gap: 12px;
    margin-top: 20px;
  }
  
  .form-actions .btn {
    flex: 1;
  }
  
  /* Story Viewer */
  .story-viewer {
    position: relative;
    width: 100%;
    max-width: 400px;
    height: 600px;
    border-radius: var(--radius);
    overflow: hidden;
    background: black;
  }
  
  .story-progress {
    display: flex;
    gap: 4px;
    padding: 10px;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: 10;
  }
  
  .progress-bar {
    flex: 1;
    height: 3px;
    background: rgba(255,255,255,0.3);
    border-radius: 2px;
    overflow: hidden;
  }
  
  .progress-fill {
    height: 100%;
    background: white;
    width: 0%;
    transition: width 0.1s linear;
  }
  
  .story-media {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .story-actions {
    position: absolute;
    bottom: 20px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    gap: 20px;
    z-index: 10;
  }
  
  .story-action-btn {
    background: rgba(0,0,0,0.5);
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
    cursor: pointer;
    transition: var(--transition);
  }
  
  .story-action-btn:hover {
    background: rgba(0,0,0,0.7);
    transform: scale(1.1);
  }
  
  /* Unlock Modal */
  .unlock-preview {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: var(--radius-sm);
    margin-bottom: 16px;
    filter: blur(10px);
  }
  
  .unlock-cost {
    text-align: center;
    margin: 20px 0;
    font-size: 18px;
  }
  
  .unlock-cost span {
    color: var(--accent1);
    font-weight: 700;
  }
  
  /* Admin Form Styles */
  .admin-form {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
  
  .form-row {
    display: flex;
    gap: 16px;
  }
  
  .form-row .form-group {
    flex: 1;
  }
  
  .media-preview {
    width: 100%;
    max-height: 200px;
    object-fit: cover;
    border-radius: var(--radius-sm);
    margin-top: 8px;
    display: none;
  }
  
  .media-preview.visible {
    display: block;
  }
  
  .checkbox-group {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
  }
  
  .checkbox-group input[type="checkbox"] {
    width: 16px;
    height: 16px;
  }
  
  .content-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-top: 20px;
  }
  
  .content-item {
    display: flex;
    gap: 16px;
    padding: 16px;
    background: rgba(255,255,255,0.05);
    border-radius: var(--radius-sm);
    align-items: center;
  }
  
  .content-thumb {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: var(--radius-sm);
  }
  
  .content-info {
    flex: 1;
  }
  
  .content-title {
    font-weight: 600;
    margin-bottom: 4px;
  }
  
  .content-meta {
    font-size: 12px;
    color: var(--muted);
  }
  
  .content-actions {
    display: flex;
    gap: 8px;
  }
  
  .action-btn {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.1);
    color: inherit;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    transition: var(--transition);
    font-size: 12px;
  }
  
  .action-btn.edit {
    color: var(--success);
  }
  
  .action-btn.delete {
    color: var(--danger);
  }
  
  .action-btn:hover {
    background: rgba(255,255,255,0.05);
  }
  
  /* Model selection in admin */
  .model-select {
    width: 100%;
    padding: 12px 16px;
    border-radius: var(--radius-sm);
    border: 1px solid rgba(255,255,255,0.06);
    background: rgba(255,255,255,0.05);
    color: inherit;
  }
  
  /* Empty states */
  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--muted);
  }
  
  .empty-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
  }
  
  /* Loading states */
  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  /* Toast notifications */
  .toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--panel);
    border-radius: var(--radius-sm);
    padding: 12px 16px;
    box-shadow: var(--shadow);
    border-left: 4px solid var(--accent1);
    transform: translateX(100%);
    transition: transform 0.3s ease;
    z-index: 1000;
    max-width: 300px;
  }
  
  .toast.show {
    transform: translateX(0);
  }
  
  .toast.success {
    border-left-color: var(--success);
  }
  
  .toast.error {
    border-left-color: var(--danger);
  }
  
  .toast-message {
    font-weight: 500;
  }
  
  /* Tip modal */
  .tip-options {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin: 20px 0;
  }
  
  .tip-option {
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: var(--radius-sm);
    padding: 16px;
    text-align: center;
    cursor: pointer;
    transition: var(--transition);
  }
  
  .tip-option:hover, .tip-option.active {
    background: rgba(255,111,45,0.1);
    border-color: rgba(255,111,45,0.3);
  }
  
  .tip-amount {
    font-weight: 700;
    font-size: 18px;
    margin-bottom: 4px;
  }
  
  .tip-label {
    font-size: 12px;
    color: var(--muted);
  }
  
  /* Custom tip input */
  .custom-tip {
    margin-top: 16px;
  }
  
  /* Chat integration */
  #chatContainer {
    height: 100%;
    display: flex;
    flex-direction: column;
  }
  
  /* Enhanced responsive design */
  @media (max-width: 480px) {
    .modal-content {
      padding: 16px;
    }
    
    .form-row {
      flex-direction: column;
      gap: 12px;
    }
    
    .tip-options {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .story-viewer {
      height: 500px;
    }
    
    .content-item {
      flex-direction: column;
      text-align: center;
    }
    
    .content-actions {
      justify-content: center;
    }
  }
</style>

<!-- Modals -->
<!-- Login Modal -->
<div id="loginModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Sign In to Camsilo</div>
      <button class="modal-close" id="closeLoginModal">‚úï</button>
    </div>
    <div class="login-form">
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="loginEmail" placeholder="Enter your email">
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password">
      </div>
      <div class="checkbox-group">
        <input type="checkbox" id="rememberLogin">
        <label for="rememberLogin">Remember me</label>
      </div>
      <div class="form-actions">
        <button class="btn" id="submitLogin">Sign In</button>
        <button class="btn btn-secondary" id="cancelLogin">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Story Viewer Modal -->
<div id="storyModal" class="modal">
  <div class="modal-content" style="max-width: 420px; padding: 0; background: transparent;">
    <div class="story-viewer">
      <div class="story-progress" id="storyProgress">
        <!-- Progress bars will be added here -->
      </div>
      <img class="story-media" id="storyMedia" src="" alt="Story">
      <div class="story-actions">
        <button class="story-action-btn" id="tipModelBtn" title="Tip Model">üíé</button>
        <button class="story-action-btn" id="viewProfileBtn" title="View Profile">üë§</button>
      </div>
    </div>
  </div>
</div>

<!-- Unlock Content Modal -->
<div id="unlockModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Unlock Exclusive Content</div>
      <button class="modal-close" id="closeUnlockModal">‚úï</button>
    </div>
    <img class="unlock-preview" id="unlockPreview" src="" alt="Preview">
    <div class="unlock-cost">
      This content costs <span id="unlockCost">0</span> credits
    </div>
    <p style="text-align: center; margin-bottom: 20px;">Unlock this content to view it permanently</p>
    <div class="form-actions">
      <button class="btn" id="confirmUnlock">Unlock Content</button>
      <button class="btn btn-secondary" id="cancelUnlock">Cancel</button>
    </div>
    <div id="insufficientCredits" style="display: none; text-align: center; margin-top: 16px;">
      <p style="color: var(--danger); margin-bottom: 12px;">Insufficient credits</p>
      <button class="btn" id="goToWallet">Add Credits to Wallet</button>
    </div>
  </div>
</div>

<!-- Tip Modal -->
<div id="tipModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Tip Model</div>
      <button class="modal-close" id="closeTipModal">‚úï</button>
    </div>
    <p style="text-align: center; margin-bottom: 20px;">Show your appreciation by sending a tip</p>
    
    <div class="tip-options">
      <div class="tip-option" data-amount="10">
        <div class="tip-amount">10</div>
        <div class="tip-label">Credits</div>
      </div>
      <div class="tip-option" data-amount="25">
        <div class="tip-amount">25</div>
        <div class="tip-label">Credits</div>
      </div>
      <div class="tip-option" data-amount="50">
        <div class="tip-amount">50</div>
        <div class="tip-label">Credits</div>
      </div>
      <div class="tip-option" data-amount="100">
        <div class="tip-amount">100</div>
        <div class="tip-label">Credits</div>
      </div>
      <div class="tip-option" data-amount="200">
        <div class="tip-amount">200</div>
        <div class="tip-label">Credits</div>
      </div>
      <div class="tip-option" data-amount="500">
        <div class="tip-amount">500</div>
        <div class="tip-label">Credits</div>
      </div>
    </div>
    
    <div class="custom-tip">
      <label class="form-label">Custom Amount</label>
      <input type="number" class="form-input" id="customTipAmount" placeholder="Enter custom amount" min="1">
    </div>
    
    <div class="form-actions" style="margin-top: 24px;">
      <button class="btn" id="sendTip">Send Tip</button>
      <button class="btn btn-secondary" id="cancelTip">Cancel</button>
    </div>
  </div>
</div>

<!-- Add Credits Modal -->
<div id="addCreditsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Add Credits</div>
      <button class="modal-close" id="closeAddCreditsModal">‚úï</button>
    </div>
    
    <div class="form-group">
      <label class="form-label">Amount</label>
      <input type="number" class="form-input" id="creditAmountModal" placeholder="Enter amount" min="10">
    </div>
    
    <div class="payment-methods">
      <div class="payment-method" data-method="card">
        <div class="payment-icon">üí≥</div>
        <div>Credit Card</div>
      </div>
      <div class="payment-method" data-method="paypal">
        <div class="payment-icon">üîµ</div>
        <div>PayPal</div>
      </div>
      <div class="payment-method" data-method="crypto">
        <div class="payment-icon">‚Çø</div>
        <div>Crypto</div>
      </div>
    </div>
    
    <div class="form-actions" style="margin-top: 24px;">
      <button class="btn" id="proceedPayment">Proceed to Payment</button>
      <button class="btn btn-secondary" id="cancelPayment">Cancel</button>
    </div>
  </div>
</div>

<!-- Admin Model Form Modal -->
<div id="adminModelModal" class="modal">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <div class="modal-title" id="modelModalTitle">Add New Model</div>
      <button class="modal-close" id="closeModelModal">‚úï</button>
    </div>
    
    <div class="admin-form">
      <div class="form-group">
        <label class="form-label">Model Name</label>
        <input type="text" class="form-input" id="modelName" placeholder="Enter model name">
      </div>
      
      <div class="form-group">
        <label class="form-label">Profile Image URL</label>
        <input type="text" class="form-input" id="modelImage" placeholder="https://example.com/image.jpg">
        <img class="media-preview" id="modelImagePreview" src="" alt="Preview">
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Followers Count</label>
          <input type="number" class="form-input" id="modelFollowers" placeholder="0" min="0">
        </div>
        
        <div class="form-group">
          <label class="form-label">Initial Credits Cost</label>
          <input type="number" class="form-input" id="modelCredits" placeholder="0" min="0">
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Bio</label>
        <textarea class="form-input" id="modelBio" placeholder="Enter model bio" rows="3"></textarea>
      </div>
      
      <div class="checkbox-group">
        <input type="checkbox" id="modelVerified">
        <label for="modelVerified">Verified Model</label>
      </div>
      
      <div class="checkbox-group">
        <input type="checkbox" id="modelActive">
        <label for="modelActive">Active</label>
      </div>
      
      <div class="form-actions">
        <button class="btn" id="saveModel">Save Model</button>
        <button class="btn btn-secondary" id="cancelModel">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Admin Content Form Modal -->
<div id="adminContentModal" class="modal">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <div class="modal-title" id="contentModalTitle">Add New Content</div>
      <button class="modal-close" id="closeContentModal">‚úï</button>
    </div>
    
    <div class="admin-form">
      <div class="form-group">
        <label class="form-label">Select Model</label>
        <select class="model-select" id="contentModel">
          <!-- Model options will be populated here -->
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Media URL</label>
        <input type="text" class="form-input" id="contentMedia" placeholder="https://example.com/image.jpg or video.mp4">
        <img class="media-preview" id="contentMediaPreview" src="" alt="Preview">
      </div>
      
      <div class="form-group">
        <label class="form-label">Caption</label>
        <textarea class="form-input" id="contentCaption" placeholder="Enter caption" rows="3"></textarea>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Media Type</label>
          <select class="form-input" id="contentType">
            <option value="image">Image</option>
            <option value="video">Video</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label">Unlock Cost (credits)</label>
          <input type="number" class="form-input" id="contentCost" placeholder="0" min="0">
        </div>
      </div>
      
      <div class="checkbox-group">
        <input type="checkbox" id="contentLocked">
        <label for="contentLocked">Lock Content (requires payment)</label>
      </div>
      
      <div class="form-actions">
        <button class="btn" id="saveContent">Save Content</button>
        <button class="btn btn-secondary" id="cancelContent">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Admin Story Form Modal -->
<div id="adminStoryModal" class="modal">
  <div class="modal-content" style="max-width: 600px;">
    <div class="modal-header">
      <div class="modal-title" id="storyModalTitle">Add New Story</div>
      <button class="modal-close" id="closeStoryModal">‚úï</button>
    </div>
    
    <div class="admin-form">
      <div class="form-group">
        <label class="form-label">Select Model</label>
        <select class="model-select" id="storyModel">
          <!-- Model options will be populated here -->
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Story Media URL</label>
        <input type="text" class="form-input" id="storyMedia" placeholder="https://example.com/image.jpg or video.mp4">
        <img class="media-preview" id="storyMediaPreview" src="" alt="Preview">
      </div>
      
      <div class="form-group">
        <label class="form-label">Media Type</label>
        <select class="form-input" id="storyType">
          <option value="image">Image</option>
          <option value="video">Video</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Duration (seconds)</label>
        <input type="number" class="form-input" id="storyDuration" placeholder="10" min="5" max="30">
      </div>
      
      <div class="form-actions">
        <button class="btn" id="saveStory">Save Story</button>
        <button class="btn btn-secondary" id="cancelStory">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div id="toastContainer"></div>

<script>
// Toast notification function
function showToast(message, type = 'info', duration = 3000) {
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.innerHTML = `
    <div class="toast-message">${message}</div>
  `;
  
  document.getElementById('toastContainer').appendChild(toast);
  
  setTimeout(() => {
    toast.classList.add('show');
  }, 10);
  
  setTimeout(() => {
    toast.classList.remove('show');
    setTimeout(() => {
      toast.remove();
    }, 300);
  }, duration);
}

// Media preview functionality
function setupMediaPreviews() {
  // Model image preview
  const modelImageInput = document.getElementById('modelImage');
  const modelImagePreview = document.getElementById('modelImagePreview');
  
  if (modelImageInput && modelImagePreview) {
    modelImageInput.addEventListener('input', function() {
      if (this.value) {
        modelImagePreview.src = this.value;
        modelImagePreview.classList.add('visible');
      } else {
        modelImagePreview.classList.remove('visible');
      }
    });
  }
  
  // Content media preview
  const contentMediaInput = document.getElementById('contentMedia');
  const contentMediaPreview = document.getElementById('contentMediaPreview');
  
  if (contentMediaInput && contentMediaPreview) {
    contentMediaInput.addEventListener('input', function() {
      if (this.value) {
        contentMediaPreview.src = this.value;
        contentMediaPreview.classList.add('visible');
      } else {
        contentMediaPreview.classList.remove('visible');
      }
    });
  }
  
  // Story media preview
  const storyMediaInput = document.getElementById('storyMedia');
  const storyMediaPreview = document.getElementById('storyMediaPreview');
  
  if (storyMediaInput && storyMediaPreview) {
    storyMediaInput.addEventListener('input', function() {
      if (this.value) {
        storyMediaPreview.src = this.value;
        storyMediaPreview.classList.add('visible');
      } else {
        storyMediaPreview.classList.remove('visible');
      }
    });
  }
}

// Initialize media previews when DOM is loaded
document.addEventListener('DOMContentLoaded', setupMediaPreviews);
</script>
<script>
/*
  Camsilo Platform - Part 3: Core Functionality
*/

(async function () {
  // Check if configuration exists
  if (!window.FIREBASE_CONFIG) {
    console.error('Missing configuration.js (window.FIREBASE_CONFIG)');
    document.body.innerHTML = '<div style="padding:20px;color:white;text-align:center;">Missing configuration.js file with Firebase configuration</div>';
    return;
  }

  try {
    // Initialize Firebase
    const app = firebase.initializeApp(window.FIREBASE_CONFIG);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();
    
    // Enable offline persistence
    db.enablePersistence().catch((err) => {
      console.warn('Firebase persistence failed:', err);
    });
  } catch (error) {
    console.error('Firebase initialization failed:', error);
    document.body.innerHTML = '<div style="padding:20px;color:white;text-align:center;">Firebase initialization failed. Check configuration.</div>';
    return;
  }

  // DOM elements
  const sidebar = document.getElementById('sidebar');
  const menuToggle = document.getElementById('menuToggle');
  const pageTitle = document.getElementById('pageTitle');
  const walletBalance = document.getElementById('walletBalance');
  const balanceAmount = document.getElementById('balanceAmount');
  const walletBalanceLarge = document.getElementById('walletBalanceLarge');
  const userInfo = document.getElementById('userInfo');
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');
  const adminNav = document.getElementById('adminNav');

  // Page elements
  const pages = {
    home: document.getElementById('homePage'),
    models: document.getElementById('modelsPage'),
    reels: document.getElementById('reelsPage'),
    wallet: document.getElementById('walletPage'),
    chat: document.getElementById('chatPage'),
    admin: document.getElementById('adminPage'),
    modelProfile: document.getElementById('modelProfilePage')
  };

  // Navigation elements
  const navItems = document.querySelectorAll('.nav-item');
  const adminTabs = document.querySelectorAll('.admin-tab');
  const adminContents = document.querySelectorAll('.admin-content');

  // Modal elements
  const loginModal = document.getElementById('loginModal');
  const closeLoginModal = document.getElementById('closeLoginModal');
  const submitLogin = document.getElementById('submitLogin');
  const cancelLogin = document.getElementById('cancelLogin');
  const loginEmail = document.getElementById('loginEmail');
  const loginPassword = document.getElementById('loginPassword');
  const rememberLogin = document.getElementById('rememberLogin');

  const storyModal = document.getElementById('storyModal');
  const storyProgress = document.getElementById('storyProgress');
  const storyMedia = document.getElementById('storyMedia');
  const tipModelBtn = document.getElementById('tipModelBtn');
  const viewProfileBtn = document.getElementById('viewProfileBtn');

  const unlockModal = document.getElementById('unlockModal');
  const closeUnlockModal = document.getElementById('closeUnlockModal');
  const unlockPreview = document.getElementById('unlockPreview');
  const unlockCost = document.getElementById('unlockCost');
  const confirmUnlock = document.getElementById('confirmUnlock');
  const cancelUnlock = document.getElementById('cancelUnlock');
  const insufficientCredits = document.getElementById('insufficientCredits');
  const goToWallet = document.getElementById('goToWallet');

  const tipModal = document.getElementById('tipModal');
  const closeTipModal = document.getElementById('closeTipModal');
  const tipOptions = document.querySelectorAll('.tip-option');
  const customTipAmount = document.getElementById('customTipAmount');
  const sendTip = document.getElementById('sendTip');
  const cancelTip = document.getElementById('cancelTip');

  const addCreditsModal = document.getElementById('addCreditsModal');
  const closeAddCreditsModal = document.getElementById('closeAddCreditsModal');
  const creditAmountModal = document.getElementById('creditAmountModal');
  const paymentMethods = document.querySelectorAll('.payment-method');
  const proceedPayment = document.getElementById('proceedPayment');
  const cancelPayment = document.getElementById('cancelPayment');

  // Admin modal elements
  const adminModelModal = document.getElementById('adminModelModal');
  const closeModelModal = document.getElementById('closeModelModal');
  const modelModalTitle = document.getElementById('modelModalTitle');
  const modelName = document.getElementById('modelName');
  const modelImage = document.getElementById('modelImage');
  const modelImagePreview = document.getElementById('modelImagePreview');
  const modelFollowers = document.getElementById('modelFollowers');
  const modelCredits = document.getElementById('modelCredits');
  const modelBio = document.getElementById('modelBio');
  const modelVerified = document.getElementById('modelVerified');
  const modelActive = document.getElementById('modelActive');
  const saveModel = document.getElementById('saveModel');
  const cancelModel = document.getElementById('cancelModel');

  const adminContentModal = document.getElementById('adminContentModal');
  const closeContentModal = document.getElementById('closeContentModal');
  const contentModalTitle = document.getElementById('contentModalTitle');
  const contentModel = document.getElementById('contentModel');
  const contentMedia = document.getElementById('contentMedia');
  const contentMediaPreview = document.getElementById('contentMediaPreview');
  const contentCaption = document.getElementById('contentCaption');
  const contentType = document.getElementById('contentType');
  const contentCost = document.getElementById('contentCost');
  const contentLocked = document.getElementById('contentLocked');
  const saveContent = document.getElementById('saveContent');
  const cancelContent = document.getElementById('cancelContent');

  const adminStoryModal = document.getElementById('adminStoryModal');
  const closeStoryModal = document.getElementById('closeStoryModal');
  const storyModalTitle = document.getElementById('storyModalTitle');
  const storyModel = document.getElementById('storyModel');
  const storyMediaInput = document.getElementById('storyMedia');
  const storyMediaPreview = document.getElementById('storyMediaPreview');
  const storyType = document.getElementById('storyType');
  const storyDuration = document.getElementById('storyDuration');
  const saveStory = document.getElementById('saveStory');
  const cancelStory = document.getElementById('cancelStory');

  // Content elements
  const storiesScroll = document.getElementById('storiesScroll');
  const featuredModels = document.getElementById('featuredModels');
  const allModels = document.getElementById('allModels');
  const reelsContainer = document.getElementById('reelsContainer');
  const paymentMethodsContainer = document.getElementById('paymentMethods');
  const transactionHistory = document.getElementById('transactionHistory');

  // State
  let me = null;
  let role = 'guest';
  let userData = null;
  let currentPage = 'home';
  let currentModel = null;
  let currentContent = null;
  let currentStories = [];
  let currentStoryIndex = 0;
  let storyInterval = null;
  let selectedTipAmount = 0;
  let selectedPaymentMethod = null;
  let editingModel = null;
  let editingContent = null;
  let editingStory = null;

  // Page titles mapping
  const pageTitles = {
    home: 'Camsilo',
    models: 'All Models',
    reels: 'Video Reels',
    wallet: 'Wallet',
    chat: 'Private Chat',
    admin: 'Admin Panel',
    modelProfile: 'Model Profile'
  };

  // Helper functions
  function openModal(modal) {
    modal.style.display = 'flex';
    setTimeout(() => {
      modal.classList.add('open');
    }, 10);
  }

  function closeModal(modal) {
    modal.classList.remove('open');
    setTimeout(() => {
      modal.style.display = 'none';
    }, 300);
  }

  function showPage(pageName) {
    // Hide all pages
    Object.values(pages).forEach(page => {
      page.classList.add('hidden');
      page.classList.remove('active', 'left');
    });

    // Show selected page
    if (pages[pageName]) {
      pages[pageName].classList.remove('hidden');
      pages[pageName].classList.add('active');
      currentPage = pageName;
      pageTitle.textContent = pageTitles[pageName];
    }

    // Update active nav item
    navItems.forEach(item => {
      item.classList.remove('active');
      if (item.dataset.page === pageName) {
        item.classList.add('active');
      }
    });

    // Load page-specific content
    loadPageContent(pageName);
  }

  function loadPageContent(pageName) {
    switch (pageName) {
      case 'home':
        loadFeaturedModels();
        loadStories();
        break;
      case 'models':
        loadAllModels();
        break;
      case 'reels':
        loadReels();
        break;
      case 'wallet':
        loadWalletData();
        break;
      case 'chat':
        loadChatInterface();
        break;
      case 'admin':
        loadAdminData();
        break;
    }
  }

  async function loadUserData() {
    if (!me) return;

    try {
      const userDoc = await db.collection('users').doc(me.uid).get();
      if (userDoc.exists) {
        userData = userDoc.data();
        role = userData.role || 'user';
        
        // Update UI based on role
        if (role === 'admin') {
          adminNav.style.display = 'block';
        } else {
          adminNav.style.display = 'none';
        }

        // Update wallet balance
        updateWalletBalance(userData.balance || 0);
        
        // Update user info
        userInfo.textContent = me.email || `User ${me.uid.slice(0, 6)}`;
      } else {
        // Create user document if it doesn't exist
        await db.collection('users').doc(me.uid).set({
          email: me.email,
          role: 'user',
          balance: 0,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        userData = { balance: 0, role: 'user' };
        updateWalletBalance(0);
      }
    } catch (error) {
      console.error('Error loading user data:', error);
    }
  }

  function updateWalletBalance(balance) {
    balanceAmount.textContent = balance;
    walletBalanceLarge.textContent = `${balance} credits`;
  }

  async function loadStories() {
    try {
      const storiesSnapshot = await db.collection('stories')
        .where('active', '==', true)
        .orderBy('createdAt', 'desc')
        .get();

      currentStories = [];
      storiesScroll.innerHTML = '';

      if (storiesSnapshot.empty) {
        storiesScroll.innerHTML = '<div class="empty-state">No active stories</div>';
        return;
      }

      // Group stories by model
      const storiesByModel = {};
      storiesSnapshot.forEach(doc => {
        const story = { id: doc.id, ...doc.data() };
        if (!storiesByModel[story.modelId]) {
          storiesByModel[story.modelId] = [];
        }
        storiesByModel[story.modelId].push(story);
      });

      // Get model details
      for (const modelId in storiesByModel) {
        try {
          const modelDoc = await db.collection('models').doc(modelId).get();
          if (modelDoc.exists) {
            const model = modelDoc.data();
            const storyItem = createStoryElement(model, storiesByModel[modelId]);
            storiesScroll.appendChild(storyItem);
            currentStories.push({
              modelId,
              model,
              stories: storiesByModel[modelId]
            });
          }
        } catch (error) {
          console.error('Error loading model:', error);
        }
      }
    } catch (error) {
      console.error('Error loading stories:', error);
      storiesScroll.innerHTML = '<div class="empty-state">Error loading stories</div>';
    }
  }

  function createStoryElement(model, stories) {
    const storyItem = document.createElement('div');
    storyItem.className = 'story-item';
    storyItem.innerHTML = `
      <div class="story-avatar">
        ${model.name ? model.name.charAt(0).toUpperCase() : 'M'}
        <div class="story-live">LIVE</div>
      </div>
      <div class="story-name">${model.name || 'Model'}</div>
    `;

    storyItem.addEventListener('click', () => {
      openStoryViewer(model, stories);
    });

    return storyItem;
  }

  function openStoryViewer(model, stories) {
    currentModel = model;
    currentStories = stories;
    currentStoryIndex = 0;

    // Clear progress bars
    storyProgress.innerHTML = '';
    
    // Create progress bars
    stories.forEach((story, index) => {
      const progressBar = document.createElement('div');
      progressBar.className = 'progress-bar';
      progressBar.innerHTML = `<div class="progress-fill" id="progress-${index}"></div>`;
      storyProgress.appendChild(progressBar);
    });

    // Show first story
    showStory(0);
    openModal(storyModal);

    // Start progress animation
    startStoryProgress();
  }

  function showStory(index) {
    if (index < 0 || index >= currentStories.length) {
      closeModal(storyModal);
      return;
    }

    currentStoryIndex = index;
    const story = currentStories[index];
    
    // Reset all progress bars
    document.querySelectorAll('.progress-fill').forEach((bar, i) => {
      bar.style.width = i < index ? '100%' : '0%';
    });

    // Set media
    if (story.mediaType === 'video') {
      storyMedia.innerHTML = `
        <video class="story-media" autoplay muted>
          <source src="${story.mediaUrl}" type="video/mp4">
        </video>
      `;
    } else {
      storyMedia.src = story.mediaUrl;
      storyMedia.style.display = 'block';
    }

    // Update buttons
    tipModelBtn.onclick = () => {
      closeModal(storyModal);
      openTipModal(currentModel);
    };

    viewProfileBtn.onclick = () => {
      closeModal(storyModal);
      showModelProfile(currentModel);
    };
  }

  function startStoryProgress() {
    const currentStory = currentStories[currentStoryIndex];
    const duration = (currentStory.duration || 10) * 1000;
    const progressBar = document.getElementById(`progress-${currentStoryIndex}`);
    
    if (progressBar) {
      progressBar.style.transition = `width ${duration}ms linear`;
      progressBar.style.width = '100%';
    }

    storyInterval = setTimeout(() => {
      showStory(currentStoryIndex + 1);
    }, duration);
  }

  function stopStoryProgress() {
    if (storyInterval) {
      clearTimeout(storyInterval);
      storyInterval = null;
    }
  }

  async function loadFeaturedModels() {
    try {
      const modelsSnapshot = await db.collection('models')
        .where('active', '==', true)
        .limit(8)
        .get();

      featuredModels.innerHTML = '';

      if (modelsSnapshot.empty) {
        featuredModels.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üë©</div>
            <div>No models available</div>
          </div>
        `;
        return;
      }

      modelsSnapshot.forEach(doc => {
        const model = { id: doc.id, ...doc.data() };
        const modelCard = createModelCard(model);
        featuredModels.appendChild(modelCard);
      });
    } catch (error) {
      console.error('Error loading featured models:', error);
      featuredModels.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">‚ö†Ô∏è</div>
          <div>Error loading models</div>
        </div>
      `;
    }
  }

  async function loadAllModels() {
    try {
      const modelsSnapshot = await db.collection('models')
        .where('active', '==', true)
        .get();

      allModels.innerHTML = '';

      if (modelsSnapshot.empty) {
        allModels.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üë©</div>
            <div>No models available</div>
          </div>
        `;
        return;
      }

      modelsSnapshot.forEach(doc => {
        const model = { id: doc.id, ...doc.data() };
        const modelCard = createModelCard(model);
        allModels.appendChild(modelCard);
      });
    } catch (error) {
      console.error('Error loading all models:', error);
      allModels.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">‚ö†Ô∏è</div>
          <div>Error loading models</div>
        </div>
      `;
    }
  }

  function createModelCard(model) {
    const card = document.createElement('div');
    card.className = 'model-card';
    card.innerHTML = `
      <img src="${model.imageUrl || 'https://via.placeholder.com/300x250?text=Model'}" 
           alt="${model.name}" class="model-image">
      <div class="model-info">
        <div class="model-name">
          ${model.name || 'Model'}
          ${model.verified ? '<span class="verified-badge">‚úì</span>' : ''}
        </div>
        <div class="model-stats">
          <span>${model.followers || 0} followers</span>
          <span>${model.posts || 0} posts</span>
        </div>
      </div>
    `;

    card.addEventListener('click', () => {
      showModelProfile(model);
    });

    return card;
  }

  function showModelProfile(model) {
    currentModel = model;
    
    // Create profile page content
    pages.modelProfile.innerHTML = `
      <div class="profile-header">
        <img src="${model.imageUrl || 'https://via.placeholder.com/120x120?text=Model'}" 
             alt="${model.name}" class="profile-avatar">
        <div class="profile-info">
          <div class="profile-name">
            ${model.name || 'Model'}
            ${model.verified ? '<span class="verified-badge">‚úì</span>' : ''}
          </div>
          <div class="profile-bio">${model.bio || 'No bio available'}</div>
          <div class="profile-stats">
            <div class="stat">
              <div class="stat-value">${model.followers || 0}</div>
              <div class="stat-label">Followers</div>
            </div>
            <div class="stat">
              <div class="stat-value">${model.posts || 0}</div>
              <div class="stat-label">Posts</div>
            </div>
            <div class="stat">
              <div class="stat-value">${model.credits || 0}</div>
              <div class="stat-label">Credits/Post</div>
            </div>
          </div>
          <div class="profile-actions">
            <button class="btn" id="followModel">Follow</button>
            <button class="btn btn-secondary" id="tipModel">Tip Model</button>
          </div>
        </div>
      </div>
      <h3>Posts</h3>
      <div class="posts-grid" id="modelPosts">
        Loading posts...
      </div>
    `;

    // Load model posts
    loadModelPosts(model.id);

    // Add event listeners
    setTimeout(() => {
      document.getElementById('followModel').addEventListener('click', () => {
        followModel(model.id);
      });

      document.getElementById('tipModel').addEventListener('click', () => {
        openTipModal(model);
      });
    }, 100);

    showPage('modelProfile');
  }

  async function loadModelPosts(modelId) {
    try {
      const postsSnapshot = await db.collection('posts')
        .where('modelId', '==', modelId)
        .where('active', '==', true)
        .orderBy('createdAt', 'desc')
        .get();

      const postsGrid = document.getElementById('modelPosts');
      postsGrid.innerHTML = '';

      if (postsSnapshot.empty) {
        postsGrid.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üì∑</div>
            <div>No posts yet</div>
          </div>
        `;
        return;
      }

      postsSnapshot.forEach(doc => {
        const post = { id: doc.id, ...doc.data() };
        const postCard = createPostCard(post);
        postsGrid.appendChild(postCard);
      });
    } catch (error) {
      console.error('Error loading model posts:', error);
      document.getElementById('modelPosts').innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">‚ö†Ô∏è</div>
          <div>Error loading posts</div>
        </div>
      `;
    }
  }

  function createPostCard(post) {
    const card = document.createElement('div');
    card.className = 'post-card';
    
    const mediaElement = post.mediaType === 'video' ? 
      `<video class="post-media ${post.locked ? 'post-locked' : ''}" controls controlsList="nodownload">
        <source src="${post.mediaUrl}" type="video/mp4">
      </video>` :
      `<img src="${post.mediaUrl}" alt="Post" class="post-media ${post.locked ? 'post-locked' : ''}">`;

    card.innerHTML = `
      ${mediaElement}
      ${post.locked ? `
        <div class="lock-overlay">
          <div class="lock-icon">üîí</div>
          <button class="btn" onclick="unlockPost('${post.id}', ${post.unlockCost || 0})">
            Unlock for ${post.unlockCost || 0} credits
          </button>
        </div>
      ` : ''}
      <div class="post-info">
        <div class="post-caption">${post.caption || ''}</div>
        <div class="post-meta">
          <span>${formatDate(post.createdAt)}</span>
          <span>${post.likes || 0} likes</span>
        </div>
      </div>
    `;

    return card;
  }

  function formatDate(timestamp) {
    if (!timestamp) return '';
    try {
      const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
      return date.toLocaleDateString();
    } catch {
      return '';
    }
  }

  // Event Listeners
  menuToggle.addEventListener('click', () => {
    sidebar.classList.toggle('open');
  });

  navItems.forEach(item => {
    item.addEventListener('click', (e) => {
      e.preventDefault();
      const page = item.dataset.page;
      showPage(page);
      
      // Close sidebar on mobile after selection
      if (window.innerWidth <= 768) {
        sidebar.classList.remove('open');
      }
    });
  });

  adminTabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const tabName = tab.dataset.tab;
      
      // Update active tab
      adminTabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      
      // Show corresponding content
      adminContents.forEach(content => {
        content.classList.remove('active');
        if (content.id === `admin${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`) {
          content.classList.add('active');
        }
      });
    });
  });

  // Login/Logout handlers
  loginBtn.addEventListener('click', () => {
    openModal(loginModal);
  });

  closeLoginModal.addEventListener('click', () => {
    closeModal(loginModal);
  });

  cancelLogin.addEventListener('click', () => {
    closeModal(loginModal);
  });

  submitLogin.addEventListener('click', async () => {
    const email = loginEmail.value.trim();
    const password = loginPassword.value;
    const remember = rememberLogin.checked;

    if (!email || !password) {
      showToast('Please enter both email and password', 'error');
      return;
    }

    try {
      // Set persistence
      await auth.setPersistence(
        remember ? firebase.auth.Auth.Persistence.LOCAL : firebase.auth.Auth.Persistence.SESSION
      );

      // Sign in
      const cred = await auth.signInWithEmailAndPassword(email, password);
      me = cred.user;
      await loadUserData();
      
      showToast('Login successful!', 'success');
      closeModal(loginModal);
      
      // Update UI
      loginBtn.style.display = 'none';
      userInfo.textContent = me.email;
      
    } catch (error) {
      console.error('Login error:', error);
      showToast('Login failed: ' + (error.message || 'Invalid credentials'), 'error');
    }
  });

  logoutBtn.addEventListener('click', async () => {
    try {
      await auth.signOut();
      me = null;
      userData = null;
      role = 'guest';
      
      // Reset UI
      loginBtn.style.display = 'block';
      userInfo.textContent = 'Not signed in';
      walletBalance.style.display = 'none';
      adminNav.style.display = 'none';
      
      showToast('Logged out successfully', 'success');
      showPage('home');
    } catch (error) {
      console.error('Logout error:', error);
    }
  });

  // Story modal handlers
  storyModal.addEventListener('click', (e) => {
    if (e.target === storyModal) {
      stopStoryProgress();
      closeModal(storyModal);
    }
  });

  // Tip modal handlers
  tipOptions.forEach(option => {
    option.addEventListener('click', () => {
      tipOptions.forEach(opt => opt.classList.remove('active'));
      option.classList.add('active');
      selectedTipAmount = parseInt(option.dataset.amount);
    });
  });

  customTipAmount.addEventListener('input', () => {
    const amount = parseInt(customTipAmount.value);
    if (amount > 0) {
      selectedTipAmount = amount;
      tipOptions.forEach(opt => opt.classList.remove('active'));
    }
  });

  closeTipModal.addEventListener('click', () => {
    closeModal(tipModal);
  });

  cancelTip.addEventListener('click', () => {
    closeModal(tipModal);
  });

  sendTip.addEventListener('click', async () => {
    if (!selectedTipAmount || selectedTipAmount <= 0) {
      showToast('Please select a tip amount', 'error');
      return;
    }

    if (!me) {
      showToast('Please login to send tips', 'error');
      return;
    }

    if (userData.balance < selectedTipAmount) {
      showToast('Insufficient balance', 'error');
      return;
    }

    try {
      // Deduct from user balance
      await db.collection('users').doc(me.uid).update({
        balance: firebase.firestore.FieldValue.increment(-selectedTipAmount)
      });

      // Add to model's earnings (you might want to track this differently)
      await db.collection('tips').add({
        fromUserId: me.uid,
        toModelId: currentModel.id,
        amount: selectedTipAmount,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      // Update local balance
      userData.balance -= selectedTipAmount;
      updateWalletBalance(userData.balance);

      showToast(`Tip of ${selectedTipAmount} credits sent!`, 'success');
      closeModal(tipModal);
    } catch (error) {
      console.error('Error sending tip:', error);
      showToast('Failed to send tip', 'error');
    }
  });

  // Initialize the app
  auth.onAuthStateChanged(async (user) => {
    if (user) {
      me = user;
      await loadUserData();
      loginBtn.style.display = 'none';
      walletBalance.style.display = 'flex';
    } else {
      me = null;
      userData = null;
      role = 'guest';
      loginBtn.style.display = 'block';
      walletBalance.style.display = 'none';
      adminNav.style.display = 'none';
    }
  });

  // Expose some functions globally for use in HTML
  window.unlockPost = async function(postId, cost) {
    if (!me) {
      showToast('Please login to unlock content', 'error');
      return;
    }

    if (userData.balance < cost) {
      showToast('Insufficient credits to unlock this content', 'error');
      openModal(unlockModal);
      return;
    }

    try {
      // Deduct credits
      await db.collection('users').doc(me.uid).update({
        balance: firebase.firestore.FieldValue.increment(-cost)
      });

      // Record unlock
      await db.collection('unlocks').add({
        userId: me.uid,
        postId: postId,
        cost: cost,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      // Update post to show as unlocked for this user
      await db.collection('userUnlocks').doc(`${me.uid}_${postId}`).set({
        unlocked: true,
        unlockedAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      userData.balance -= cost;
      updateWalletBalance(userData.balance);
      
      showToast('Content unlocked successfully!', 'success');
      
      // Reload the model posts to show unlocked content
      if (currentModel) {
        loadModelPosts(currentModel.id);
      }
    } catch (error) {
      console.error('Error unlocking post:', error);
      showToast('Failed to unlock content', 'error');
    }
  };

  window.openTipModal = function(model) {
    currentModel = model;
    selectedTipAmount = 0;
    customTipAmount.value = '';
    tipOptions.forEach(opt => opt.classList.remove('active'));
    openModal(tipModal);
  };

  // Initialize
  console.log('Camsilo Platform initialized');
  showPage('home');
})();
</script>
<script>
/*
  Camsilo Platform - Part 4: Advanced Features
*/

// Continue from Part 3
(async function () {
  // Reels functionality
  let currentReelIndex = 0;
  let reels = [];
  let isSwiping = false;
  let startX = 0;
  let currentX = 0;

  // Swipe indicators
  const swipeLeftIndicator = document.querySelector('.swipe-left');
  const swipeRightIndicator = document.querySelector('.swipe-right');

  // Load reels
  async function loadReels() {
    try {
      const reelsSnapshot = await db.collection('reels')
        .where('active', '==', true)
        .orderBy('createdAt', 'desc')
        .get();

      reels = [];
      reelsContainer.innerHTML = '';

      if (reelsSnapshot.empty) {
        reelsContainer.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üé¨</div>
            <div>No reels available</div>
          </div>
        `;
        return;
      }

      reelsSnapshot.forEach(doc => {
        const reel = { id: doc.id, ...doc.data() };
        reels.push(reel);
      });

      // Load model data for reels
      for (let reel of reels) {
        try {
          const modelDoc = await db.collection('models').doc(reel.modelId).get();
          if (modelDoc.exists) {
            reel.model = modelDoc.data();
          }
        } catch (error) {
          console.error('Error loading model for reel:', error);
        }
      }

      showReel(0);
      setupSwipeGestures();
    } catch (error) {
      console.error('Error loading reels:', error);
      reelsContainer.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">‚ö†Ô∏è</div>
          <div>Error loading reels</div>
        </div>
      `;
    }
  }

  function showReel(index) {
    if (index < 0 || index >= reels.length) return;
    
    currentReelIndex = index;
    const reel = reels[index];

    reelsContainer.innerHTML = `
      <div class="reel">
        ${reel.mediaType === 'video' ? `
          <video class="reel-video" autoplay muted loop controls controlsList="nodownload">
            <source src="${reel.mediaUrl}" type="video/mp4">
          </video>
        ` : `
          <img src="${reel.mediaUrl}" alt="Reel" class="reel-video">
        `}
        <div class="reel-overlay">
          <h3>${reel.model?.name || 'Model'}</h3>
          <p>${reel.caption || ''}</p>
        </div>
        <div class="reel-actions">
          <button class="action-button" onclick="likeReel('${reel.id}')">
            ‚ù§Ô∏è<br><small>${reel.likes || 0}</small>
          </button>
          <button class="action-button" onclick="openTipModal(reels[${index}].model)">
            üíé<br><small>Tip</small>
          </button>
          <button class="action-button" onclick="showModelProfile(reels[${index}].model)">
            üë§<br><small>Profile</small>
          </button>
        </div>
      </div>
    `;

    // Auto-play video
    const video = reelsContainer.querySelector('video');
    if (video) {
      video.play().catch(e => console.log('Auto-play prevented:', e));
    }
  }

  function setupSwipeGestures() {
    let startX = 0;
    let currentX = 0;
    let isSwiping = false;

    reelsContainer.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      isSwiping = true;
    });

    reelsContainer.addEventListener('touchmove', (e) => {
      if (!isSwiping) return;
      currentX = e.touches[0].clientX;
      
      // Show swipe indicators
      const diff = startX - currentX;
      if (Math.abs(diff) > 50) {
        if (diff > 0 && currentReelIndex < reels.length - 1) {
          swipeRightIndicator.classList.add('swipe-visible');
        } else if (diff < 0 && currentReelIndex > 0) {
          swipeLeftIndicator.classList.add('swipe-visible');
        }
      }
    });

    reelsContainer.addEventListener('touchend', (e) => {
      if (!isSwiping) return;
      
      const diff = startX - currentX;
      const swipeThreshold = 50;

      if (Math.abs(diff) > swipeThreshold) {
        if (diff > 0 && currentReelIndex < reels.length - 1) {
          // Swipe right - next reel
          showReel(currentReelIndex + 1);
        } else if (diff < 0 && currentReelIndex > 0) {
          // Swipe left - previous reel
          showReel(currentReelIndex - 1);
        }
      }

      // Hide swipe indicators
      swipeLeftIndicator.classList.remove('swipe-visible');
      swipeRightIndicator.classList.remove('swipe-visible');
      isSwiping = false;
    });

    // Mouse events for desktop
    reelsContainer.addEventListener('mousedown', (e) => {
      startX = e.clientX;
      isSwiping = true;
    });

    reelsContainer.addEventListener('mousemove', (e) => {
      if (!isSwiping) return;
      currentX = e.clientX;
    });

    reelsContainer.addEventListener('mouseup', (e) => {
      if (!isSwiping) return;
      
      const diff = startX - currentX;
      const swipeThreshold = 50;

      if (Math.abs(diff) > swipeThreshold) {
        if (diff > 0 && currentReelIndex < reels.length - 1) {
          showReel(currentReelIndex + 1);
        } else if (diff < 0 && currentReelIndex > 0) {
          showReel(currentReelIndex - 1);
        }
      }

      isSwiping = false;
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (currentPage !== 'reels') return;
      
      if (e.key === 'ArrowDown' && currentReelIndex < reels.length - 1) {
        e.preventDefault();
        showReel(currentReelIndex + 1);
      } else if (e.key === 'ArrowUp' && currentReelIndex > 0) {
        e.preventDefault();
        showReel(currentReelIndex - 1);
      }
    });
  }

  // Like reel function
  window.likeReel = async function(reelId) {
    if (!me) {
      showToast('Please login to like reels', 'error');
      return;
    }

    try {
      await db.collection('reels').doc(reelId).update({
        likes: firebase.firestore.FieldValue.increment(1)
      });

      // Update local data
      const reel = reels.find(r => r.id === reelId);
      if (reel) {
        reel.likes = (reel.likes || 0) + 1;
      }

      showToast('Liked!', 'success');
      
      // Update UI
      const likeButton = document.querySelector('.action-button');
      if (likeButton) {
        const small = likeButton.querySelector('small');
        if (small) {
          small.textContent = reel.likes || 1;
        }
      }
    } catch (error) {
      console.error('Error liking reel:', error);
    }
  };

  // Wallet functionality
  async function loadWalletData() {
    if (!me) return;

    // Load payment methods from admin settings
    try {
      const paymentMethodsDoc = await db.collection('settings').doc('paymentMethods').get();
      if (paymentMethodsDoc.exists) {
        const methods = paymentMethodsDoc.data().methods || [];
        renderPaymentMethods(methods);
      }
    } catch (error) {
      console.error('Error loading payment methods:', error);
    }

    // Load transaction history
    loadTransactionHistory();
  }

  function renderPaymentMethods(methods) {
    paymentMethodsContainer.innerHTML = '';
    
    if (methods.length === 0) {
      // Default payment methods
      methods = [
        { id: 'card', name: 'Credit Card', icon: 'üí≥', url: '#' },
        { id: 'paypal', name: 'PayPal', icon: 'üîµ', url: '#' },
        { id: 'crypto', name: 'Crypto', icon: '‚Çø', url: '#' }
      ];
    }

    methods.forEach(method => {
      const methodElement = document.createElement('div');
      methodElement.className = 'payment-method';
      methodElement.innerHTML = `
        <div class="payment-icon">${method.icon}</div>
        <div>${method.name}</div>
      `;
      
      methodElement.addEventListener('click', () => {
        selectedPaymentMethod = method;
        openAddCreditsModal();
      });
      
      paymentMethodsContainer.appendChild(methodElement);
    });
  }

  async function loadTransactionHistory() {
    try {
      const transactionsSnapshot = await db.collection('transactions')
        .where('userId', '==', me.uid)
        .orderBy('timestamp', 'desc')
        .limit(20)
        .get();

      transactionHistory.innerHTML = '';

      if (transactionsSnapshot.empty) {
        transactionHistory.innerHTML = '<div class="empty-state">No transactions yet</div>';
        return;
      }

      transactionsSnapshot.forEach(doc => {
        const transaction = { id: doc.id, ...doc.data() };
        const transactionElement = createTransactionElement(transaction);
        transactionHistory.appendChild(transactionElement);
      });
    } catch (error) {
      console.error('Error loading transactions:', error);
      transactionHistory.innerHTML = '<div class="empty-state">Error loading transactions</div>';
    }
  }

  function createTransactionElement(transaction) {
    const element = document.createElement('div');
    element.className = 'content-item';
    
    const typeIcon = transaction.type === 'credit' ? '‚ûï' : '‚ûñ';
    const amountClass = transaction.type === 'credit' ? 'success' : 'danger';
    
    element.innerHTML = `
      <div style="font-size: 24px;">${typeIcon}</div>
      <div class="content-info">
        <div class="content-title">${transaction.description || 'Transaction'}</div>
        <div class="content-meta">${formatDate(transaction.timestamp)}</div>
      </div>
      <div style="color: var(--${amountClass}); font-weight: 600;">
        ${transaction.type === 'credit' ? '+' : '-'}${transaction.amount} credits
      </div>
    `;
    
    return element;
  }

  // Add credits functionality
  function openAddCreditsModal() {
    if (!me) {
      showToast('Please login to add credits', 'error');
      return;
    }
    
    creditAmountModal.value = '';
    selectedPaymentMethod = null;
    openModal(addCreditsModal);
  }

  proceedPayment.addEventListener('click', async () => {
    const amount = parseInt(creditAmountModal.value);
    
    if (!amount || amount < 10) {
      showToast('Please enter a valid amount (minimum 10 credits)', 'error');
      return;
    }

    if (!selectedPaymentMethod) {
      showToast('Please select a payment method', 'error');
      return;
    }

    try {
      // In a real app, you would redirect to payment gateway
      // For demo, we'll simulate successful payment
      
      // Add credits to user balance
      await db.collection('users').doc(me.uid).update({
        balance: firebase.firestore.FieldValue.increment(amount)
      });

      // Record transaction
      await db.collection('transactions').add({
        userId: me.uid,
        type: 'credit',
        amount: amount,
        description: `Added ${amount} credits via ${selectedPaymentMethod.name}`,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      // Update local balance
      userData.balance += amount;
      updateWalletBalance(userData.balance);

      showToast(`Successfully added ${amount} credits!`, 'success');
      closeModal(addCreditsModal);
      
      // Reload transaction history
      loadTransactionHistory();
    } catch (error) {
      console.error('Error adding credits:', error);
      showToast('Failed to add credits', 'error');
    }
  });

  // Admin panel functionality
  async function loadAdminData() {
    if (role !== 'admin') return;

    // Load models for dropdowns
    await loadAdminModels();
    
    // Load existing content
    await loadAdminContent();
    
    // Load existing stories
    await loadAdminStories();
    
    // Load payment methods
    await loadAdminPaymentMethods();
  }

  async function loadAdminModels() {
    try {
      const modelsSnapshot = await db.collection('models').get();
      const modelSelects = document.querySelectorAll('.model-select');
      
      modelSelects.forEach(select => {
        select.innerHTML = '<option value="">Select a model</option>';
      });

      modelsSnapshot.forEach(doc => {
        const model = { id: doc.id, ...doc.data() };
        modelSelects.forEach(select => {
          const option = document.createElement('option');
          option.value = model.id;
          option.textContent = model.name || 'Unnamed Model';
          select.appendChild(option);
        });
      });

      // Populate models list in admin panel
      const adminModelsContent = document.getElementById('adminModels');
      adminModelsContent.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h3>Manage Models</h3>
          <button class="btn" id="addModelBtn">Add New Model</button>
        </div>
        <div id="modelsList" class="content-list">
          Loading models...
        </div>
      `;

      // Load models list
      const modelsList = document.getElementById('modelsList');
      modelsList.innerHTML = '';

      if (modelsSnapshot.empty) {
        modelsList.innerHTML = '<div class="empty-state">No models found</div>';
        return;
      }

      modelsSnapshot.forEach(doc => {
        const model = { id: doc.id, ...doc.data() };
        const modelElement = createAdminModelElement(model);
        modelsList.appendChild(modelElement);
      });

      // Add event listener for add model button
      document.getElementById('addModelBtn').addEventListener('click', () => {
        openModelModal();
      });

    } catch (error) {
      console.error('Error loading admin models:', error);
    }
  }

  function createAdminModelElement(model) {
    const element = document.createElement('div');
    element.className = 'content-item';
    element.innerHTML = `
      <img src="${model.imageUrl || 'https://via.placeholder.com/80x80?text=Model'}" 
           alt="${model.name}" class="content-thumb">
      <div class="content-info">
        <div class="content-title">
          ${model.name || 'Unnamed Model'}
          ${model.verified ? '<span class="verified-badge">‚úì</span>' : ''}
        </div>
        <div class="content-meta">
          ${model.followers || 0} followers ‚Ä¢ ${model.posts || 0} posts ‚Ä¢
          ${model.active ? 'Active' : 'Inactive'}
        </div>
      </div>
      <div class="content-actions">
        <button class="action-btn edit" data-id="${model.id}">Edit</button>
        <button class="action-btn delete" data-id="${model.id}">Delete</button>
      </div>
    `;

    // Add event listeners
    element.querySelector('.action-btn.edit').addEventListener('click', () => {
      editModel(model.id);
    });

    element.querySelector('.action-btn.delete').addEventListener('click', () => {
      deleteModel(model.id);
    });

    return element;
  }

  function openModelModal(model = null) {
    editingModel = model;
    
    if (model) {
      modelModalTitle.textContent = 'Edit Model';
      modelName.value = model.name || '';
      modelImage.value = model.imageUrl || '';
      modelFollowers.value = model.followers || 0;
      modelCredits.value = model.credits || 0;
      modelBio.value = model.bio || '';
      modelVerified.checked = model.verified || false;
      modelActive.checked = model.active !== false;
      
      if (model.imageUrl) {
        modelImagePreview.src = model.imageUrl;
        modelImagePreview.classList.add('visible');
      }
    } else {
      modelModalTitle.textContent = 'Add New Model';
      modelName.value = '';
      modelImage.value = '';
      modelFollowers.value = 0;
      modelCredits.value = 0;
      modelBio.value = '';
      modelVerified.checked = false;
      modelActive.checked = true;
      modelImagePreview.classList.remove('visible');
    }
    
    openModal(adminModelModal);
  }

  saveModel.addEventListener('click', async () => {
    const modelData = {
      name: modelName.value.trim(),
      imageUrl: modelImage.value.trim(),
      followers: parseInt(modelFollowers.value) || 0,
      credits: parseInt(modelCredits.value) || 0,
      bio: modelBio.value.trim(),
      verified: modelVerified.checked,
      active: modelActive.checked,
      updatedAt: firebase.firestore.FieldValue.serverTimestamp()
    };

    if (!modelData.name) {
      showToast('Please enter a model name', 'error');
      return;
    }

    try {
      if (editingModel) {
        // Update existing model
        await db.collection('models').doc(editingModel.id).update(modelData);
        showToast('Model updated successfully!', 'success');
      } else {
        // Add new model
        modelData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
        modelData.posts = 0;
        await db.collection('models').add(modelData);
        showToast('Model added successfully!', 'success');
      }

      closeModal(adminModelModal);
      loadAdminModels();
    } catch (error) {
      console.error('Error saving model:', error);
      showToast('Failed to save model', 'error');
    }
  });

  async function editModel(modelId) {
    try {
      const modelDoc = await db.collection('models').doc(modelId).get();
      if (modelDoc.exists) {
        const model = { id: modelDoc.id, ...modelDoc.data() };
        openModelModal(model);
      }
    } catch (error) {
      console.error('Error loading model for edit:', error);
      showToast('Error loading model', 'error');
    }
  }

  async function deleteModel(modelId) {
    if (!confirm('Are you sure you want to delete this model? This action cannot be undone.')) {
      return;
    }

    try {
      await db.collection('models').doc(modelId).delete();
      showToast('Model deleted successfully', 'success');
      loadAdminModels();
    } catch (error) {
      console.error('Error deleting model:', error);
      showToast('Failed to delete model', 'error');
    }
  }

  // Similar implementations for content and stories management...
  // (Content and stories management code would follow similar patterns)

  // Download protection
  document.addEventListener('contextmenu', (e) => {
    if (e.target.tagName === 'IMG' || e.target.tagName === 'VIDEO') {
      e.preventDefault();
      showToast('Right-click is disabled to protect content', 'error');
      return false;
    }
  });

  // Prevent dragging of images and videos
  document.addEventListener('dragstart', (e) => {
    if (e.target.tagName === 'IMG' || e.target.tagName === 'VIDEO') {
      e.preventDefault();
      return false;
    }
  });

  // Disable text selection on media elements
  document.addEventListener('selectstart', (e) => {
    if (e.target.tagName === 'IMG' || e.target.tagName === 'VIDEO') {
      e.preventDefault();
      return false;
    }
  });

  // Swipe between pages
  function setupPageSwipeGestures() {
    const pageContainer = document.querySelector('.page-container');
    let startX = 0;
    let currentX = 0;
    let isSwiping = false;

    pageContainer.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      isSwiping = true;
    });

    pageContainer.addEventListener('touchmove', (e) => {
      if (!isSwiping) return;
      currentX = e.touches[0].clientX;
    });

    pageContainer.addEventListener('touchend', (e) => {
      if (!isSwiping) return;
      
      const diff = startX - currentX;
      const swipeThreshold = 100;

      if (Math.abs(diff) > swipeThreshold) {
        const pageOrder = ['home', 'models', 'reels', 'wallet', 'chat'];
        const currentIndex = pageOrder.indexOf(currentPage);
        
        if (diff > 0 && currentIndex < pageOrder.length - 1) {
          // Swipe right - next page
          showPage(pageOrder[currentIndex + 1]);
        } else if (diff < 0 && currentIndex > 0) {
          // Swipe left - previous page
          showPage(pageOrder[currentIndex - 1]);
        }
      }

      isSwiping = false;
    });
  }

  // Chat integration
  async function loadChatInterface() {
    // Load the chat interface from the original code
    const chatContainer = document.getElementById('chatContainer');
    
    if (window.openChatPopup) {
      // If chat functionality is available from Part 1-3
      chatContainer.innerHTML = `
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 40px; text-align: center;">
          <div style="font-size: 64px; margin-bottom: 20px;">üí¨</div>
          <h2 style="margin-bottom: 16px;">Private Chat</h2>
          <p style="color: var(--muted); margin-bottom: 24px; max-width: 400px;">
            Start private conversations with models. All messages are encrypted and secure.
          </p>
          <button class="btn" onclick="window.openChatPopup()">Open Chat</button>
        </div>
      `;
    } else {
      chatContainer.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">üí¨</div>
          <div>Chat functionality not available</div>
        </div>
      `;
    }
  }

  // Follow model function
  async function followModel(modelId) {
    if (!me) {
      showToast('Please login to follow models', 'error');
      return;
    }

    try {
      // Check if already following
      const followDoc = await db.collection('follows').doc(`${me.uid}_${modelId}`).get();
      
      if (followDoc.exists) {
        // Unfollow
        await db.collection('follows').doc(`${me.uid}_${modelId}`).delete();
        await db.collection('models').doc(modelId).update({
          followers: firebase.firestore.FieldValue.increment(-1)
        });
        showToast('Unfollowed model', 'success');
      } else {
        // Follow
        await db.collection('follows').doc(`${me.uid}_${modelId}`).set({
          userId: me.uid,
          modelId: modelId,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        await db.collection('models').doc(modelId).update({
          followers: firebase.firestore.FieldValue.increment(1)
        });
        showToast('Followed model!', 'success');
      }

      // Update model data if we're on the profile page
      if (currentModel && currentModel.id === modelId) {
        const modelDoc = await db.collection('models').doc(modelId).get();
        if (modelDoc.exists) {
          currentModel = { id: modelDoc.id, ...modelDoc.data() };
          showModelProfile(currentModel);
        }
      }
    } catch (error) {
      console.error('Error following model:', error);
      showToast('Failed to follow model', 'error');
    }
  }

  // Initialize advanced features
  setupPageSwipeGestures();

  // Update loadPageContent to include reels
  const originalLoadPageContent = loadPageContent;
  loadPageContent = function(pageName) {
    originalLoadPageContent(pageName);
    
    if (pageName === 'reels') {
      loadReels();
    }
  };

  // Update wallet page loading
  const originalLoadWalletData = loadWalletData;
  loadWalletData = function() {
    originalLoadWalletData();
    
    // Add credits button in wallet page
    const addCreditsBtn = document.getElementById('addCreditsBtn');
    if (addCreditsBtn) {
      addCreditsBtn.addEventListener('click', openAddCreditsModal);
    }
  };

  console.log('Camsilo Platform Advanced Features loaded');
})();

// Global functions for HTML event handlers
window.showModelProfile = function(model) {
  // This function is implemented in Part 3
  if (typeof showModelProfile === 'function') {
    showModelProfile(model);
  }
};

window.openTipModal = function(model) {
  // This function is implemented in Part 3
  if (typeof openTipModal === 'function') {
    openTipModal(model);
  }
};

// Close modal handlers
document.getElementById('closeAddCreditsModal')?.addEventListener('click', () => {
  closeModal(addCreditsModal);
});

document.getElementById('cancelPayment')?.addEventListener('click', () => {
  closeModal(addCreditsModal);
});

document.getElementById('closeModelModal')?.addEventListener('click', () => {
  closeModal(adminModelModal);
});

document.getElementById('cancelModel')?.addEventListener('click', () => {
  closeModal(adminModelModal);
});

// Payment method selection
document.querySelectorAll('.payment-method').forEach(method => {
  method.addEventListener('click', function() {
    document.querySelectorAll('.payment-method').forEach(m => {
      m.style.border = '1px solid rgba(255,255,255,0.1)';
    });
    this.style.border = '2px solid var(--accent1)';
    selectedPaymentMethod = {
      id: this.dataset.method,
      name: this.textContent.trim(),
      icon: this.querySelector('.payment-icon').textContent
    };
  });
});
</script>
